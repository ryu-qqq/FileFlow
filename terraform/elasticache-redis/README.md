# FILEFLOW - ElastiCache Redis

Generated by Infrastructure Wizard on 2025-10-27 22:57:54

## Overview

ElastiCache Redis cluster for fileflow with single-node deployment.

## Resources Created

- Redis Cache Cluster- Subnet group (private subnets)
- Security group (port 6379)
- Parameter group (Redis 7)
- CloudWatch log groups (slow-log, engine-log)
- CloudWatch alarms (CPU, memory)
- SSM parameters (endpoint, port)

## Configuration

- **Node Type**: cache.t3.small
- **Number of Nodes**: 1
- **Engine Version**: Redis 7.0
- **Environment**: prod
- **Region**: ap-northeast-2
- **Multi-AZ**: Disabled- **Snapshot Retention**: 7 days
- **Encryption at Rest**: Not available in single-node- **Encryption in Transit**: Not available in single-node
## Security Features

- ðŸ”’ Encryption at rest- ðŸ” Encryption in transit- ðŸ›¡ï¸ VPC isolation (private subnets only)
- ðŸšª Security group rules (app tier access only)
- ðŸ“ CloudWatch logging (slow-log, engine-log)

## Connection Information

### Endpoint

**Endpoint**:
```
fileflow-redis-prod.xxxxxx.ap-northeast-2.cache.amazonaws.com:6379
```

### Retrieve from SSM

```bash
REDIS_ENDPOINT=$(aws ssm get-parameter --name "/fileflow/prod/redis/endpoint" --query "Parameter.Value" --output text)
REDIS_PORT=$(aws ssm get-parameter --name "/fileflow/prod/redis/port" --query "Parameter.Value" --output text)

echo "redis://$REDIS_ENDPOINT:$REDIS_PORT"
```

## Usage Examples

### Node.js (ioredis)

```javascript
const Redis = require('ioredis');

const redis = new Redis({
  host: process.env.REDIS_ENDPOINT,
  port: process.env.REDIS_PORT,
  retryStrategy: (times) => Math.min(times * 50, 2000),
});

// Set value
await redis.set('key', 'value', 'EX', 3600);

// Get value
const value = await redis.get('key');
```

### Python (redis-py)

```python
import redis
import os

r = redis.Redis(
    host=os.getenv('REDIS_ENDPOINT'),
    port=int(os.getenv('REDIS_PORT')),
    decode_responses=True,
    socket_connect_timeout=5,
    socket_keepalive=True,
)

# Set value with expiration
r.setex('key', 3600, 'value')

# Get value
value = r.get('key')
```

### Go (go-redis)

```go
import (
    "github.com/go-redis/redis/v8"
    "context"
    "time"
)

rdb := redis.NewClient(&redis.Options{
    Addr:     os.Getenv("REDIS_ENDPOINT") + ":" + os.Getenv("REDIS_PORT"),
    PoolSize:     10,
    DialTimeout:  5 * time.Second,
})

// Set value
err := rdb.Set(ctx, "key", "value", 3600*time.Second).Err()

// Get value
val, err := rdb.Get(ctx, "key").Result()
```

## Monitoring

### CloudWatch Logs

- **Slow Log**: `/aws/elasticache/fileflow-redis-prod/slow-log`
- **Engine Log**: `/aws/elasticache/fileflow-redis-prod/engine-log`

```bash
# Tail slow log
aws logs tail /aws/elasticache/fileflow-redis-prod/slow-log --follow

# Tail engine log
aws logs tail /aws/elasticache/fileflow-redis-prod/engine-log --follow
```

### CloudWatch Alarms

- **CPU Utilization**: Alarm when > 75% for 10 minutes
- **Memory Utilization**: Alarm when > 80% for 10 minutes

### Key Metrics to Monitor

```bash
# CPU Utilization
aws cloudwatch get-metric-statistics \
  --namespace AWS/ElastiCache \
  --dimensions Name=CacheClusterId,Value=fileflow-redis-prod \
  --metric-name CPUUtilization \
  --start-time $(date -u -d '1 hour ago' +%Y-%m-%dT%H:%M:%S) \
  --end-time $(date -u +%Y-%m-%dT%H:%M:%S) \
  --period 300 \
  --statistics Average

# Memory Usage
aws cloudwatch get-metric-statistics \
  --namespace AWS/ElastiCache \
  --dimensions Name=CacheClusterId,Value=fileflow-redis-prod \
  --metric-name DatabaseMemoryUsagePercentage \
  --start-time $(date -u -d '1 hour ago' +%Y-%m-%dT%H:%M:%S) \
  --end-time $(date -u +%Y-%m-%dT%H:%M:%S) \
  --period 300 \
  --statistics Average
```

## Maintenance

### Snapshot Management

Automatic snapshots are taken daily during the snapshot window (03:00-05:00 UTC) and retained for 7 days.

### Maintenance Window

System maintenance occurs on Sundays 05:00-07:00 UTC.

### Manual Snapshot

```bash
aws elasticache create-snapshot \
  --cache-cluster-id fileflow-redis-prod \
  --snapshot-name fileflow-manual-$(date +%Y%m%d-%H%M%S)
```

## Deployment

1. Initialize Terraform: `terraform init`
2. Plan changes: `terraform plan`
3. Apply: `terraform apply`

## Troubleshooting

### Connection Issues

1. Check security group rules
2. Verify subnet configuration
3. Test from application server:

```bash
# Install redis-cli
sudo apt-get install redis-tools

# Test connection
redis-cli -h $REDIS_ENDPOINT -p $REDIS_PORT  ping
```

### Performance Issues

1. Monitor CPU and memory metrics
2. Review slow log for expensive operations
3. Consider scaling up node type or adding replicas

---

ðŸ¤– Generated with Infrastructure Wizard
