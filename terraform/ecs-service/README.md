# FILEFLOW - ECS Service Infrastructure

**Generated by Infrastructure Wizard**

This directory contains the infrastructure code for the `fileflow` service.

## üìã Service Configuration

| Property | Value |
|----------|-------|
| **Service Name** | fileflow |
| **Environment** | prod |
| **CPU** | 1024 units |
| **Memory** | 2048 MiB |
| **Container Port** | 8080 |
| **Desired Count** | 1 |

## üèóÔ∏è Infrastructure Components

### Core Components
- ‚úÖ **ECS Service** (Fargate)
- ‚úÖ **CloudWatch Log Group** (retention: 30 days)
- ‚úÖ **Security Groups** (ECS tasks)

### Load Balancer
- ‚úÖ **Application Load Balancer**
- ‚úÖ **Target Group** (health check: ``)
- ‚úÖ **Security Group** (ALB)

### Database
- ‚úÖ **Shared RDS** (referenced via SSM Parameter Store)


## üîó Shared Infrastructure References

This service references the following shared infrastructure:

| Resource | SSM Parameter | Source |
|----------|---------------|--------|
| **VPC ID** | `/shared/network/vpc-id` | terraform/network/ |
| **Private Subnets** | `/shared/network/private-subnet-ids` | terraform/network/ |
| **Public Subnets** | `/shared/network/public-subnet-ids` | terraform/network/ |
| **KMS (ECS Secrets)** | `alias/ecs-secrets` | terraform/kms/ |
| **KMS (Logs)** | `alias/cloudwatch-logs` | terraform/kms/ |
| **RDS Endpoint** | `/shared/rds/db-instance-address` | terraform/rds/ |
| **RDS Port** | `/shared/rds/db-instance-port` | terraform/rds/ |

## üöÄ Deployment

### Prerequisites
- AWS credentials configured
- Terraform >= 1.5.0
- Shared infrastructure deployed (network, kms, etc.)

### Deploy via Atlantis (Recommended)
```bash
# 1. Create PR with changes
git checkout -b feat/update-fileflow
# ... make changes ...
git push

# 2. Atlantis automatically runs plan
# 3. Review plan results in PR comment
# 4. Approve and merge ‚Üí Atlantis applies automatically
```

### Manual Deployment (Development Only)
```bash
cd terraform/services/fileflow

# Initialize
terraform init

# Plan
terraform plan

# Apply (requires approval)
terraform apply
```

## üìä Outputs

After deployment, the following outputs are available:

```bash
terraform output
```

Key outputs:
- `ecs_service_id`: ECS service identifier
- `security_group_id`: Security group for ECS tasks
- `cloudwatch_log_group_name`: Log group name
- `alb_dns_name`: ALB DNS endpoint
- `target_group_arn`: Target group ARN

## üîß Configuration

### Environment Variables
```bash
ENVIRONMENT=prod
SERVICE_NAME=fileflow
DB_HOST=${DB_HOST}  # from SSM
DB_PORT=${DB_PORT}  # from SSM
```

### Secrets (AWS Secrets Manager)
- `DB_PASSWORD`: Database password (referenced via SSM)

## üìù Maintenance

### Scaling
Update `desired_count` in `main.tf` and create a PR.

### Resource Updates
Modify the relevant `.tf` files and create a PR. Atlantis will show the plan.

### Logs
```bash
# View logs in CloudWatch
aws logs tail /aws/ecs/fileflow --follow

# Or use AWS Console
https://console.aws.amazon.com/cloudwatch/home?region=ap-northeast-2#logsV2:log-groups/log-group/$252Faws$252Fecs$252Ffileflow
```

## üè∑Ô∏è Tags

All resources are tagged with:
```hcl
Environment = "prod"
Service     = "fileflow"
Owner       = "platform-team@example.com"
CostCenter  = "engineering"
ManagedBy   = "terraform"
```

## üìö Related Documentation

- [ECS Module](../../modules/ecs-service/README.md)
- [ALB Module](../../modules/alb/README.md)
- [Infrastructure Governance](../../docs/governance/)
- [Atlantis Operations](../../docs/guides/atlantis-operations.md)

---

**Last Updated**: 2025-10-27
**Generated by**: Infrastructure Wizard v1.0.0
