# ===============================================
# Spring Boot Web API Application Configuration
# ===============================================
# 공통 설정 (환경별 설정은 application-{profile}.yml 참조)
#
# @author FileFlow Team
# @since 1.0.0
# ===============================================

# ===============================================
# Spring Configuration
# ===============================================
spring:
  application:
    name: fileflow-web-api

  # Profile 설정 (기본값: local)
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:local}

  # ===============================================
  # MessageSource (i18n)
  # ===============================================
  messages:
    basename: messages
    encoding: UTF-8
    fallback-to-system-locale: false

  # ===============================================
  # Jackson (JSON 직렬화/역직렬화)
  # ===============================================
  jackson:
    date-format: yyyy-MM-dd'T'HH:mm:ss
    time-zone: Asia/Seoul
    serialization:
      WRITE_DATES_AS_TIMESTAMPS: false
      FAIL_ON_EMPTY_BEANS: false
      INDENT_OUTPUT: false
    deserialization:
      FAIL_ON_UNKNOWN_PROPERTIES: false
      ACCEPT_EMPTY_STRING_AS_NULL_OBJECT: true
    default-property-inclusion: non_null
    locale: ko_KR

  # ===============================================
  # Validation
  # ===============================================
  validation:
    fail-fast: false

  # ===============================================
  # Task Scheduling (Scheduler 비활성화)
  # ===============================================
  # Web API에서는 Scheduler를 실행하지 않음
  # 별도의 ECS Task로 분리
  task:
    scheduling:
      enabled: false

  # ===============================================
  # Web Configuration
  # ===============================================
  web:
    locale: ko_KR
    locale-resolver: fixed

  # ===============================================
  # MVC Configuration
  # ===============================================
  mvc:
    contentnegotiation:
      favor-parameter: false
      favor-path-extension: false
    pathmatch:
      matching-strategy: ant_path_matcher
    throw-exception-if-no-handler-found: true

  # ===============================================
  # JPA Configuration (공통)
  # ===============================================
  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate:
        format_sql: true
        use_sql_comments: true
        jdbc:
          batch_size: 20
        order_inserts: true
        order_updates: true
        generate_statistics: false
    open-in-view: false

  # ===============================================
  # Flyway Migration (공통)
  # ===============================================
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    baseline-version: 0
    validate-on-migrate: true
    out-of-order: false
    sql-migration-prefix: V
    sql-migration-separator: __
    sql-migration-suffixes: .sql
    placeholder-replacement: true
    placeholders:
      charset: utf8mb4
      collation: utf8mb4_unicode_ci
    table: flyway_schema_history
    fail-on-missing-locations: true

# ===============================================
# Server Configuration (공통)
# ===============================================
server:
  port: 8083
  shutdown: graceful

# ===============================================
# Management & Actuator (공통)
# ===============================================
management:
  endpoints:
    web:
      base-path: /actuator
  metrics:
    tags:
      application: ${spring.application.name}

# ===============================================
# Logging Configuration (공통)
# ===============================================
# logback-spring.xml에서 상세 설정 관리
logging:
  level:
    root: INFO
    com.ryuqq.fileflow: DEBUG

# ===============================================
# API Endpoint Configuration (공통)
# ===============================================
api:
  endpoints:
    base-v1: /api/v1
    
    iam:
      organization:
        base: /organizations
        by-id: /{organizationId}
        status: /{organizationId}/status
      tenant:
        base: /tenants
        by-id: /{tenantId}
        status: /{tenantId}/status
        tree: /{tenantId}/tree
      permission:
        base: /permissions
        evaluate: /evaluate
      user-context:
        base: /user-contexts
    
    settings:
      base: /settings
    
    upload:
      base: /uploads
      multipart:
        init: /multipart/init
        part-url: /multipart/{sessionKey}/parts/{partNumber}/url
        mark-part: /multipart/{sessionKey}/parts/{partNumber}
        complete: /multipart/{sessionKey}/complete
    
    download:
      base: /downloads
      external:
        start: /external
        status: /external/{downloadId}/status
    
    file:
      base: /files
      by-id: /{fileId}
      download-url: /{fileId}/download-url
  
  error:
    base-url: about:blank
    use-about-blank: true
