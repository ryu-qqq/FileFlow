# FILE-006-001: Domain Layer êµ¬í˜„

**Epic**: File Upload Presigned URL System
**Layer**: Domain Layer
**ë¸Œëœì¹˜**: feature/FILE-006-001-domain
**Jira URL**: (sync-to-jira í›„ ì¶”ê°€)

---

## ğŸ“ ëª©ì 

íŒŒì¼ ì—…ë¡œë“œ ì„¸ì…˜ ë° íŒŒì¼ ë©”íƒ€ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ëŠ” ë„ë©”ì¸ ëª¨ë¸ êµ¬í˜„

**í•µì‹¬ ì—­í• **:
- ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ìº¡ìŠí™” (íŒŒì¼ í¬ê¸°, íƒ€ì… ê²€ì¦)
- ì„¸ì…˜ ìƒëª…ì£¼ê¸° ê´€ë¦¬ (ìƒì„±, ë§Œë£Œ, ì™„ë£Œ)
- S3 ê²½ë¡œ ìƒì„± ì „ëµ (Role ê¸°ë°˜ ë„¤ì„ìŠ¤í˜ì´ìŠ¤)
- ë¶ˆë³€ì„± ë³´ì¥ (Value Objects)

---

## ğŸ¯ ìš”êµ¬ì‚¬í•­

### 1. Aggregate Root: UploadSession

**ì†ì„±**:
- [ ] `sessionId`: SessionId (VO)
- [ ] `userId`: Long (JWTì—ì„œ ì¶”ì¶œ)
- [ ] `tenantId`: Long (JWTì—ì„œ ì¶”ì¶œ, ê¸°ë³¸ê°’ 1)
- [ ] `role`: UserRole (Enum)
- [ ] `sellerName`: String (SELLERë§Œ, Nullable)
- [ ] `uploadType`: UploadType (Enum)
- [ ] `customPath`: String (í´ë¼ì´ì–¸íŠ¸ ì œê³µ)
- [ ] `fileName`: FileName (VO)
- [ ] `fileSize`: FileSize (VO)
- [ ] `mimeType`: MimeType (VO)
- [ ] `status`: SessionStatus (Enum)
- [ ] `clock`: Clock (ì‹œê°„ ì˜ì¡´ì„± ì£¼ì…, **í•„ìˆ˜**)
- [ ] `createdAt`: LocalDateTime (ë¶ˆë³€)
- [ ] `updatedAt`: LocalDateTime (ìƒíƒœ ë³€ê²½ ì‹œ ìë™ ê°±ì‹ , **í•„ìˆ˜**)
- [ ] `expiresAt`: LocalDateTime (ìƒì„± + 15ë¶„)
- [ ] `completedAt`: LocalDateTime (Nullable)

**ìƒì„±ì**:
- [ ] `private UploadSession(...)`: **ë°˜ë“œì‹œ private**ìœ¼ë¡œ ì„ ì–¸
  - ì™¸ë¶€ì—ì„œ ì§ì ‘ ìƒì„± ë¶ˆê°€
  - ì •ì  íŒ©í† ë¦¬ ë©”ì„œë“œë¡œë§Œ ìƒì„±

**ì •ì  íŒ©í† ë¦¬ ë©”ì„œë“œ** (aggregate-guide.md ì¤€ìˆ˜):
- [ ] `static forNew(...)`: ì‹ ê·œ ì„¸ì…˜ ìƒì„± (ID ìë™ ìƒì„±)
  - SessionId.forNew()ë¡œ UUID ìƒì„±
  - íŒŒì¼ í¬ê¸° ê²€ì¦ (SINGLE: 100MB, MULTIPART: 1GB)
  - íŒŒì¼ íƒ€ì… ê²€ì¦ (`image/*`, `text/html`)
  - S3 ê²½ë¡œ ìƒì„±
  - ë§Œë£Œ ì‹œê° ê³„ì‚° (ìƒì„± + 15ë¶„)
  - ìƒíƒœ ì´ˆê¸°í™” (PREPARING)
  - **createdAt, updatedAt = LocalDateTime.now(clock)**

- [ ] `static of(SessionId sessionId, ...)`: ID ê¸°ë°˜ ì„¸ì…˜ ìƒì„±
  - ê¸°ì¡´ SessionIdë¡œ ì„¸ì…˜ ìƒì„±
  - forNew()ì™€ ë™ì¼í•œ ê²€ì¦ ë¡œì§

- [ ] `static reconstitute(...)`: ì˜ì†ì„± ë³µì›ìš© (ëª¨ë“  í•„ë“œ í¬í•¨)
  - Repositoryì—ì„œ Entity â†’ Domain ë³€í™˜ ì‹œ ì‚¬ìš©
  - ê²€ì¦ ë¡œì§ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ (ì´ë¯¸ ê²€ì¦ëœ ë°ì´í„°)
  - createdAt, updatedAt ê·¸ëŒ€ë¡œ ì „ë‹¬

**ë¹„ì¦ˆë‹ˆìŠ¤ ë©”ì„œë“œ**:
- [ ] `activate()`: ì„¸ì…˜ í™œì„±í™” (PREPARING â†’ ACTIVE)
  - ìƒíƒœ ì „í™˜ ê°€ëŠ¥ ê²€ì¦
  - **this.updatedAt = LocalDateTime.now(clock)** (í•„ìˆ˜)

- [ ] `complete()`: ì„¸ì…˜ ì™„ë£Œ (ACTIVE â†’ COMPLETED)
  - ì™„ë£Œ ê°€ëŠ¥ ìƒíƒœ ê²€ì¦ (ACTIVEë§Œ ê°€ëŠ¥)
  - `completedAt` ì„¤ì •
  - **this.updatedAt = LocalDateTime.now(clock)** (í•„ìˆ˜)

- [ ] `expire()`: ì„¸ì…˜ ë§Œë£Œ (ACTIVE â†’ EXPIRED)
  - **this.updatedAt = LocalDateTime.now(clock)** (í•„ìˆ˜)

- [ ] `fail()`: ì„¸ì…˜ ì‹¤íŒ¨ (ACTIVE â†’ FAILED)
  - **this.updatedAt = LocalDateTime.now(clock)** (í•„ìˆ˜)

**ìƒíƒœ ì¡°íšŒ ë©”ì„œë“œ** (Tell Don't Ask):
- [ ] `isExpired()`: ë§Œë£Œ ì—¬ë¶€ í™•ì¸ (`expiresAt < now()`)
- [ ] `canComplete()`: ì™„ë£Œ ê°€ëŠ¥ ì—¬ë¶€ (status == ACTIVE)
- [ ] `isActive()`: í™œì„± ìƒíƒœ ì—¬ë¶€
- [ ] `isPreparing()`: ì¤€ë¹„ ìƒíƒœ ì—¬ë¶€
- [ ] `canActivate()`: í™œì„±í™” ê°€ëŠ¥ ì—¬ë¶€

**Law of Demeter ì¤€ìˆ˜ ë©”ì„œë“œ**:
- [ ] `getSessionIdValue()`: SessionIdì˜ ì›ì‹œ ê°’ ë°˜í™˜ (String)
  - `session.getSessionId().value()` (X)
  - `session.getSessionIdValue()` (O)

**ë¶ˆë³€ì‹ (Invariants)**:
- [ ] íŒŒì¼ í¬ê¸°: SINGLE â‰¤ 100MB, MULTIPART â‰¤ 1GB
- [ ] íŒŒì¼ íƒ€ì…: `image/*` OR `text/html`
- [ ] ì„¸ì…˜ ìœ íš¨ì‹œê°„: 15ë¶„ ê³ ì •
- [ ] ìƒíƒœ ì „í™˜ ê·œì¹™: PREPARING â†’ ACTIVE â†’ {COMPLETED, EXPIRED, FAILED}

### 2. Aggregate Root: File

**ì†ì„±**:
- [ ] `fileId`: SessionId (VO, UUID v4)
- [ ] `userId`: Long
- [ ] `tenantId`: Long
- [ ] `role`: UserRole
- [ ] `fileName`: FileName (VO)
- [ ] `fileSize`: FileSize (VO)
- [ ] `mimeType`: MimeType (VO)
- [ ] `s3Path`: S3Path (VO)
- [ ] `uploadType`: UploadType
- [ ] `clock`: Clock (ì‹œê°„ ì˜ì¡´ì„± ì£¼ì…, **í•„ìˆ˜**)
- [ ] `uploadedAt`: LocalDateTime (ë¶ˆë³€)
- [ ] `updatedAt`: LocalDateTime (ìƒíƒœ ë³€ê²½ ì‹œ ìë™ ê°±ì‹ , **í•„ìˆ˜**)
- [ ] `deleted`: Boolean (ê¸°ë³¸ê°’: false)
- [ ] `deletedAt`: LocalDateTime (Nullable)

**ìƒì„±ì**:
- [ ] `private File(...)`: **ë°˜ë“œì‹œ private**ìœ¼ë¡œ ì„ ì–¸
  - ì™¸ë¶€ì—ì„œ ì§ì ‘ ìƒì„± ë¶ˆê°€
  - ì •ì  íŒ©í† ë¦¬ ë©”ì„œë“œë¡œë§Œ ìƒì„±

**ì •ì  íŒ©í† ë¦¬ ë©”ì„œë“œ** (aggregate-guide.md ì¤€ìˆ˜):
- [ ] `static forNew(...)`: ì‹ ê·œ íŒŒì¼ ìƒì„± (ID ìë™ ìƒì„±)
  - SessionId.forNew()ë¡œ UUID ìƒì„±
  - UploadSessionì—ì„œ ì •ë³´ ì¶”ì¶œ
  - **uploadedAt, updatedAt = LocalDateTime.now(clock)**

- [ ] `static of(SessionId fileId, ...)`: ID ê¸°ë°˜ íŒŒì¼ ìƒì„±
  - ê¸°ì¡´ SessionIdë¡œ íŒŒì¼ ìƒì„±
  - forNew()ì™€ ë™ì¼í•œ ë¡œì§

- [ ] `static reconstitute(...)`: ì˜ì†ì„± ë³µì›ìš© (ëª¨ë“  í•„ë“œ í¬í•¨)
  - Repositoryì—ì„œ Entity â†’ Domain ë³€í™˜ ì‹œ ì‚¬ìš©
  - ê²€ì¦ ë¡œì§ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ
  - uploadedAt, updatedAt, deletedAt ê·¸ëŒ€ë¡œ ì „ë‹¬

**ë¹„ì¦ˆë‹ˆìŠ¤ ë©”ì„œë“œ**:
- [ ] `delete()`: ë…¼ë¦¬ ì‚­ì œ
  - `deleted = true`
  - `deletedAt = LocalDateTime.now(clock)`
  - **this.updatedAt = LocalDateTime.now(clock)** (í•„ìˆ˜)

**ìƒíƒœ ì¡°íšŒ ë©”ì„œë“œ** (Tell Don't Ask):
- [ ] `isDeleted()`: ì‚­ì œ ì—¬ë¶€ í™•ì¸
- [ ] `canDelete()`: ì‚­ì œ ê°€ëŠ¥ ì—¬ë¶€ (ì´ë¯¸ ì‚­ì œëœ ê²½ìš° false)

**Law of Demeter ì¤€ìˆ˜ ë©”ì„œë“œ**:
- [ ] `getFileIdValue()`: SessionIdì˜ ì›ì‹œ ê°’ ë°˜í™˜ (String)
  - `file.getFileId().value()` (X)
  - `file.getFileIdValue()` (O)

### 3. Value Objects

**SessionId** (VO):
- [ ] `value`: String (UUID v4)

**ì†ì„±**:
- [ ] UUID v4 í˜•ì‹ ê²€ì¦ í•„ìˆ˜
- [ ] null ë¶ˆê°€

**ë©”ì„œë“œ** (vo-guide.md ID VO íŒ¨í„´ ì¤€ìˆ˜):
- [ ] `static forNew()`: **ìƒˆ ì„¸ì…˜ ID ìƒì„±** (UUID.randomUUID())
  - âš ï¸ `generate()` ê¸ˆì§€, `forNew()` ì‚¬ìš© í•„ìˆ˜
- [ ] `static from(String value)`: ê¸°ì¡´ ì„¸ì…˜ ID ê²€ì¦ ë° ìƒì„±
- [ ] `isNew()`: IDê°€ nullì¸ì§€ í™•ì¸ (ì‹ ê·œ ì—¬ë¶€ íŒë‹¨)
- [ ] `value()`: UUID ë¬¸ìì—´ ë°˜í™˜

**ì˜ˆì™¸**:
- [ ] `IllegalArgumentException`: ìœ íš¨í•˜ì§€ ì•Šì€ UUID í˜•ì‹

**êµ¬í˜„ ì˜ˆì‹œ**:
```java
public record SessionId(String value) {
    public SessionId {
        // null í—ˆìš© (isNew() ì²´í¬ìš©)
        if (value != null && !isValidUUID(value)) {
            throw new IllegalArgumentException("ìœ íš¨í•˜ì§€ ì•Šì€ ì„¸ì…˜ IDì…ë‹ˆë‹¤: " + value);
        }
    }

    /**
     * ì‹ ê·œ ID ìƒì„± (ID VO íŒ¨í„´)
     * @return ìƒˆë¡œ ìƒì„±ëœ SessionId
     */
    public static SessionId forNew() {
        return new SessionId(UUID.randomUUID().toString());
    }

    /**
     * ê¸°ì¡´ ID ë³µì›
     * @param value UUID ë¬¸ìì—´
     * @return SessionId
     */
    public static SessionId from(String value) {
        return new SessionId(value);
    }

    /**
     * ì‹ ê·œ ID ì—¬ë¶€ í™•ì¸ (ID VO íŒ¨í„´ í•„ìˆ˜ ë©”ì„œë“œ)
     * @return value == nullì´ë©´ true
     */
    public boolean isNew() {
        return value == null;
    }

    private boolean isValidUUID(String value) {
        try {
            UUID.fromString(value);
            return true;
        } catch (IllegalArgumentException e) {
            return false;
        }
    }
}
```

**FileName** (VO):
- [ ] `value`: String (íŒŒì¼ ì´ë¦„)
- [ ] `extension`: String (í™•ì¥ì)

**ì†ì„±**:
- [ ] íŒŒì¼ ì´ë¦„ ê¸¸ì´: 1-255ì
- [ ] null ë° ë¹ˆ ë¬¸ìì—´ ë¶ˆê°€
- [ ] í™•ì¥ìëŠ” ìƒì„± ì‹œ ìë™ ì¶”ì¶œ

**ë©”ì„œë“œ**:
- [ ] `static from(String value)`: íŒŒì¼ ì´ë¦„ ê²€ì¦ ë° í™•ì¥ì ì¶”ì¶œ
- [ ] `value()`: íŒŒì¼ ì´ë¦„ ë°˜í™˜
- [ ] `extension()`: í™•ì¥ì ë°˜í™˜ (ì˜ˆ: `.jpg`)
- [ ] `withoutExtension()`: í™•ì¥ì ì œì™¸í•œ íŒŒì¼ ì´ë¦„

**ì˜ˆì™¸**:
- [ ] `IllegalArgumentException`: null, ë¹ˆ ë¬¸ìì—´, ê¸¸ì´ ì´ˆê³¼

**êµ¬í˜„ ì˜ˆì‹œ**:
```java
/**
 * íŒŒì¼ ì´ë¦„ VO
 *
 * <p>íŒŒì¼ ì´ë¦„ ê²€ì¦ ë° í™•ì¥ì ìë™ ì¶”ì¶œ
 *
 * <p>ê²€ì¦ ê·œì¹™:
 * <ul>
 *   <li>null ë° ë¹ˆ ë¬¸ìì—´ ë¶ˆê°€</li>
 *   <li>ìµœëŒ€ ê¸¸ì´: 255ì</li>
 *   <li>í™•ì¥ìëŠ” ìƒì„± ì‹œ ìë™ ì¶”ì¶œ (ë§ˆì§€ë§‰ '.' ê¸°ì¤€)</li>
 * </ul>
 *
 * @param value íŒŒì¼ ì´ë¦„ (í™•ì¥ì í¬í•¨)
 * @param extension í™•ì¥ì (ì˜ˆ: ".jpg", ".png")
 * @throws IllegalArgumentException íŒŒì¼ ì´ë¦„ì´ null, ë¹ˆ ë¬¸ìì—´, ë˜ëŠ” 255ì ì´ˆê³¼
 */
public record FileName(String value, String extension) {
    public FileName {
        if (value == null || value.isBlank()) {
            throw new IllegalArgumentException("íŒŒì¼ ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤");
        }
        if (value.length() > 255) {
            throw new IllegalArgumentException("íŒŒì¼ ì´ë¦„ì€ 255ìë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤");
        }
    }

    /**
     * íŒŒì¼ ì´ë¦„ ìƒì„± ë° í™•ì¥ì ìë™ ì¶”ì¶œ
     *
     * @param value íŒŒì¼ ì´ë¦„
     * @return FileName VO
     */
    public static FileName from(String value) {
        String ext = extractExtension(value);
        return new FileName(value, ext);
    }

    private static String extractExtension(String fileName) {
        int lastDot = fileName.lastIndexOf('.');
        return lastDot > 0 ? fileName.substring(lastDot) : "";
    }

    /**
     * í™•ì¥ìë¥¼ ì œì™¸í•œ íŒŒì¼ ì´ë¦„ ë°˜í™˜
     *
     * @return í™•ì¥ì ì œì™¸ íŒŒì¼ ì´ë¦„
     */
    public String withoutExtension() {
        return extension.isEmpty() ? value : value.substring(0, value.length() - extension.length());
    }
}
```

**FileSize** (VO):
- [ ] `bytes`: long

**ì†ì„±**:
- [ ] íŒŒì¼ í¬ê¸°ëŠ” 1ë°”ì´íŠ¸ ì´ìƒ
- [ ] ì—…ë¡œë“œ íƒ€ì…ë³„ ìµœëŒ€ í¬ê¸° ê²€ì¦

**ë©”ì„œë“œ**:
- [ ] `static of(long bytes)`: íŒŒì¼ í¬ê¸° ìƒì„±
- [ ] `validateForUploadType(UploadType uploadType)`: ì—…ë¡œë“œ íƒ€ì…ë³„ í¬ê¸° ê²€ì¦
- [ ] `isLargerThan(long threshold)`: í¬ê¸° ë¹„êµ
- [ ] `bytes()`: ë°”ì´íŠ¸ ìˆ˜ ë°˜í™˜
- [ ] `toMB()`: MB ë‹¨ìœ„ ë³€í™˜
- [ ] `toGB()`: GB ë‹¨ìœ„ ë³€í™˜

**ì˜ˆì™¸**:
- [ ] `IllegalArgumentException`: 0 ì´í•˜ í¬ê¸°
- [ ] `FileSizeExceededException`: ìµœëŒ€ í¬ê¸° ì´ˆê³¼

**êµ¬í˜„ ì˜ˆì‹œ**:
```java
/**
 * íŒŒì¼ í¬ê¸° VO
 *
 * <p>íŒŒì¼ í¬ê¸° ê²€ì¦ ë° ë‹¨ìœ„ ë³€í™˜ ê¸°ëŠ¥ ì œê³µ
 *
 * <p>ê²€ì¦ ê·œì¹™:
 * <ul>
 *   <li>íŒŒì¼ í¬ê¸°ëŠ” 1ë°”ì´íŠ¸ ì´ìƒ</li>
 *   <li>ì—…ë¡œë“œ íƒ€ì…ë³„ ìµœëŒ€ í¬ê¸° ê²€ì¦</li>
 * </ul>
 *
 * @param bytes íŒŒì¼ í¬ê¸° (ë°”ì´íŠ¸)
 * @throws IllegalArgumentException íŒŒì¼ í¬ê¸°ê°€ 0 ì´í•˜
 * @throws FileSizeExceededException ì—…ë¡œë“œ íƒ€ì…ë³„ ìµœëŒ€ í¬ê¸° ì´ˆê³¼
 */
public record FileSize(long bytes) {
    private static final long MB = 1024 * 1024;
    private static final long GB = 1024 * MB;

    public FileSize {
        if (bytes <= 0) {
            throw new IllegalArgumentException("íŒŒì¼ í¬ê¸°ëŠ” 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤");
        }
    }

    /**
     * íŒŒì¼ í¬ê¸° ìƒì„±
     *
     * @param bytes ë°”ì´íŠ¸ ìˆ˜
     * @return FileSize VO
     */
    public static FileSize of(long bytes) {
        return new FileSize(bytes);
    }

    /**
     * ì—…ë¡œë“œ íƒ€ì…ë³„ ìµœëŒ€ í¬ê¸° ê²€ì¦
     *
     * @param uploadType ì—…ë¡œë“œ íƒ€ì… (SINGLE: 5GB, MULTIPART: 5TB)
     * @throws FileSizeExceededException ìµœëŒ€ í¬ê¸° ì´ˆê³¼ ì‹œ
     */
    public void validateForUploadType(UploadType uploadType) {
        long maxSize = uploadType.getMaxSize();
        if (bytes > maxSize) {
            throw new FileSizeExceededException(bytes, maxSize);
        }
    }

    /**
     * íŒŒì¼ í¬ê¸° ë¹„êµ
     *
     * @param threshold ë¹„êµí•  ì„ê³„ê°’ (ë°”ì´íŠ¸)
     * @return í˜„ì¬ í¬ê¸°ê°€ ì„ê³„ê°’ë³´ë‹¤ í¬ë©´ true
     */
    public boolean isLargerThan(long threshold) {
        return bytes > threshold;
    }

    /**
     * MB ë‹¨ìœ„ë¡œ ë³€í™˜
     *
     * @return íŒŒì¼ í¬ê¸° (MB)
     */
    public double toMB() {
        return (double) bytes / MB;
    }

    /**
     * GB ë‹¨ìœ„ë¡œ ë³€í™˜
     *
     * @return íŒŒì¼ í¬ê¸° (GB)
     */
    public double toGB() {
        return (double) bytes / GB;
    }
}
```

**MimeType** (VO):
- [ ] `value`: String

**ì†ì„±**:
- [ ] í—ˆìš© íƒ€ì…: `image/*`, `text/html`ë§Œ í—ˆìš©
- [ ] null ë° ë¹ˆ ë¬¸ìì—´ ë¶ˆê°€

**ë©”ì„œë“œ**:
- [ ] `static of(String value)`: MIME íƒ€ì… ê²€ì¦ ë° ìƒì„±
- [ ] `value()`: MIME íƒ€ì… ë¬¸ìì—´ ë°˜í™˜
- [ ] `extractExtension()`: MIME â†’ í™•ì¥ì ë³€í™˜
- [ ] `isImage()`: ì´ë¯¸ì§€ íƒ€ì… ì—¬ë¶€
- [ ] `isHtml()`: HTML íƒ€ì… ì—¬ë¶€

**ì˜ˆì™¸**:
- [ ] `UnsupportedFileTypeException`: í—ˆìš©ë˜ì§€ ì•Šì€ MIME íƒ€ì…

**êµ¬í˜„ ì˜ˆì‹œ**:
```java
/**
 * MIME íƒ€ì… VO
 *
 * <p>í—ˆìš©ëœ MIME íƒ€ì…ë§Œ ìƒì„± ê°€ëŠ¥
 *
 * <p>í—ˆìš© íƒ€ì…:
 * <ul>
 *   <li>image/* (image/jpeg, image/png, image/gif, image/webp)</li>
 *   <li>text/html</li>
 * </ul>
 *
 * @param value MIME íƒ€ì… ë¬¸ìì—´ (ì˜ˆ: "image/jpeg", "text/html")
 * @throws IllegalArgumentException MIME íƒ€ì…ì´ null ë˜ëŠ” ë¹ˆ ë¬¸ìì—´
 * @throws UnsupportedFileTypeException í—ˆìš©ë˜ì§€ ì•Šì€ MIME íƒ€ì…
 */
public record MimeType(String value) {
    private static final List<String> ALLOWED_PATTERNS = List.of("image/*", "text/html");

    public MimeType {
        if (value == null || value.isBlank()) {
            throw new IllegalArgumentException("MIME íƒ€ì…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤");
        }
        if (!isAllowed(value)) {
            throw new UnsupportedFileTypeException(value);
        }
    }

    /**
     * MIME íƒ€ì… ìƒì„± ë° ê²€ì¦
     *
     * @param value MIME íƒ€ì… ë¬¸ìì—´
     * @return MimeType VO
     */
    public static MimeType of(String value) {
        return new MimeType(value);
    }

    private boolean isAllowed(String type) {
        return ALLOWED_PATTERNS.stream()
            .anyMatch(pattern -> matches(type, pattern));
    }

    private boolean matches(String type, String pattern) {
        if (pattern.endsWith("/*")) {
            String prefix = pattern.substring(0, pattern.length() - 2);
            return type.startsWith(prefix + "/");
        }
        return type.equals(pattern);
    }

    /**
     * MIME íƒ€ì…ì—ì„œ í™•ì¥ì ì¶”ì¶œ
     *
     * @return í™•ì¥ì (ì˜ˆ: ".jpg", ".png", ".html")
     */
    public String extractExtension() {
        return switch (value) {
            case "image/jpeg" -> ".jpg";
            case "image/png" -> ".png";
            case "image/gif" -> ".gif";
            case "image/webp" -> ".webp";
            case "text/html" -> ".html";
            default -> "";
        };
    }

    /**
     * ì´ë¯¸ì§€ íƒ€ì… ì—¬ë¶€ í™•ì¸
     *
     * @return image/*ì´ë©´ true
     */
    public boolean isImage() {
        return value.startsWith("image/");
    }

    /**
     * HTML íƒ€ì… ì—¬ë¶€ í™•ì¸
     *
     * @return text/htmlì´ë©´ true
     */
    public boolean isHtml() {
        return "text/html".equals(value);
    }
}
```

**S3Path** (VO):
- [ ] `tenantId`: Long
- [ ] `namespace`: String (ADMIN: "connectly", SELLER/DEFAULT: "setof")
- [ ] `sellerName`: String (SELLERë§Œ)
- [ ] `customPath`: String
- [ ] `fileId`: String (UUID v4)
- [ ] `extension`: String (MIMEì—ì„œ ì¶”ì¶œ)

**ë©”ì„œë“œ**:
- [ ] `static from(UserRole, Long tenantId, String sellerName, String customPath, String fileId, String mimeType)`: íŒ©í† ë¦¬ ë©”ì„œë“œ
- [ ] `getFullPath()`: ì „ì²´ ê²½ë¡œ ë°˜í™˜
  - ADMIN: `{tenantId}/connectly/{customPath}/{fileId}.{ext}`
  - SELLER: `{tenantId}/setof/{sellerName}/{customPath}/{fileId}.{ext}`
  - DEFAULT: `{tenantId}/setof/default/{customPath}/{fileId}.{ext}`
- [ ] `extractExtension(String mimeType)`: MIME â†’ í™•ì¥ì ë³€í™˜
  - `image/jpeg` â†’ `.jpg`
  - `image/png` â†’ `.png`
  - `text/html` â†’ `.html`

**êµ¬í˜„ ì˜ˆì‹œ**:
```java
/**
 * S3 ê²½ë¡œ VO
 *
 * <p>UserRoleì— ë”°ë¼ ë‹¤ë¥¸ ê²½ë¡œ êµ¬ì¡° ìƒì„±
 *
 * <p>ê²½ë¡œ íŒ¨í„´:
 * <ul>
 *   <li>ADMIN: {tenantId}/connectly/{customPath}/{fileId}.{ext}</li>
 *   <li>SELLER: {tenantId}/setof/{sellerName}/{customPath}/{fileId}.{ext}</li>
 *   <li>DEFAULT: {tenantId}/setof/default/{customPath}/{fileId}.{ext}</li>
 * </ul>
 *
 * @param tenantId í…Œë„ŒíŠ¸ ID
 * @param namespace ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ("connectly" or "setof")
 * @param sellerName ì…€ëŸ¬ëª… (SELLERë§Œ, ë‚˜ë¨¸ì§€ëŠ” null or "default")
 * @param customPath ì»¤ìŠ¤í…€ ê²½ë¡œ
 * @param fileId íŒŒì¼ ID (UUID)
 * @param extension í™•ì¥ì (ì˜ˆ: ".jpg")
 */
public record S3Path(
    Long tenantId,
    String namespace,
    String sellerName,
    String customPath,
    String fileId,
    String extension
) {
    public S3Path {
        if (tenantId == null || tenantId <= 0) {
            throw new IllegalArgumentException("tenantIdëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤");
        }
        if (namespace == null || namespace.isBlank()) {
            throw new IllegalArgumentException("namespaceëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤");
        }
        if (fileId == null || fileId.isBlank()) {
            throw new IllegalArgumentException("fileIdëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤");
        }
    }

    /**
     * S3Path ìƒì„± íŒ©í† ë¦¬ ë©”ì„œë“œ
     *
     * @param role ì‚¬ìš©ì ì—­í• 
     * @param tenantId í…Œë„ŒíŠ¸ ID
     * @param sellerName ì…€ëŸ¬ëª… (SELLERë§Œ í•„ìˆ˜)
     * @param customPath ì»¤ìŠ¤í…€ ê²½ë¡œ
     * @param fileId íŒŒì¼ ID
     * @param mimeType MIME íƒ€ì… (í™•ì¥ì ì¶”ì¶œìš©)
     * @return S3Path VO
     */
    public static S3Path from(
        UserRole role,
        Long tenantId,
        String sellerName,
        String customPath,
        String fileId,
        String mimeType
    ) {
        String namespace = role.getNamespace();
        String effectiveSellerName = role == UserRole.SELLER ? sellerName : "default";
        String extension = extractExtension(mimeType);

        return new S3Path(
            tenantId,
            namespace,
            effectiveSellerName,
            customPath,
            fileId,
            extension
        );
    }

    /**
     * S3 ì „ì²´ ê²½ë¡œ ë°˜í™˜
     *
     * @return S3 ê°ì²´ í‚¤ (ì˜ˆ: "123/setof/seller1/uploads/abc-123.jpg")
     */
    public String getFullPath() {
        String basePath = tenantId + "/" + namespace;

        if ("connectly".equals(namespace)) {
            // ADMIN: {tenantId}/connectly/{customPath}/{fileId}.{ext}
            return basePath + "/" + customPath + "/" + fileId + extension;
        } else {
            // SELLER/DEFAULT: {tenantId}/setof/{sellerName}/{customPath}/{fileId}.{ext}
            return basePath + "/" + sellerName + "/" + customPath + "/" + fileId + extension;
        }
    }

    /**
     * MIME íƒ€ì…ì—ì„œ í™•ì¥ì ì¶”ì¶œ
     *
     * @param mimeType MIME íƒ€ì…
     * @return í™•ì¥ì (ì˜ˆ: ".jpg", ".png", ".html")
     */
    private static String extractExtension(String mimeType) {
        return switch (mimeType) {
            case "image/jpeg" -> ".jpg";
            case "image/png" -> ".png";
            case "image/gif" -> ".gif";
            case "image/webp" -> ".webp";
            case "text/html" -> ".html";
            default -> "";
        };
    }
}
```

**UserRole** (Enum):
```java
/**
 * ì‚¬ìš©ì ì—­í•  Enum
 *
 * <p>ì—­í• ë³„ S3 ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ê²°ì •
 */
public enum UserRole {
    ADMIN("connectly"),
    SELLER("setof"),
    DEFAULT("setof");

    private final String namespace;

    UserRole(String namespace) {
        this.namespace = namespace;
    }

    /**
     * ì—­í• ë³„ S3 ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë°˜í™˜
     *
     * @return ADMIN: "connectly", SELLER/DEFAULT: "setof"
     */
    public String getNamespace() {
        return namespace;
    }
}
```

**UploadType** (Enum):
```java
/**
 * ì—…ë¡œë“œ íƒ€ì… Enum
 *
 * <p>ì—…ë¡œë“œ ë°©ì‹ë³„ ìµœëŒ€ íŒŒì¼ í¬ê¸° ì •ì˜
 */
public enum UploadType {
    SINGLE(5L * 1024 * 1024 * 1024),      // 5GB
    MULTIPART(5L * 1024 * 1024 * 1024 * 1024);  // 5TB

    private final long maxSize;

    UploadType(long maxSize) {
        this.maxSize = maxSize;
    }

    /**
     * ì—…ë¡œë“œ íƒ€ì…ë³„ ìµœëŒ€ íŒŒì¼ í¬ê¸° ë°˜í™˜
     *
     * @return ë°”ì´íŠ¸ ë‹¨ìœ„ ìµœëŒ€ í¬ê¸°
     */
    public long getMaxSize() {
        return maxSize;
    }
}
```

**SessionStatus** (Enum):
```java
/**
 * ì„¸ì…˜ ìƒíƒœ Enum
 *
 * <p>ìƒíƒœ ì „í™˜ ê·œì¹™: PREPARING â†’ ACTIVE â†’ {COMPLETED, EXPIRED, FAILED}
 */
public enum SessionStatus {
    PREPARING,
    ACTIVE,
    COMPLETED,
    EXPIRED,
    FAILED;

    /**
     * ë‹¤ìŒ ìƒíƒœë¡œ ì „í™˜ ê°€ëŠ¥í•œì§€ ê²€ì¦
     *
     * @param next ì „í™˜í•  ìƒíƒœ
     * @return ì „í™˜ ê°€ëŠ¥í•˜ë©´ true
     */
    public boolean canTransitionTo(SessionStatus next) {
        return switch (this) {
            case PREPARING -> next == ACTIVE;
            case ACTIVE -> next == COMPLETED || next == EXPIRED || next == FAILED;
            case COMPLETED, EXPIRED, FAILED -> false; // ìµœì¢… ìƒíƒœ
        };
    }
}
```

### 4. Domain Exceptions

**ëª¨ë“  Domain Exceptionì€ RuntimeException ìƒì†** (exception-guide.md ì¤€ìˆ˜)

**SessionErrorCode** (Enum):
```java
public enum SessionErrorCode {
    FILE_SIZE_EXCEEDED("FILE-SIZE-EXCEEDED", "íŒŒì¼ í¬ê¸°ê°€ ìµœëŒ€ í—ˆìš© í¬ê¸°ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤", 400),
    UNSUPPORTED_FILE_TYPE("UNSUPPORTED-FILE-TYPE", "ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ íƒ€ì…ì…ë‹ˆë‹¤", 400),
    INVALID_SESSION_STATUS("INVALID-SESSION-STATUS", "ì„¸ì…˜ ìƒíƒœ ì „í™˜ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤", 409),
    SESSION_EXPIRED("SESSION-EXPIRED", "ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤", 410);

    private final String code;
    private final String message;
    private final int httpStatus;

    SessionErrorCode(String code, String message, int httpStatus) {
        this.code = code;
        this.message = message;
        this.httpStatus = httpStatus;
    }

    public String getCode() { return code; }
    public String getMessage() { return message; }
    public int getHttpStatus() { return httpStatus; }
}
```

**Exception í´ë˜ìŠ¤**:
- [ ] `FileSizeExceededException extends DomainException`
  - ErrorCode: `FILE_SIZE_EXCEEDED`
  - ë©”ì‹œì§€: "íŒŒì¼ í¬ê¸°ê°€ ìµœëŒ€ í—ˆìš© í¬ê¸°ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. (ì‹¤ì œ: {actualSize}, ìµœëŒ€: {maxSize})"
  - HTTP Status: 400 (Bad Request)

- [ ] `UnsupportedFileTypeException extends DomainException`
  - ErrorCode: `UNSUPPORTED_FILE_TYPE`
  - ë©”ì‹œì§€: "ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ íƒ€ì…ì…ë‹ˆë‹¤. (ìš”ì²­: {mimeType}, í—ˆìš©: image/*, text/html)"
  - HTTP Status: 400 (Bad Request)

- [ ] `InvalidSessionStatusException extends DomainException`
  - ErrorCode: `INVALID_SESSION_STATUS`
  - ë©”ì‹œì§€: "ì„¸ì…˜ ìƒíƒœ ì „í™˜ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. (í˜„ì¬: {currentStatus}, ìš”ì²­: {requestedStatus})"
  - HTTP Status: 409 (Conflict)

- [ ] `SessionExpiredException extends DomainException`
  - ErrorCode: `SESSION_EXPIRED`
  - ë©”ì‹œì§€: "ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. (ë§Œë£Œ ì‹œê°: {expiresAt})"
  - HTTP Status: 410 (Gone)

**DomainException ê¸°ë³¸ í´ë˜ìŠ¤** (exception-guide.md íŒ¨í„´):
```java
public abstract class DomainException extends RuntimeException {
    private final String errorCode;
    private final int httpStatus;

    protected DomainException(SessionErrorCode errorCode, String message) {
        super(message);
        this.errorCode = errorCode.getCode();
        this.httpStatus = errorCode.getHttpStatus();
    }

    public String getErrorCode() {
        return errorCode;
    }

    public int getHttpStatus() {
        return httpStatus;
    }
}
```

### 5. Domain Events (ì„ íƒì )

- [ ] `UploadSessionCreated`: ì„¸ì…˜ ìƒì„± ì‹œ
  - `sessionId`, `userId`, `uploadType`
- [ ] `UploadSessionExpired`: ì„¸ì…˜ ë§Œë£Œ ì‹œ
  - `sessionId`, `uploadType`, `s3Path`
- [ ] `UploadCompleted`: ì—…ë¡œë“œ ì™„ë£Œ ì‹œ
  - `sessionId`, `fileId`, `userId`

---

## âš ï¸ ì œì•½ì‚¬í•­

### Zero-Tolerance ê·œì¹™

- [ ] **Lombok ê¸ˆì§€**: Pure Java ë˜ëŠ” Record ì‚¬ìš©
  - UploadSession, File: Plain Java Class
  - S3Path, Enums: Record ì‚¬ìš© ê°€ëŠ¥
- [ ] **Law of Demeter**: Getter ì²´ì´ë‹ ê¸ˆì§€
  - `session.getS3Path()` (O)
  - `session.getUser().getTenantId()` (X)
- [ ] **Tell, Don't Ask**: ìƒíƒœ ë…¸ì¶œë³´ë‹¤ ë©”ì„œë“œ ì œê³µ
  - `session.canComplete()` (O)
  - `if (session.getStatus() == ACTIVE)` (X)
- [ ] **Long FK ì „ëµ**: JPA ê´€ê³„ ì–´ë…¸í…Œì´ì…˜ ê¸ˆì§€
  - `private Long userId` (O)
  - `@ManyToOne private User user` (X)

### í…ŒìŠ¤íŠ¸ ê·œì¹™

- [ ] **TestFixture íŒ¨í„´ í•„ìˆ˜** (aggregate-archunit.md íŒ¨í„´):
  - âš ï¸ `create*()` ë©”ì„œë“œ ê¸ˆì§€
  - **forNew(), of(), reconstitute() íŒ¨í„´ ì‚¬ìš© í•„ìˆ˜**

**UploadSessionFixture**:
```java
public class UploadSessionFixture {
    /**
     * ì‹ ê·œ ì„¸ì…˜ Fixture (ID ìë™ ìƒì„±)
     */
    public static UploadSession forNew() {
        return UploadSession.forNew(
            UploadType.SINGLE,
            "test-path",
            FileName.from("test.jpg"),
            FileSize.of(1024 * 1024),  // 1MB
            MimeType.of("image/jpeg"),
            1L,  // userId
            1L,  // tenantId
            UserRole.DEFAULT,
            null,  // sellerName
            Clock.systemDefaultZone()
        );
    }

    /**
     * ID ê¸°ë°˜ ì„¸ì…˜ Fixture
     */
    public static UploadSession of(SessionId sessionId) {
        return UploadSession.of(
            sessionId,
            UploadType.SINGLE,
            // ... ë‚˜ë¨¸ì§€ íŒŒë¼ë¯¸í„°
        );
    }

    /**
     * ì˜ì†ì„± ë³µì› Fixture (ëª¨ë“  í•„ë“œ í¬í•¨)
     */
    public static UploadSession reconstitute(SessionId sessionId, SessionStatus status) {
        return UploadSession.reconstitute(
            sessionId,
            // ... ëª¨ë“  í•„ë“œ
        );
    }
}
```

**FileFixture**:
```java
public class FileFixture {
    public static File forNew() { ... }
    public static File of(SessionId fileId) { ... }
    public static File reconstitute(SessionId fileId, boolean deleted) { ... }
}
```

- [ ] **ArchUnit í…ŒìŠ¤íŠ¸ 32ê°œ ê·œì¹™** (aggregate-archunit.md + vo-archunit.md):

**Aggregate ê·œì¹™ (24ê°œ)**:
1. Lombok ê¸ˆì§€ (@Data, @Builder, @Getter, @Setter)
2. JPA ê´€ê³„ ì–´ë…¸í…Œì´ì…˜ ê¸ˆì§€ (@ManyToOne, @OneToMany, @OneToOne, @ManyToMany)
3. Setter ë©”ì„œë“œ ê¸ˆì§€ (setXxx)
4. ìƒì„±ì private ê°•ì œ
5. forNew() ì •ì  ë©”ì„œë“œ í•„ìˆ˜
6. of() ì •ì  ë©”ì„œë“œ í•„ìˆ˜
7. reconstitute() ì •ì  ë©”ì„œë“œ í•„ìˆ˜
8. create*() ë©”ì„œë“œ ê¸ˆì§€
9. Clock í•„ë“œ í•„ìˆ˜
10. createdAt í•„ë“œ í•„ìˆ˜
11. updatedAt í•„ë“œ í•„ìˆ˜
12. getId() ë©”ì„œë“œ í•„ìˆ˜
13. getIdValue() ë©”ì„œë“œ í•„ìˆ˜ (Law of Demeter)
14. Tell Don't Ask ë©”ì„œë“œ (is*, can*)
15. ~ 24. (ê¸°íƒ€ aggregate-archunit.md ê·œì¹™)

**Value Object ê·œì¹™ (8ê°œ)**:
1. Record ì‚¬ìš© í•„ìˆ˜
2. Lombok ê¸ˆì§€
3. of() ì •ì  ë©”ì„œë“œ í•„ìˆ˜
4. ID VOëŠ” forNew() í•„ìˆ˜
5. ID VOëŠ” isNew() í•„ìˆ˜
6. Compact Constructor ê²€ì¦ ë¡œì§ í•„ìˆ˜
7. ~ 8. (ê¸°íƒ€ vo-archunit.md ê·œì¹™)

- [ ] **í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ > 80%**:
  - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë©”ì„œë“œ 100% ì»¤ë²„ë¦¬ì§€
  - ì˜ˆì™¸ ì‹œë‚˜ë¦¬ì˜¤ í¬í•¨

---

## âœ… ì™„ë£Œ ì¡°ê±´

### êµ¬í˜„ ì™„ë£Œ
- [ ] UploadSession Aggregate êµ¬í˜„ ì™„ë£Œ
- [ ] File Aggregate êµ¬í˜„ ì™„ë£Œ
- [ ] SessionId, FileName, FileSize, MimeType Value Object êµ¬í˜„ ì™„ë£Œ
- [ ] S3Path Value Object êµ¬í˜„ ì™„ë£Œ
- [ ] UserRole, UploadType, SessionStatus Enum êµ¬í˜„ ì™„ë£Œ
- [ ] Domain Exception 4ì¢… êµ¬í˜„ ì™„ë£Œ

### í…ŒìŠ¤íŠ¸ ì™„ë£Œ
- [ ] SessionId Unit Test (3+ í…ŒìŠ¤íŠ¸)
  - UUID í˜•ì‹ ê²€ì¦ (ì •ìƒ, ì˜ëª»ëœ í˜•ì‹)
  - generate() ë©”ì„œë“œ
  - from() ë©”ì„œë“œ
- [ ] FileName Unit Test (5+ í…ŒìŠ¤íŠ¸)
  - ì •ìƒ íŒŒì¼ ì´ë¦„
  - null, ë¹ˆ ë¬¸ìì—´
  - ê¸¸ì´ ì´ˆê³¼ (>255ì)
  - í™•ì¥ì ì¶”ì¶œ
  - withoutExtension()
- [ ] FileSize Unit Test (5+ í…ŒìŠ¤íŠ¸)
  - ì •ìƒ í¬ê¸°
  - 0 ì´í•˜ í¬ê¸°
  - ì—…ë¡œë“œ íƒ€ì…ë³„ ê²€ì¦ (SINGLE 100MB, MULTIPART 1GB)
  - í¬ê¸° ë¹„êµ (isLargerThan)
  - ë‹¨ìœ„ ë³€í™˜ (toMB, toGB)
- [ ] MimeType Unit Test (5+ í…ŒìŠ¤íŠ¸)
  - í—ˆìš© íƒ€ì… (image/jpeg, image/png, text/html)
  - ë¶ˆí—ˆ íƒ€ì…
  - í™•ì¥ì ì¶”ì¶œ
  - isImage(), isHtml()
- [ ] UploadSession Unit Test (10+ í…ŒìŠ¤íŠ¸)
  - ì„¸ì…˜ ìƒì„± (ì •ìƒ, í¬ê¸° ì´ˆê³¼, íƒ€ì… ì˜¤ë¥˜)
  - ìƒíƒœ ì „í™˜ (activate, complete, expire, fail)
  - ë§Œë£Œ ì—¬ë¶€ ê²€ì¦
  - ì™„ë£Œ ê°€ëŠ¥ ì—¬ë¶€ ê²€ì¦
- [ ] File Unit Test (5+ í…ŒìŠ¤íŠ¸)
  - íŒŒì¼ ìƒì„±
  - ë…¼ë¦¬ ì‚­ì œ
- [ ] S3Path Unit Test (5+ í…ŒìŠ¤íŠ¸)
  - ADMIN ê²½ë¡œ ìƒì„±
  - SELLER ê²½ë¡œ ìƒì„±
  - DEFAULT ê²½ë¡œ ìƒì„±
  - í™•ì¥ì ì¶”ì¶œ
- [ ] ArchUnit Test (3+ ê·œì¹™)
  - Domain Layer ì˜ì¡´ì„± ê²€ì¦
  - Lombok ê¸ˆì§€ ê²€ì¦
  - Long FK ì „ëµ ê²€ì¦

### í’ˆì§ˆ ê²€ì¦
- [ ] ëª¨ë“  Unit Test í†µê³¼
- [ ] ëª¨ë“  ArchUnit Test í†µê³¼
- [ ] í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ > 80%
- [ ] Zero-Tolerance ê·œì¹™ ì¤€ìˆ˜ (ìˆ˜ë™ í™•ì¸)
- [ ] ì½”ë“œ ë¦¬ë·° ìŠ¹ì¸

---

## ğŸ“‚ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
domain/src/main/java/com/fileflow/domain/
â”œâ”€â”€ session/
â”‚   â”œâ”€â”€ UploadSession.java           (Aggregate Root)
â”‚   â”œâ”€â”€ SessionStatus.java           (Enum)
â”‚   â”œâ”€â”€ UploadType.java              (Enum)
â”‚   â”œâ”€â”€ vo/
â”‚   â”‚   â”œâ”€â”€ SessionId.java           (Value Object)
â”‚   â”‚   â”œâ”€â”€ FileName.java            (Value Object)
â”‚   â”‚   â”œâ”€â”€ FileSize.java            (Value Object)
â”‚   â”‚   â””â”€â”€ MimeType.java            (Value Object)
â”‚   â””â”€â”€ exception/
â”‚       â”œâ”€â”€ FileSizeExceededException.java
â”‚       â”œâ”€â”€ UnsupportedFileTypeException.java
â”‚       â”œâ”€â”€ InvalidSessionStatusException.java
â”‚       â””â”€â”€ SessionExpiredException.java
â”œâ”€â”€ file/
â”‚   â””â”€â”€ File.java                    (Aggregate Root)
â”œâ”€â”€ common/
â”‚   â”œâ”€â”€ S3Path.java                  (Value Object)
â”‚   â””â”€â”€ UserRole.java                (Enum)
â””â”€â”€ event/
    â”œâ”€â”€ UploadSessionCreated.java    (ì„ íƒì )
    â”œâ”€â”€ UploadSessionExpired.java    (ì„ íƒì )
    â””â”€â”€ UploadCompleted.java         (ì„ íƒì )

domain/src/test/java/com/fileflow/domain/
â”œâ”€â”€ session/
â”‚   â”œâ”€â”€ UploadSessionTest.java
â”‚   â”œâ”€â”€ UploadSessionFixture.java
â”‚   â””â”€â”€ vo/
â”‚       â”œâ”€â”€ SessionIdTest.java
â”‚       â”œâ”€â”€ FileNameTest.java
â”‚       â”œâ”€â”€ FileSizeTest.java
â”‚       â””â”€â”€ MimeTypeTest.java
â”œâ”€â”€ file/
â”‚   â”œâ”€â”€ FileTest.java
â”‚   â””â”€â”€ FileFixture.java
â”œâ”€â”€ common/
â”‚   â””â”€â”€ S3PathTest.java
â””â”€â”€ architecture/
    â””â”€â”€ DomainLayerArchitectureTest.java  (ArchUnit)
```

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

- **PRD**: `/Users/sangwon-ryu/fileflow/docs/prd/presigned-url-upload.md`
- **Plan**: `docs/prd/plans/FILE-006-001-domain-plan.md` (create-plan í›„ ìƒì„±)
- **Jira**: (sync-to-jira í›„ ì¶”ê°€)
- **Domain Layer ê·œì¹™**: `docs/coding_convention/02-domain-layer/`

---

## ğŸ“ ì°¸ê³ ì‚¬í•­

### TDD ì§„í–‰ ìˆœì„œ (ê¶Œì¥)

1. **Value Objects ë¨¼ì €** (ì˜ì¡´ì„± ì—†ìŒ):
   - S3Path, UserRole, UploadType, SessionStatus
2. **Domain Exceptions**:
   - 4ì¢… ì˜ˆì™¸ í´ë˜ìŠ¤
3. **UploadSession Aggregate**:
   - íŒ©í† ë¦¬ ë©”ì„œë“œ â†’ ìƒíƒœ ì „í™˜ ë©”ì„œë“œ ìˆœ
4. **File Aggregate**:
   - UploadSession ì˜ì¡´ì„± ìˆìŒ

### ì£¼ìš” ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] íŒŒì¼ í¬ê¸° ê²€ì¦: SINGLE(100MB), MULTIPART(1GB)
- [ ] íŒŒì¼ íƒ€ì… ê²€ì¦: `image/*`, `text/html`
- [ ] S3 ê²½ë¡œ ìƒì„±: Roleë³„ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì ìš©
- [ ] ì„¸ì…˜ ë§Œë£Œ: 15ë¶„ ê³ ì •
- [ ] ìƒíƒœ ì „í™˜: PREPARING â†’ ACTIVE â†’ {COMPLETED, EXPIRED, FAILED}
- [ ] ë…¼ë¦¬ ì‚­ì œ: `deleted = true`, `deletedAt` ì„¤ì •

---

**ë‹¤ìŒ ë‹¨ê³„**:
1. `/create-plan FILE-006-001` - TDD Plan ìƒì„±
2. `/kb/domain/go` - TDD ì‚¬ì´í´ ì‹œì‘
3. êµ¬í˜„ ì™„ë£Œ í›„ FILE-006-002 (Application Layer) ì‹œì‘
