# FILE-006-004: REST API Layer êµ¬í˜„

**Epic**: File Upload Presigned URL System
**Layer**: REST API Layer
**ë¸Œëœì¹˜**: feature/FILE-006-004-rest-api
**Jira URL**: (sync-to-jira í›„ ì¶”ê°€)

---

## ğŸ“ ëª©ì 

íŒŒì¼ ì—…ë¡œë“œ ì„¸ì…˜ ë° íŒŒì¼ ê´€ë¦¬ REST API ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„

**í•µì‹¬ ì—­í• **:
- RESTful API ì„¤ê³„ ë° êµ¬í˜„
- JWT ì¸ì¦/ì¸ê°€ ì²˜ë¦¬
- Request/Response DTO ì •ì˜ ë° Validation
- ì¼ê´€ëœ Error Handling

---

## ğŸ¯ ìš”êµ¬ì‚¬í•­

### 1. API ì—”ë“œí¬ì¸íŠ¸

| Method | Path | Description | Auth | Request DTO | Response DTO | Status Code |
|--------|------|-------------|------|-------------|--------------|-------------|
| POST | /api/v1/upload-sessions | Presigned URL ìƒì„± | JWT | PrepareUploadRequest | PrepareUploadResponse | 200 OK |
| POST | /api/v1/upload-sessions/{sessionId}/complete | ì—…ë¡œë“œ ì™„ë£Œ | JWT | - | FileResponse | 200 OK |
| POST | /api/v1/upload-sessions/{sessionId}/abort | ì—…ë¡œë“œ ì·¨ì†Œ | JWT | - | - | 204 No Content |
| GET | /api/v1/upload-sessions/{sessionId} | ì„¸ì…˜ ì¡°íšŒ | JWT | - | UploadSessionResponse | 200 OK |
| GET | /api/v1/files/{fileId} | íŒŒì¼ ì¡°íšŒ | JWT | - | FileDetailResponse | 200 OK |
| GET | /api/v1/files | íŒŒì¼ ëª©ë¡ ì¡°íšŒ | JWT | - | PageResponse<FileSummaryResponse> | 200 OK |
| PATCH | /api/v1/files/{fileId}/delete | íŒŒì¼ ì‚­ì œ (ë…¼ë¦¬) | JWT | - | - | 204 No Content |

### 2. Controller êµ¬í˜„

#### UploadSessionApiController

**ì—”ë“œí¬ì¸íŠ¸ 1**: POST /api/v1/upload-sessions

**Request DTO**:
```java
public record PrepareUploadRequest(
    @NotBlank(message = "ì„¸ì…˜ IDëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤")
    String sessionId,

    @NotNull(message = "ì—…ë¡œë“œ íƒ€ì…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤")
    UploadType uploadType,

    @NotBlank(message = "íŒŒì¼ ê²½ë¡œëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤")
    String customPath,

    @NotBlank(message = "íŒŒì¼ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤")
    String fileName,

    @NotNull(message = "íŒŒì¼ í¬ê¸°ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤")
    @Min(value = 1, message = "íŒŒì¼ í¬ê¸°ëŠ” 1ë°”ì´íŠ¸ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤")
    @Max(value = 1073741824, message = "íŒŒì¼ í¬ê¸°ëŠ” 1GBë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤")
    Long fileSize,

    @NotBlank(message = "MIME íƒ€ì…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤")
    String mimeType
) {}
```

**Response DTO**:
```java
public record PrepareUploadResponse(
    String sessionId,
    String fileId,
    UploadType uploadType,
    String uploadUrl,              // SINGLEì¸ ê²½ìš°
    List<PartUploadUrl> partUploadUrls,  // MULTIPARTì¸ ê²½ìš°
    LocalDateTime expiresAt
) {
    public record PartUploadUrl(
        int partNumber,
        String uploadUrl
    ) {}

    /**
     * Domain â†’ Response ë³€í™˜ (response-dto-guide.md ì¤€ìˆ˜)
     * @param result SessionPreparationResult (Application Layer DTO)
     */
    public static PrepareUploadResponse from(SessionPreparationResult result) {
        return new PrepareUploadResponse(
            result.sessionId(),
            result.fileId(),
            result.uploadType(),
            result.uploadUrl(),
            result.partUploadUrls() == null ? null :
                result.partUploadUrls().stream()
                    .map(part -> new PartUploadUrl(part.partNumber(), part.uploadUrl()))
                    .toList(),
            result.expiresAt()
        );
    }
}
```

**UploadSessionResponse DTO**:
```java
/**
 * ì—…ë¡œë“œ ì„¸ì…˜ ì¡°íšŒ ì‘ë‹µ DTO
 *
 * <p>GET /api/v1/upload-sessions/{sessionId} ì‘ë‹µ
 */
public record UploadSessionResponse(
    String sessionId,
    String fileId,
    UploadType uploadType,
    SessionStatus status,
    LocalDateTime expiresAt,
    LocalDateTime createdAt
) {
    /**
     * Domain â†’ Response ë³€í™˜ (response-dto-guide.md ì¤€ìˆ˜)
     * @param session UploadSession Aggregate Root
     */
    public static UploadSessionResponse from(UploadSession session) {
        return new UploadSessionResponse(
            session.getSessionIdValue(),   // Law of Demeter
            session.getFileIdValue(),      // Law of Demeter
            session.getUploadType(),
            session.getStatus(),
            session.getExpiresAt(),
            session.getCreatedAt()
        );
    }
}
```

**êµ¬í˜„**:
```java
@RestController
@RequestMapping("/api/v1/upload-sessions")
public class UploadSessionApiController {
    private final PrepareUploadInPort prepareUploadUseCase;

    @PostMapping
    public ResponseEntity<PrepareUploadResponse> prepareUpload(
        @Valid @RequestBody PrepareUploadRequest request,
        @AuthenticationPrincipal JwtUser jwtUser
    ) {
        UserContext userContext = UserContext.from(jwtUser);  // UserContext.from() ì‚¬ìš©
        PrepareUploadCommand command = PrepareUploadMapper.toCommand(request, userContext);
        SessionPreparationResult result = prepareUploadUseCase.execute(command);
        PrepareUploadResponse response = PrepareUploadResponse.from(result);
        return ResponseEntity.ok(response);
    }
}
```

**ì—”ë“œí¬ì¸íŠ¸ 2**: POST /api/v1/upload-sessions/{sessionId}/complete

**êµ¬í˜„**:
```java
@PostMapping("/{sessionId}/complete")
public ResponseEntity<FileDetailResponse> completeUpload(
    @PathVariable String sessionId,
    @AuthenticationPrincipal JwtUser jwtUser
) {
    UserContext userContext = UserContext.from(jwtUser);
    CompleteUploadCommand command = new CompleteUploadCommand(sessionId, userContext);
    File file = completeUploadUseCase.execute(command);
    FileDetailResponse response = FileDetailResponse.from(file);
    return ResponseEntity.ok(response);
}
```

**ì—”ë“œí¬ì¸íŠ¸ 3**: POST /api/v1/upload-sessions/{sessionId}/abort

**êµ¬í˜„**:
```java
@PostMapping("/{sessionId}/abort")
public ResponseEntity<Void> abortUpload(
    @PathVariable String sessionId,
    @AuthenticationPrincipal JwtUser jwtUser
) {
    UserContext userContext = UserContext.from(jwtUser);
    AbortUploadCommand command = new AbortUploadCommand(sessionId, userContext);
    abortUploadUseCase.execute(command);
    return ResponseEntity.noContent().build();
}
```

**ì—”ë“œí¬ì¸íŠ¸ 4**: GET /api/v1/upload-sessions/{sessionId}

**êµ¬í˜„**:
```java
@GetMapping("/{sessionId}")
public ResponseEntity<UploadSessionResponse> getUploadSession(
    @PathVariable String sessionId,
    @AuthenticationPrincipal JwtUser jwtUser
) {
    UserContext userContext = UserContext.from(jwtUser);
    GetUploadSessionQuery query = new GetUploadSessionQuery(sessionId, userContext);
    UploadSession session = getUploadSessionUseCase.execute(query);
    UploadSessionResponse response = UploadSessionResponse.from(session);
    return ResponseEntity.ok(response);
}
```

#### FileApiController

**ì—”ë“œí¬ì¸íŠ¸ 1**: GET /api/v1/files/{fileId}

**Response DTO**:
```java
public record FileDetailResponse(
    String fileId,
    String fileName,
    Long fileSize,
    String mimeType,
    String s3Path,
    UploadType uploadType,
    LocalDateTime uploadedAt
) {
    /**
     * Domain â†’ Response ë³€í™˜ (response-dto-guide.md ì¤€ìˆ˜)
     * @param file File Aggregate Root
     */
    public static FileDetailResponse from(File file) {
        return new FileDetailResponse(
            file.getFileIdValue(),        // Law of Demeter
            file.getFileNameValue(),
            file.getFileSizeBytes(),
            file.getMimeTypeValue(),
            file.getS3PathValue(),
            file.getUploadType(),
            file.getUploadedAt()
        );
    }
}
```

**êµ¬í˜„**:
```java
@RestController
@RequestMapping("/api/v1/files")
public class FileApiController {
    private final GetFileInPort getFileUseCase;
    private final ListFilesInPort listFilesUseCase;

    @GetMapping("/{fileId}")
    public ResponseEntity<FileDetailResponse> getFile(
        @PathVariable String fileId,
        @AuthenticationPrincipal JwtUser jwtUser
    ) {
        UserContext userContext = UserContext.from(jwtUser);
        GetFileQuery query = new GetFileQuery(fileId, userContext);
        File file = getFileUseCase.execute(query);
        FileDetailResponse response = FileDetailResponse.from(file);
        return ResponseEntity.ok(response);
    }
}
```

**ì—”ë“œí¬ì¸íŠ¸ 2**: GET /api/v1/files

**Request Parameters**:
- `page` (optional, default: 0)
- `size` (optional, default: 20)

**Response DTO**:
```java
public record PageResponse<T>(
    List<T> content,
    int page,
    int size,
    long totalElements,
    int totalPages
) {
    /**
     * Domain List â†’ PageResponse ë³€í™˜
     */
    public static <T> PageResponse<T> of(List<T> content, int page, int size, long totalElements) {
        int totalPages = (int) Math.ceil((double) totalElements / size);
        return new PageResponse<>(content, page, size, totalElements, totalPages);
    }
}

public record FileSummaryResponse(
    String fileId,
    String fileName,
    Long fileSize,
    String mimeType,
    LocalDateTime uploadedAt
) {
    /**
     * Domain â†’ Response ë³€í™˜ (response-dto-guide.md ì¤€ìˆ˜)
     * @param file File Aggregate Root
     */
    public static FileSummaryResponse from(File file) {
        return new FileSummaryResponse(
            file.getFileIdValue(),        // Law of Demeter
            file.getFileNameValue(),
            file.getFileSizeBytes(),
            file.getMimeTypeValue(),
            file.getUploadedAt()
        );
    }
}
```

**êµ¬í˜„**:
```java
@GetMapping
public ResponseEntity<PageResponse<FileSummaryResponse>> listFiles(
    @RequestParam(defaultValue = "0") int page,
    @RequestParam(defaultValue = "20") int size,
    @AuthenticationPrincipal JwtUser jwtUser
) {
    UserContext userContext = UserContext.from(jwtUser);
    ListFilesQuery query = new ListFilesQuery(userContext.userId(), page, size);
    List<File> files = listFilesUseCase.execute(query);
    List<FileSummaryResponse> content = files.stream()
        .map(FileSummaryResponse::from)
        .toList();
    PageResponse<FileSummaryResponse> response = PageResponse.of(
        content, page, size, files.size()
    );
    return ResponseEntity.ok(response);
}
```

**ì—”ë“œí¬ì¸íŠ¸ 3**: PATCH /api/v1/files/{fileId}/delete

**âš ï¸ DELETE ë©”ì„œë“œ ê¸ˆì§€** (controller-guide.md ì¤€ìˆ˜):
- DELETEëŠ” ë¬¼ë¦¬ ì‚­ì œ ì˜ë¯¸ (ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì™„ì „ ì œê±°)
- ë…¼ë¦¬ ì‚­ì œëŠ” ìƒíƒœ ë³€ê²½ì´ë¯€ë¡œ **PATCH ì‚¬ìš© í•„ìˆ˜**
- ë°ì´í„° ë³µêµ¬ ê°€ëŠ¥ + ê°ì‚¬ ì¶”ì  ë³´ì¥

**êµ¬í˜„**:
```java
@PatchMapping("/{fileId}/delete")
public ResponseEntity<Void> softDeleteFile(
    @PathVariable String fileId,
    @AuthenticationPrincipal JwtUser jwtUser
) {
    UserContext userContext = UserContext.from(jwtUser);
    DeleteFileCommand command = new DeleteFileCommand(fileId, userContext);
    deleteFileUseCase.execute(command);
    return ResponseEntity.noContent().build();
}
```

### 3. Error Handling

#### GlobalExceptionHandler

**ì—ëŸ¬ ì‘ë‹µ í˜•ì‹**:
```java
public record ErrorResponse(
    String errorCode,
    String message,
    LocalDateTime timestamp,
    String path
) {}
```

**ì˜ˆì™¸ ë§¤í•‘**:
- [ ] `FileSizeExceededException` â†’ 400 Bad Request
- [ ] `UnsupportedFileTypeException` â†’ 400 Bad Request
- [ ] `InvalidSessionStatusException` â†’ 409 Conflict
- [ ] `SessionExpiredException` â†’ 410 Gone
- [ ] `SessionNotFoundException` â†’ 404 Not Found
- [ ] `FileNotFoundException` â†’ 404 Not Found
- [ ] `UnauthorizedAccessException` â†’ 403 Forbidden
- [ ] `RedisConnectionException` â†’ 503 Service Unavailable
- [ ] `MethodArgumentNotValidException` â†’ 400 Bad Request (Validation ì‹¤íŒ¨)
- [ ] `Exception` â†’ 500 Internal Server Error

**êµ¬í˜„**:
```java
@RestControllerAdvice
public class GlobalExceptionHandler {
    @ExceptionHandler(FileSizeExceededException.class)
    public ResponseEntity<ErrorResponse> handleFileSizeExceeded(
        FileSizeExceededException ex,
        HttpServletRequest request
    ) {
        ErrorResponse error = new ErrorResponse(
            "FILE_SIZE_EXCEEDED",
            ex.getMessage(),
            LocalDateTime.now(),
            request.getRequestURI()
        );
        return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(error);
    }

    // ... ë‚˜ë¨¸ì§€ ì˜ˆì™¸ í•¸ë“¤ëŸ¬
}
```

**Validation ì—ëŸ¬ ì‘ë‹µ**:
```java
@ExceptionHandler(MethodArgumentNotValidException.class)
public ResponseEntity<ValidationErrorResponse> handleValidationException(
    MethodArgumentNotValidException ex,
    HttpServletRequest request
) {
    List<FieldError> fieldErrors = ex.getBindingResult().getFieldErrors()
        .stream()
        .map(error -> new FieldError(
            error.getField(),
            error.getDefaultMessage()
        ))
        .toList();

    ValidationErrorResponse error = new ValidationErrorResponse(
        "VALIDATION_FAILED",
        "ìš”ì²­ ë°ì´í„° ê²€ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",
        fieldErrors,
        LocalDateTime.now(),
        request.getRequestURI()
    );
    return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(error);
}
```

### 4. Mapper

âš ï¸ **UserContextMapper ë¶ˆí•„ìš”** (mapper-guide.md ì¤€ìˆ˜):
- UserContext.from(JwtUser) ì‚¬ìš© (DTO ìì²´ì— from() ë©”ì„œë“œ í¬í•¨)
- Mapper í´ë˜ìŠ¤ ìƒì„± ê¸ˆì§€

#### PrepareUploadMapper

**êµ¬í˜„**:
```java
public class PrepareUploadMapper {
    public static PrepareUploadCommand toCommand(
        PrepareUploadRequest request,
        UserContext userContext
    ) {
        return new PrepareUploadCommand(
            request.sessionId(),
            request.uploadType(),
            request.customPath(),
            request.fileName(),
            request.fileSize(),
            request.mimeType(),
            userContext
        );
    }
}
```

### 5. Security Configuration

#### JwtAuthenticationFilter

**êµ¬í˜„**:
```java
@Component
public class JwtAuthenticationFilter extends OncePerRequestFilter {
    private final JwtTokenProvider jwtTokenProvider;

    @Override
    protected void doFilterInternal(
        HttpServletRequest request,
        HttpServletResponse response,
        FilterChain filterChain
    ) throws ServletException, IOException {
        String token = extractToken(request);
        if (token != null && jwtTokenProvider.validateToken(token)) {
            JwtUser jwtUser = jwtTokenProvider.getUser(token);
            Authentication auth = new UsernamePasswordAuthenticationToken(
                jwtUser, null, jwtUser.getAuthorities()
            );
            SecurityContextHolder.getContext().setAuthentication(auth);
        }
        filterChain.doFilter(request, response);
    }

    private String extractToken(HttpServletRequest request) {
        String bearerToken = request.getHeader("Authorization");
        if (bearerToken != null && bearerToken.startsWith("Bearer ")) {
            return bearerToken.substring(7);
        }
        return null;
    }
}
```

#### SecurityConfig

**êµ¬í˜„**:
```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .csrf().disable()
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/api/v1/**").authenticated()
                .anyRequest().permitAll()
            )
            .addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.class);
        return http.build();
    }
}
```

### 6. API Documentation (Spring REST Docs)

**MockMvc í…ŒìŠ¤íŠ¸ ì˜ˆì‹œ**:
```java
@Test
void shouldPrepareUpload() throws Exception {
    // Given
    PrepareUploadRequest request = new PrepareUploadRequest(
        UUID.randomUUID().toString(),
        UploadType.SINGLE,
        "uploads/documents",
        "test.jpg",
        1024L,
        "image/jpeg"
    );

    // When & Then
    mockMvc.perform(post("/api/v1/upload-sessions")
            .contentType(MediaType.APPLICATION_JSON)
            .header("Authorization", "Bearer " + jwtToken)
            .content(objectMapper.writeValueAsString(request)))
        .andExpect(status().isOk())
        .andExpect(jsonPath("$.sessionId").exists())
        .andExpect(jsonPath("$.uploadUrl").exists())
        .andDo(document("prepare-upload",
            requestFields(
                fieldWithPath("sessionId").description("ì„¸ì…˜ ID (UUID)"),
                fieldWithPath("uploadType").description("ì—…ë¡œë“œ íƒ€ì…"),
                fieldWithPath("customPath").description("S3 ì»¤ìŠ¤í…€ ê²½ë¡œ"),
                fieldWithPath("fileName").description("íŒŒì¼ëª…"),
                fieldWithPath("fileSize").description("íŒŒì¼ í¬ê¸° (bytes)"),
                fieldWithPath("mimeType").description("MIME íƒ€ì…")
            ),
            responseFields(
                fieldWithPath("sessionId").description("ì„¸ì…˜ ID"),
                fieldWithPath("fileId").description("íŒŒì¼ ID"),
                fieldWithPath("uploadType").description("ì—…ë¡œë“œ íƒ€ì…"),
                fieldWithPath("uploadUrl").description("ì—…ë¡œë“œ URL"),
                fieldWithPath("expiresAt").description("ë§Œë£Œ ì‹œê°")
            )
        ));
}
```

---

## âš ï¸ ì œì•½ì‚¬í•­

### Zero-Tolerance ê·œì¹™

- [ ] **RESTful ì„¤ê³„ ì›ì¹™**:
  - ë¦¬ì†ŒìŠ¤ ì¤‘ì‹¬ URL ì„¤ê³„
  - HTTP Method ì˜ë¯¸ë¡ ì  ì‚¬ìš©
  - ìƒíƒœ ì½”ë“œ ì •í™•í•œ ì‚¬ìš©
- [ ] **Validation í•„ìˆ˜**:
  - `@Valid` ì‚¬ìš©
  - ì»¤ìŠ¤í…€ Validator (í•„ìš” ì‹œ)
- [ ] **ì¼ê´€ëœ Error Response**:
  - ErrorResponse DTO í†µì¼
  - errorCode ëª…ëª… ê·œì¹™ ì¤€ìˆ˜
- [ ] **MockMvc ê¸ˆì§€** (Integration Test ì œì™¸):
  - Controller ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ëŠ” MockMvc ì‚¬ìš©
  - E2E í…ŒìŠ¤íŠ¸ëŠ” TestRestTemplate ì‚¬ìš©

### í…ŒìŠ¤íŠ¸ ê·œì¹™

- [ ] **ArchUnit í…ŒìŠ¤íŠ¸ í•„ìˆ˜**:
  - REST API LayerëŠ” Applicationì—ë§Œ ì˜ì¡´
  - ControllerëŠ” InPortë§Œ ì˜ì¡´
- [ ] **MockMvc í…ŒìŠ¤íŠ¸** (Controller ë‹¨ìœ„):
  - ê° ì—”ë“œí¬ì¸íŠ¸ë³„ ì •ìƒ/ì˜ˆì™¸ ì‹œë‚˜ë¦¬ì˜¤
  - Validation í…ŒìŠ¤íŠ¸
- [ ] **Spring REST Docs**:
  - ëª¨ë“  API ë¬¸ì„œí™”
- [ ] **í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ > 80%**:
  - Controller ë©”ì„œë“œ 100% ì»¤ë²„ë¦¬ì§€

---

## âœ… ì™„ë£Œ ì¡°ê±´

### êµ¬í˜„ ì™„ë£Œ
- [ ] UploadSessionApiController êµ¬í˜„ (4ê°œ ì—”ë“œí¬ì¸íŠ¸)
- [ ] FileApiController êµ¬í˜„ (3ê°œ ì—”ë“œí¬ì¸íŠ¸)
- [ ] Request/Response DTO ì •ì˜ (7ê°œ)
- [ ] GlobalExceptionHandler êµ¬í˜„ (10ê°œ ì˜ˆì™¸)
- [ ] Mapper êµ¬í˜„ (2ê°œ)
- [ ] JwtAuthenticationFilter êµ¬í˜„
- [ ] SecurityConfig êµ¬í˜„

### í…ŒìŠ¤íŠ¸ ì™„ë£Œ
- [ ] UploadSessionApiController Test (15+ í…ŒìŠ¤íŠ¸)
  - prepareUpload: ì •ìƒ, Validation ì‹¤íŒ¨, ì¸ì¦ ì‹¤íŒ¨
  - completeUpload: ì •ìƒ, ì„¸ì…˜ ì—†ìŒ, ê¶Œí•œ ì—†ìŒ
  - abortUpload: ì •ìƒ, ì„¸ì…˜ ì—†ìŒ
  - getUploadSession: ì •ìƒ, ì„¸ì…˜ ì—†ìŒ
- [ ] FileApiController Test (10+ í…ŒìŠ¤íŠ¸)
  - getFile: ì •ìƒ, íŒŒì¼ ì—†ìŒ, ê¶Œí•œ ì—†ìŒ
  - listFiles: ì •ìƒ, í˜ì´ì§•
  - deleteFile: ì •ìƒ, íŒŒì¼ ì—†ìŒ
- [ ] GlobalExceptionHandler Test (10+ í…ŒìŠ¤íŠ¸)
  - ê° ì˜ˆì™¸ë³„ ì‘ë‹µ ê²€ì¦
- [ ] Spring REST Docs (7ê°œ API)
- [ ] ArchUnit Test (3+ ê·œì¹™)

### í’ˆì§ˆ ê²€ì¦
- [ ] ëª¨ë“  MockMvc Test í†µê³¼
- [ ] ëª¨ë“  ArchUnit Test í†µê³¼
- [ ] í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ > 80%
- [ ] API ë¬¸ì„œ ìƒì„± í™•ì¸
- [ ] ì½”ë“œ ë¦¬ë·° ìŠ¹ì¸

---

## ğŸ“‚ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
adapter-rest-api/src/main/java/com/fileflow/adapter/restapi/
â”œâ”€â”€ session/
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â””â”€â”€ UploadSessionApiController.java
â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”œâ”€â”€ request/
â”‚   â”‚   â”‚   â””â”€â”€ PrepareUploadRequest.java
â”‚   â”‚   â””â”€â”€ response/
â”‚   â”‚       â”œâ”€â”€ PrepareUploadResponse.java
â”‚   â”‚       â””â”€â”€ UploadSessionResponse.java
â”‚   â””â”€â”€ mapper/
â”‚       â””â”€â”€ PrepareUploadMapper.java
â”œâ”€â”€ file/
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â””â”€â”€ FileApiController.java
â”‚   â””â”€â”€ dto/
â”‚       â””â”€â”€ response/
â”‚           â”œâ”€â”€ FileDetailResponse.java
â”‚           â””â”€â”€ FileSummaryResponse.java
â”œâ”€â”€ common/
â”‚   â”œâ”€â”€ error/
â”‚   â”‚   â”œâ”€â”€ GlobalExceptionHandler.java
â”‚   â”‚   â”œâ”€â”€ ErrorResponse.java
â”‚   â”‚   â””â”€â”€ ValidationErrorResponse.java
â”‚   â””â”€â”€ config/
â”‚       â”œâ”€â”€ SecurityConfig.java
â”‚       â””â”€â”€ JwtAuthenticationFilter.java
â””â”€â”€ config/
    â””â”€â”€ WebMvcConfig.java

adapter-rest-api/src/test/java/com/fileflow/adapter/restapi/
â”œâ”€â”€ session/
â”‚   â”œâ”€â”€ UploadSessionApiControllerTest.java
â”‚   â””â”€â”€ UploadSessionApiControllerDocsTest.java  (REST Docs)
â”œâ”€â”€ file/
â”‚   â”œâ”€â”€ FileApiControllerTest.java
â”‚   â””â”€â”€ FileApiControllerDocsTest.java
â”œâ”€â”€ common/
â”‚   â””â”€â”€ GlobalExceptionHandlerTest.java
â””â”€â”€ architecture/
    â””â”€â”€ RestApiLayerArchitectureTest.java
```

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

- **PRD**: `/Users/sangwon-ryu/fileflow/docs/prd/presigned-url-upload.md`
- **Plan**: `docs/prd/plans/FILE-006-004-rest-api-plan.md` (create-plan í›„ ìƒì„±)
- **Jira**: (sync-to-jira í›„ ì¶”ê°€)
- **REST API Layer ê·œì¹™**: `docs/coding_convention/01-adapter-in-layer/rest-api/`

---

## ğŸ“ ì°¸ê³ ì‚¬í•­

### TDD ì§„í–‰ ìˆœì„œ (ê¶Œì¥)

1. **DTO ë¨¼ì €** (ì˜ì¡´ì„± ì—†ìŒ):
   - Request/Response DTO (UserContext.from() ë©”ì„œë“œ í¬í•¨)
2. **Mapper**:
   - PrepareUploadMapper (Request â†’ Command ë³€í™˜ë§Œ)
3. **Controller** (MockMvc):
   - UploadSessionApiController â†’ FileApiController
4. **Error Handling**:
   - GlobalExceptionHandler
5. **Security**:
   - JwtAuthenticationFilter, SecurityConfig
6. **REST Docs**:
   - API ë¬¸ì„œí™”

### API ì„¤ê³„ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] RESTful URL ì„¤ê³„ (ëª…ì‚¬ ì‚¬ìš©, ë™ì‚¬ ê¸ˆì§€)
- [ ] HTTP Method ì˜ë¯¸ë¡ ì  ì‚¬ìš© (POST/GET/DELETE)
- [ ] ìƒíƒœ ì½”ë“œ ì •í™•í•œ ì‚¬ìš© (200/204/400/403/404/410/503)
- [ ] Validation ë©”ì‹œì§€ ëª…í™•í™”
- [ ] Error Response ì¼ê´€ì„±

---

**ë‹¤ìŒ ë‹¨ê³„**:
1. `/create-plan FILE-006-004` - TDD Plan ìƒì„±
2. `/kb/rest-api/go` - TDD ì‚¬ì´í´ ì‹œì‘
3. êµ¬í˜„ ì™„ë£Œ í›„ FILE-006-005 (Integration Test) ì‹œì‘
