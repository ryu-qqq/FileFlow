# FILE-006-005: Integration Test êµ¬í˜„

**Epic**: File Upload Presigned URL System
**Layer**: Integration Test
**ë¸Œëœì¹˜**: feature/FILE-006-005-integration
**Jira URL**: (sync-to-jira í›„ ì¶”ê°€)

---

## ğŸ“ ëª©ì 

íŒŒì¼ ì—…ë¡œë“œ ì„¸ì…˜ ë° íŒŒì¼ ê´€ë¦¬ ì‹œìŠ¤í…œì˜ End-to-End í†µí•© í…ŒìŠ¤íŠ¸ êµ¬í˜„

**í•µì‹¬ ì—­í• **:
- ì „ì²´ ì‹œìŠ¤í…œ í”Œë¡œìš° ê²€ì¦ (API â†’ Application â†’ Persistence)
- ì‹¤ì œ í™˜ê²½ê³¼ ìœ ì‚¬í•œ í†µí•© í…ŒìŠ¤íŠ¸
- ë™ì‹œì„± ë° ì˜ˆì™¸ ì‹œë‚˜ë¦¬ì˜¤ ê²€ì¦
- LocalStackì„ í†µí•œ S3 í†µí•© í…ŒìŠ¤íŠ¸

---

## ğŸ¯ ìš”êµ¬ì‚¬í•­

### 1. E2E ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸

#### ì‹œë‚˜ë¦¬ì˜¤ 1: ë‹¨ì¼ íŒŒì¼ ì—…ë¡œë“œ í”Œë¡œìš°

**í”Œë¡œìš°**:
1. Presigned URL ìš”ì²­ (SINGLE)
2. S3 ì§ì ‘ ì—…ë¡œë“œ (ì‹¤ì œ HTTP ìš”ì²­)
3. ì—…ë¡œë“œ ì™„ë£Œ í˜¸ì¶œ
4. íŒŒì¼ ì¡°íšŒ í™•ì¸
5. íŒŒì¼ ëª©ë¡ ì¡°íšŒ í™•ì¸
6. íŒŒì¼ ì‚­ì œ (ë…¼ë¦¬)

**í…ŒìŠ¤íŠ¸ ì½”ë“œ**:
```java
@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)
@Testcontainers
class SingleFileUploadIntegrationTest {
    @Container
    static MySQLContainer<?> mysql = new MySQLContainer<>("mysql:8.0");

    @Container
    static GenericContainer<?> redis = new GenericContainer<>("redis:7.0")
        .withExposedPorts(6379);

    @Container
    static LocalStackContainer localstack = new LocalStackContainer(
        DockerImageName.parse("localstack/localstack:latest"))
        .withServices(LocalStackContainer.Service.S3);

    @Autowired
    private TestRestTemplate restTemplate;

    @Autowired
    private JwtTokenProvider jwtTokenProvider;

    @Test
    void shouldCompleteFullUploadFlow() {
        // Given: JWT í† í° ìƒì„±
        String token = jwtTokenProvider.generateToken(
            new JwtUser(1L, 1L, "DEFAULT", null)
        );
        HttpHeaders headers = new HttpHeaders();
        headers.setBearerAuth(token);

        // Step 1: Presigned URL ìš”ì²­
        PrepareUploadRequest prepareRequest = new PrepareUploadRequest(
            UUID.randomUUID().toString(),
            UploadType.SINGLE,
            "uploads/test",
            "test.jpg",
            1024L,
            "image/jpeg"
        );

        ResponseEntity<PrepareUploadResponse> prepareResponse = restTemplate.exchange(
            "/api/v1/upload-sessions",
            HttpMethod.POST,
            new HttpEntity<>(prepareRequest, headers),
            PrepareUploadResponse.class
        );

        assertThat(prepareResponse.getStatusCode()).isEqualTo(HttpStatus.OK);
        String uploadUrl = prepareResponse.getBody().uploadUrl();
        String sessionId = prepareResponse.getBody().sessionId();
        String fileId = prepareResponse.getBody().fileId();

        // Step 2: S3 ì§ì ‘ ì—…ë¡œë“œ
        byte[] fileContent = "test image content".getBytes();
        HttpHeaders s3Headers = new HttpHeaders();
        s3Headers.setContentType(MediaType.IMAGE_JPEG);

        ResponseEntity<Void> uploadResponse = restTemplate.exchange(
            uploadUrl,
            HttpMethod.PUT,
            new HttpEntity<>(fileContent, s3Headers),
            Void.class
        );

        assertThat(uploadResponse.getStatusCode()).isEqualTo(HttpStatus.OK);

        // Step 3: ì—…ë¡œë“œ ì™„ë£Œ í˜¸ì¶œ
        ResponseEntity<FileResponse> completeResponse = restTemplate.exchange(
            "/api/v1/upload-sessions/" + sessionId + "/complete",
            HttpMethod.POST,
            new HttpEntity<>(headers),
            FileResponse.class
        );

        assertThat(completeResponse.getStatusCode()).isEqualTo(HttpStatus.OK);
        assertThat(completeResponse.getBody().fileId()).isEqualTo(fileId);

        // Step 4: íŒŒì¼ ì¡°íšŒ í™•ì¸
        ResponseEntity<FileDetailResponse> getFileResponse = restTemplate.exchange(
            "/api/v1/files/" + fileId,
            HttpMethod.GET,
            new HttpEntity<>(headers),
            FileDetailResponse.class
        );

        assertThat(getFileResponse.getStatusCode()).isEqualTo(HttpStatus.OK);
        assertThat(getFileResponse.getBody().fileName()).isEqualTo("test.jpg");

        // Step 5: íŒŒì¼ ëª©ë¡ ì¡°íšŒ í™•ì¸
        ResponseEntity<PageResponse> listResponse = restTemplate.exchange(
            "/api/v1/files?page=0&size=10",
            HttpMethod.GET,
            new HttpEntity<>(headers),
            PageResponse.class
        );

        assertThat(listResponse.getStatusCode()).isEqualTo(HttpStatus.OK);
        assertThat(listResponse.getBody().content()).hasSize(1);

        // Step 6: íŒŒì¼ ì‚­ì œ (ë…¼ë¦¬)
        ResponseEntity<Void> deleteResponse = restTemplate.exchange(
            "/api/v1/files/" + fileId,
            HttpMethod.DELETE,
            new HttpEntity<>(headers),
            Void.class
        );

        assertThat(deleteResponse.getStatusCode()).isEqualTo(HttpStatus.NO_CONTENT);

        // ì‚­ì œ í™•ì¸: ì¡°íšŒ ì‹œ 404
        ResponseEntity<ErrorResponse> getDeletedResponse = restTemplate.exchange(
            "/api/v1/files/" + fileId,
            HttpMethod.GET,
            new HttpEntity<>(headers),
            ErrorResponse.class
        );

        assertThat(getDeletedResponse.getStatusCode()).isEqualTo(HttpStatus.NOT_FOUND);
    }
}
```

#### ì‹œë‚˜ë¦¬ì˜¤ 2: ë©€í‹°íŒŒíŠ¸ íŒŒì¼ ì—…ë¡œë“œ í”Œë¡œìš°

**í”Œë¡œìš°**:
1. Presigned URL ìš”ì²­ (MULTIPART)
2. Partë³„ S3 ì§ì ‘ ì—…ë¡œë“œ (10ê°œ Part)
3. ì—…ë¡œë“œ ì™„ë£Œ í˜¸ì¶œ
4. íŒŒì¼ ì¡°íšŒ í™•ì¸

**í…ŒìŠ¤íŠ¸ ì½”ë“œ**:
```java
@Test
void shouldCompleteMultipartUploadFlow() {
    // Given: JWT í† í° ìƒì„±
    String token = jwtTokenProvider.generateToken(
        new JwtUser(1L, 1L, "SELLER", "samsung-store")
    );
    HttpHeaders headers = new HttpHeaders();
    headers.setBearerAuth(token);

    // Step 1: Presigned URL ìš”ì²­ (MULTIPART)
    PrepareUploadRequest prepareRequest = new PrepareUploadRequest(
        UUID.randomUUID().toString(),
        UploadType.MULTIPART,
        "uploads/large",
        "large.jpg",
        52428800L,  // 50MB
        "image/jpeg"
    );

    ResponseEntity<PrepareUploadResponse> prepareResponse = restTemplate.exchange(
        "/api/v1/upload-sessions",
        HttpMethod.POST,
        new HttpEntity<>(prepareRequest, headers),
        PrepareUploadResponse.class
    );

    assertThat(prepareResponse.getStatusCode()).isEqualTo(HttpStatus.OK);
    List<PartUploadUrl> partUploadUrls = prepareResponse.getBody().partUploadUrls();
    assertThat(partUploadUrls).hasSize(10);
    String sessionId = prepareResponse.getBody().sessionId();
    String fileId = prepareResponse.getBody().fileId();

    // Step 2: Partë³„ ì—…ë¡œë“œ (10ê°œ)
    byte[] partContent = new byte[5 * 1024 * 1024];  // 5MB
    for (PartUploadUrl partUrl : partUploadUrls) {
        ResponseEntity<Void> uploadResponse = restTemplate.exchange(
            partUrl.uploadUrl(),
            HttpMethod.PUT,
            new HttpEntity<>(partContent),
            Void.class
        );
        assertThat(uploadResponse.getStatusCode()).isEqualTo(HttpStatus.OK);
    }

    // Step 3: ì—…ë¡œë“œ ì™„ë£Œ í˜¸ì¶œ
    ResponseEntity<FileResponse> completeResponse = restTemplate.exchange(
        "/api/v1/upload-sessions/" + sessionId + "/complete",
        HttpMethod.POST,
        new HttpEntity<>(headers),
        FileResponse.class
    );

    assertThat(completeResponse.getStatusCode()).isEqualTo(HttpStatus.OK);
    assertThat(completeResponse.getBody().uploadType()).isEqualTo(UploadType.MULTIPART);
}
```

#### ì‹œë‚˜ë¦¬ì˜¤ 3: ì„¸ì…˜ ë§Œë£Œ í”Œë¡œìš°

**í”Œë¡œìš°**:
1. Presigned URL ìš”ì²­
2. 15ë¶„ ëŒ€ê¸° (ì„¸ì…˜ ë§Œë£Œ)
3. Redis TTL ë§Œë£Œ ì´ë²¤íŠ¸ ë°œìƒ
4. ì—…ë¡œë“œ ì™„ë£Œ ì‹œë„ â†’ 410 Gone

**í…ŒìŠ¤íŠ¸ ì½”ë“œ**:
```java
@Test
void shouldExpireSession_afterTtl() throws InterruptedException {
    // Given
    String token = jwtTokenProvider.generateToken(
        new JwtUser(1L, 1L, "DEFAULT", null)
    );
    HttpHeaders headers = new HttpHeaders();
    headers.setBearAuth(token);

    PrepareUploadRequest prepareRequest = new PrepareUploadRequest(
        UUID.randomUUID().toString(),
        UploadType.SINGLE,
        "uploads/test",
        "test.jpg",
        1024L,
        "image/jpeg"
    );

    ResponseEntity<PrepareUploadResponse> prepareResponse = restTemplate.exchange(
        "/api/v1/upload-sessions",
        HttpMethod.POST,
        new HttpEntity<>(prepareRequest, headers),
        PrepareUploadResponse.class
    );

    String sessionId = prepareResponse.getBody().sessionId();

    // When: 15ë¶„ ëŒ€ê¸° (í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œëŠ” TTLì„ ì§§ê²Œ ì„¤ì •)
    Thread.sleep(16 * 60 * 1000);  // ì‹¤ì œ í…ŒìŠ¤íŠ¸ì—ì„œëŠ” Mock ì‚¬ìš©

    // Then: ì—…ë¡œë“œ ì™„ë£Œ ì‹œë„ â†’ 410 Gone
    ResponseEntity<ErrorResponse> completeResponse = restTemplate.exchange(
        "/api/v1/upload-sessions/" + sessionId + "/complete",
        HttpMethod.POST,
        new HttpEntity<>(headers),
        ErrorResponse.class
    );

    assertThat(completeResponse.getStatusCode()).isEqualTo(HttpStatus.GONE);
    assertThat(completeResponse.getBody().errorCode()).isEqualTo("SESSION_EXPIRED");
}
```

### 2. ë™ì‹œì„± í…ŒìŠ¤íŠ¸

#### í…ŒìŠ¤íŠ¸ 1: ë™ì¼ sessionId ë™ì‹œ ìš”ì²­ (ë©±ë“±ì„±)

**ì‹œë‚˜ë¦¬ì˜¤**: 2ê°œ ìŠ¤ë ˆë“œê°€ ë™ì¼ sessionIdë¡œ ë™ì‹œ ìš”ì²­

**í…ŒìŠ¤íŠ¸ ì½”ë“œ**:
```java
@Test
void shouldReturnSameSession_whenConcurrentRequestsWithSameSessionId() throws InterruptedException {
    // Given
    String token = jwtTokenProvider.generateToken(
        new JwtUser(1L, 1L, "DEFAULT", null)
    );
    String sessionId = UUID.randomUUID().toString();

    PrepareUploadRequest request = new PrepareUploadRequest(
        sessionId,
        UploadType.SINGLE,
        "uploads/test",
        "test.jpg",
        1024L,
        "image/jpeg"
    );

    // When: 2ê°œ ìŠ¤ë ˆë“œê°€ ë™ì‹œ ìš”ì²­
    ExecutorService executor = Executors.newFixedThreadPool(2);
    CountDownLatch latch = new CountDownLatch(2);
    List<PrepareUploadResponse> responses = new CopyOnWriteArrayList<>();

    for (int i = 0; i < 2; i++) {
        executor.submit(() -> {
            try {
                HttpHeaders headers = new HttpHeaders();
                headers.setBearerAuth(token);

                ResponseEntity<PrepareUploadResponse> response = restTemplate.exchange(
                    "/api/v1/upload-sessions",
                    HttpMethod.POST,
                    new HttpEntity<>(request, headers),
                    PrepareUploadResponse.class
                );

                responses.add(response.getBody());
            } finally {
                latch.countDown();
            }
        });
    }

    latch.await(10, TimeUnit.SECONDS);
    executor.shutdown();

    // Then: ë™ì¼í•œ ì„¸ì…˜ ë°˜í™˜
    assertThat(responses).hasSize(2);
    assertThat(responses.get(0).sessionId()).isEqualTo(responses.get(1).sessionId());
    assertThat(responses.get(0).fileId()).isEqualTo(responses.get(1).fileId());
}
```

#### í…ŒìŠ¤íŠ¸ 2: ë™ì¼ íŒŒì¼ ë™ì‹œ ì™„ë£Œ ìš”ì²­ (Optimistic Lock)

**ì‹œë‚˜ë¦¬ì˜¤**: 2ê°œ ìŠ¤ë ˆë“œê°€ ë™ì¼ ì„¸ì…˜ ì™„ë£Œ ì‹œë„

**í…ŒìŠ¤íŠ¸ ì½”ë“œ**:
```java
@Test
void shouldCompleteOnlyOnce_whenConcurrentCompletions() throws InterruptedException {
    // Given: ì„¸ì…˜ ìƒì„± ë° S3 ì—…ë¡œë“œ ì™„ë£Œ
    String token = jwtTokenProvider.generateToken(
        new JwtUser(1L, 1L, "DEFAULT", null)
    );
    String sessionId = prepareAndUpload(token);

    // When: 2ê°œ ìŠ¤ë ˆë“œê°€ ë™ì‹œ ì™„ë£Œ ìš”ì²­
    ExecutorService executor = Executors.newFixedThreadPool(2);
    CountDownLatch latch = new CountDownLatch(2);
    List<ResponseEntity<FileResponse>> responses = new CopyOnWriteArrayList<>();

    for (int i = 0; i < 2; i++) {
        executor.submit(() -> {
            try {
                HttpHeaders headers = new HttpHeaders();
                headers.setBearerAuth(token);

                ResponseEntity<FileResponse> response = restTemplate.exchange(
                    "/api/v1/upload-sessions/" + sessionId + "/complete",
                    HttpMethod.POST,
                    new HttpEntity<>(headers),
                    FileResponse.class
                );

                responses.add(response);
            } finally {
                latch.countDown();
            }
        });
    }

    latch.await(10, TimeUnit.SECONDS);
    executor.shutdown();

    // Then: 1ê°œë§Œ ì„±ê³µ, 1ê°œëŠ” 409 Conflict
    long successCount = responses.stream()
        .filter(r -> r.getStatusCode() == HttpStatus.OK)
        .count();
    long conflictCount = responses.stream()
        .filter(r -> r.getStatusCode() == HttpStatus.CONFLICT)
        .count();

    assertThat(successCount).isEqualTo(1);
    assertThat(conflictCount).isEqualTo(1);
}
```

### 3. ì˜ˆì™¸ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸

#### í…ŒìŠ¤íŠ¸ 1: íŒŒì¼ í¬ê¸° ì´ˆê³¼

```java
@Test
void shouldReturn400_whenFileSizeExceeds() {
    // Given
    PrepareUploadRequest request = new PrepareUploadRequest(
        UUID.randomUUID().toString(),
        UploadType.SINGLE,
        "uploads/test",
        "large.jpg",
        200 * 1024 * 1024L,  // 200MB (SINGLE ìµœëŒ€ 100MB ì´ˆê³¼)
        "image/jpeg"
    );

    // When
    ResponseEntity<ErrorResponse> response = restTemplate.exchange(
        "/api/v1/upload-sessions",
        HttpMethod.POST,
        new HttpEntity<>(request, headers),
        ErrorResponse.class
    );

    // Then
    assertThat(response.getStatusCode()).isEqualTo(HttpStatus.BAD_REQUEST);
    assertThat(response.getBody().errorCode()).isEqualTo("FILE_SIZE_EXCEEDED");
}
```

#### í…ŒìŠ¤íŠ¸ 2: ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ íƒ€ì…

```java
@Test
void shouldReturn400_whenUnsupportedFileType() {
    // Given
    PrepareUploadRequest request = new PrepareUploadRequest(
        UUID.randomUUID().toString(),
        UploadType.SINGLE,
        "uploads/test",
        "document.pdf",
        1024L,
        "application/pdf"  // í—ˆìš©ë˜ì§€ ì•ŠëŠ” íƒ€ì…
    );

    // When
    ResponseEntity<ErrorResponse> response = restTemplate.exchange(
        "/api/v1/upload-sessions",
        HttpMethod.POST,
        new HttpEntity<>(request, headers),
        ErrorResponse.class
    );

    // Then
    assertThat(response.getStatusCode()).isEqualTo(HttpStatus.BAD_REQUEST);
    assertThat(response.getBody().errorCode()).isEqualTo("UNSUPPORTED_FILE_TYPE");
}
```

#### í…ŒìŠ¤íŠ¸ 3: ê¶Œí•œ ì—†ìŒ (íƒ€ì¸ íŒŒì¼ ì¡°íšŒ)

```java
@Test
void shouldReturn403_whenAccessingOthersFile() {
    // Given: User Aê°€ íŒŒì¼ ì—…ë¡œë“œ
    String tokenA = jwtTokenProvider.generateToken(
        new JwtUser(1L, 1L, "DEFAULT", null)
    );
    String fileId = uploadFile(tokenA);

    // When: User Bê°€ ì¡°íšŒ ì‹œë„
    String tokenB = jwtTokenProvider.generateToken(
        new JwtUser(2L, 1L, "DEFAULT", null)
    );
    HttpHeaders headers = new HttpHeaders();
    headers.setBearerAuth(tokenB);

    ResponseEntity<ErrorResponse> response = restTemplate.exchange(
        "/api/v1/files/" + fileId,
        HttpMethod.GET,
        new HttpEntity<>(headers),
        ErrorResponse.class
    );

    // Then
    assertThat(response.getStatusCode()).isEqualTo(HttpStatus.FORBIDDEN);
    assertThat(response.getBody().errorCode()).isEqualTo("UNAUTHORIZED_ACCESS");
}
```

### 4. ìŠ¤ì¼€ì¤„ëŸ¬ í…ŒìŠ¤íŠ¸

#### í…ŒìŠ¤íŠ¸: ExpiredSessionCleanupScheduler

```java
@Test
void shouldCleanupExpiredSessions_byScheduler() throws InterruptedException {
    // Given: 10ê°œ ì„¸ì…˜ ìƒì„± (5ê°œëŠ” ë§Œë£Œ, 5ê°œëŠ” ìœ íš¨)
    List<String> expiredSessionIds = createExpiredSessions(5);
    List<String> activeSessionIds = createActiveSessions(5);

    // When: ìŠ¤ì¼€ì¤„ëŸ¬ ì‹¤í–‰ (5ë¶„ ëŒ€ê¸°)
    Thread.sleep(5 * 60 * 1000);  // ì‹¤ì œ í…ŒìŠ¤íŠ¸ì—ì„œëŠ” @SpyBean ì‚¬ìš©

    // Then: ë§Œë£Œëœ ì„¸ì…˜ë§Œ ì‚­ì œ
    for (String sessionId : expiredSessionIds) {
        assertThat(redisTemplate.hasKey("upload:session:" + sessionId)).isFalse();
    }
    for (String sessionId : activeSessionIds) {
        assertThat(redisTemplate.hasKey("upload:session:" + sessionId)).isTrue();
    }
}
```

### 5. í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¤ì •

#### TestContainers ì„¤ì •

```java
@TestConfiguration
public class TestContainersConfig {
    @Bean
    @ServiceConnection
    public MySQLContainer<?> mysqlContainer() {
        return new MySQLContainer<>("mysql:8.0")
            .withDatabaseName("fileflow_test")
            .withUsername("test")
            .withPassword("test");
    }

    @Bean
    @ServiceConnection
    public GenericContainer<?> redisContainer() {
        return new GenericContainer<>("redis:7.0")
            .withExposedPorts(6379)
            .withCommand("redis-server --notify-keyspace-events Ex");
    }

    @Bean
    public LocalStackContainer localStackContainer() {
        return new LocalStackContainer(
            DockerImageName.parse("localstack/localstack:latest"))
            .withServices(LocalStackContainer.Service.S3);
    }
}
```

#### Flyway ë§ˆì´ê·¸ë ˆì´ì…˜ ì„¤ì •

```yaml
spring:
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
```

---

## âš ï¸ ì œì•½ì‚¬í•­

### Zero-Tolerance ê·œì¹™

- [ ] **TestRestTemplate í•„ìˆ˜**: E2E í…ŒìŠ¤íŠ¸ëŠ” ì‹¤ì œ HTTP ìš”ì²­
- [ ] **Flyway ë§ˆì´ê·¸ë ˆì´ì…˜**: í…ŒìŠ¤íŠ¸ DB ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„±
- [ ] **TestContainers**: MySQL, Redis, LocalStack ì‚¬ìš©
- [ ] **@Sql ê¸ˆì§€**: Flywayë¡œë§Œ ìŠ¤í‚¤ë§ˆ ê´€ë¦¬

### í…ŒìŠ¤íŠ¸ ê·œì¹™

- [ ] **ê²©ë¦¬ëœ í…ŒìŠ¤íŠ¸**: ê° í…ŒìŠ¤íŠ¸ëŠ” ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰ ê°€ëŠ¥
- [ ] **íŠ¸ëœì­ì…˜ ë¡¤ë°± ê¸ˆì§€**: E2E í…ŒìŠ¤íŠ¸ëŠ” ì‹¤ì œ ì»¤ë°‹
- [ ] **í…ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬**: `@AfterEach`ë¡œ ë°ì´í„° ì‚­ì œ
- [ ] **íƒ€ì„ì•„ì›ƒ ì„¤ì •**: ì¥ê¸° ì‹¤í–‰ í…ŒìŠ¤íŠ¸ëŠ” íƒ€ì„ì•„ì›ƒ ì„¤ì •

---

## âœ… ì™„ë£Œ ì¡°ê±´

### êµ¬í˜„ ì™„ë£Œ
- [ ] E2E ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ 3ê°œ
- [ ] ë™ì‹œì„± í…ŒìŠ¤íŠ¸ 2ê°œ
- [ ] ì˜ˆì™¸ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ 3ê°œ
- [ ] ìŠ¤ì¼€ì¤„ëŸ¬ í…ŒìŠ¤íŠ¸ 1ê°œ
- [ ] TestContainers ì„¤ì •
- [ ] Flyway ë§ˆì´ê·¸ë ˆì´ì…˜ ì„¤ì •

### í…ŒìŠ¤íŠ¸ ì™„ë£Œ
- [ ] ëª¨ë“  E2E í…ŒìŠ¤íŠ¸ í†µê³¼
- [ ] ëª¨ë“  ë™ì‹œì„± í…ŒìŠ¤íŠ¸ í†µê³¼
- [ ] ëª¨ë“  ì˜ˆì™¸ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ í†µê³¼
- [ ] ìŠ¤ì¼€ì¤„ëŸ¬ í…ŒìŠ¤íŠ¸ í†µê³¼

### í’ˆì§ˆ ê²€ì¦
- [ ] ëª¨ë“  Integration Test í†µê³¼
- [ ] í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì‹œê°„ < 5ë¶„
- [ ] CI/CD íŒŒì´í”„ë¼ì¸ í†µí•©
- [ ] ì½”ë“œ ë¦¬ë·° ìŠ¹ì¸

---

## ğŸ“‚ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
application/src/test/java/com/fileflow/integration/
â”œâ”€â”€ upload/
â”‚   â”œâ”€â”€ SingleFileUploadIntegrationTest.java
â”‚   â”œâ”€â”€ MultipartFileUploadIntegrationTest.java
â”‚   â””â”€â”€ SessionExpirationIntegrationTest.java
â”œâ”€â”€ concurrency/
â”‚   â”œâ”€â”€ IdempotencyIntegrationTest.java
â”‚   â””â”€â”€ OptimisticLockIntegrationTest.java
â”œâ”€â”€ exception/
â”‚   â”œâ”€â”€ FileSizeExceededIntegrationTest.java
â”‚   â”œâ”€â”€ UnsupportedFileTypeIntegrationTest.java
â”‚   â””â”€â”€ UnauthorizedAccessIntegrationTest.java
â”œâ”€â”€ scheduler/
â”‚   â””â”€â”€ ExpiredSessionCleanupIntegrationTest.java
â””â”€â”€ config/
    â”œâ”€â”€ TestContainersConfig.java
    â””â”€â”€ IntegrationTestBase.java

application/src/test/resources/
â”œâ”€â”€ application-test.yml
â””â”€â”€ db/migration/
    â””â”€â”€ V1__create_files_table.sql
```

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

- **PRD**: `/Users/sangwon-ryu/fileflow/docs/prd/presigned-url-upload.md`
- **Plan**: `docs/prd/plans/FILE-006-005-integration-plan.md` (create-plan í›„ ìƒì„±)
- **Jira**: (sync-to-jira í›„ ì¶”ê°€)
- **Integration Test ê·œì¹™**: `docs/coding_convention/05-testing/integration-testing/`

---

## ğŸ“ ì°¸ê³ ì‚¬í•­

### TDD ì§„í–‰ ìˆœì„œ (ê¶Œì¥)

1. **TestContainers ì„¤ì •**:
   - MySQL, Redis, LocalStack
2. **E2E ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸**:
   - ë‹¨ì¼ ì—…ë¡œë“œ â†’ ë©€í‹°íŒŒíŠ¸ ì—…ë¡œë“œ â†’ ì„¸ì…˜ ë§Œë£Œ
3. **ë™ì‹œì„± í…ŒìŠ¤íŠ¸**:
   - ë©±ë“±ì„± â†’ Optimistic Lock
4. **ì˜ˆì™¸ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸**:
   - í¬ê¸° ì´ˆê³¼ â†’ íƒ€ì… ì˜¤ë¥˜ â†’ ê¶Œí•œ ì—†ìŒ
5. **ìŠ¤ì¼€ì¤„ëŸ¬ í…ŒìŠ¤íŠ¸**:
   - Expired Session Cleanup

### LocalStack S3 ì„¤ì • ì˜ˆì‹œ

```java
@BeforeEach
void setupS3() {
    S3Client s3Client = S3Client.builder()
        .endpointOverride(localstack.getEndpointOverride(LocalStackContainer.Service.S3))
        .credentialsProvider(StaticCredentialsProvider.create(
            AwsBasicCredentials.create(
                localstack.getAccessKey(),
                localstack.getSecretKey()
            )
        ))
        .region(Region.of(localstack.getRegion()))
        .build();

    s3Client.createBucket(b -> b.bucket("fileflow-test"));
}
```

---

**ë‹¤ìŒ ë‹¨ê³„**:
1. `/create-plan FILE-006-005` - TDD Plan ìƒì„±
2. `/kb/integration/go` - TDD ì‚¬ì´í´ ì‹œì‘
3. ì „ì²´ êµ¬í˜„ ì™„ë£Œ í›„ PR ìƒì„±
