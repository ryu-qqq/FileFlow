# Epic 1: 테넌트 정책 관리 시스템

## 개요

테넌트별로 차별화된 파일 업로드 및 후처리 정책을 적용하여, 각 비즈니스 요구사항에 맞는 파일 처리 환경을 제공합니다.

**프로젝트**: FileFlow

**Jira Epic**: KAN-XX (생성 예정)

**예상 기간**: 1.5주 (56시간)

**우선순위**: P0 (Critical)

---

## 📊 작업 현황

**총 8개 Task**

- [ ]  Task 1.1: Domain 모델 설계 (12h)
- [ ]  Task 1.2: Port & UseCase 구현 (10h)
- [ ]  Task 1.3: JPA 영속성 어댑터 (12h)
- [ ]  Task 1.4: Redis 캐싱 어댑터 (4h)
- [ ]  Task 1.5: REST API 구현 (8h)
- [ ]  Task 1.6: 정책 매칭 Interceptor (4h)
- [ ]  Task 1.7: Flyway 마이그레이션 (2h)
- [ ]  Task 1.8: 품질 게이트 통과 (4h)

---

## 🏗️ 아키텍처 원칙

### Hexagonal Architecture (Port & Adapter)

```
┌─────────────────────────────────────────────────────┐
│                   Adapter-In                        │
│  (REST API, Interceptor, Event Listener)            │
└──────────────────┬──────────────────────────────────┘
                   │
                   ▼
┌─────────────────────────────────────────────────────┐
│              Application Layer                      │
│         (UseCase, Port Interface)                   │
└──────────────────┬──────────────────────────────────┘
                   │
                   ▼
┌─────────────────────────────────────────────────────┐
│               Domain Layer                          │
│  (UploadPolicy, ProcessingPolicy, PolicyKey)        │
└─────────────────────────────────────────────────────┘
                   ▲
                   │
┌──────────────────┴──────────────────────────────────┐
│                 Adapter-Out                         │
│        (JPA Persistence, Redis Cache)               │
└─────────────────────────────────────────────────────┘
```

### 핵심 설계 규칙

**✅ 필수 준수 사항**

- **NO Lombok** (전체 프로젝트)
- **NO @Transactional** in Domain
- **Constructor Injection only**
- **Record 사용** (Request/Response DTO)
- **Port Interface 기반 의존성**

**📏 품질 기준**

- Domain: 테스트 커버리지 90% 이상
- Application: 테스트 커버리지 80% 이상
- Adapter: 테스트 커버리지 70% 이상
- Javadoc 필수 (Public API)
- @author 태그 필수

---

## 🔑 테넌트 정책 매칭 체계

### 헤더 기반 정책 식별

```
X-Tenant-Id: b2c / b2b
X-User-Type: CONSUMER / SELLER / CRAWLER / BUYER
X-Service-Type: REVIEW / PRODUCT / ORDER_SHEET

PolicyKey = {tenantId}:{userType}:{serviceType}
```

### 정책 예시

**1. B2C 리뷰 이미지** (`b2c:CONSUMER:REVIEW`)

- 최대 10MB, 5장
- 간단한 최적화 + 썸네일 1종

**2. B2C 상품 이미지** (`b2c:SELLER:PRODUCT`)

- 최대 15MB, 10장
- 고품질 최적화 + 썸네일 2종 + OCR

**3. B2C 크롤링 데이터** (`b2c:CRAWLER:PRODUCT`)

- 셀러와 동일하지만 Rate Limit 높음
- HTML 외부 이미지 다운로드 지원

**4. B2B 오더시트** (`b2b:BUYER:ORDER_SHEET`)

- Excel/PDF 지원
- AI 기반 표준화 파이프라인

---

## 📚 관련 문서

- 
    
    [도메인 모델 상세](Epic%201%20%ED%85%8C%EB%84%8C%ED%8A%B8%20%EC%A0%95%EC%B1%85%20%EA%B4%80%EB%A6%AC%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20282b00296f3b8127a571f09b67f465ad/%EB%8F%84%EB%A9%94%EC%9D%B8%20%EB%AA%A8%EB%8D%B8%20%EC%83%81%EC%84%B8%20918aabbf90874e429035d06327e62c95.md)
    
- 
    
    [데이터베이스 스키마](Epic%201%20%ED%85%8C%EB%84%8C%ED%8A%B8%20%EC%A0%95%EC%B1%85%20%EA%B4%80%EB%A6%AC%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20282b00296f3b8127a571f09b67f465ad/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4%20%EC%8A%A4%ED%82%A4%EB%A7%88%2050a845eaa1d34a08b93eb1334ab01aad.md)
    
- 
    
    [API 명세서](Epic%201%20%ED%85%8C%EB%84%8C%ED%8A%B8%20%EC%A0%95%EC%B1%85%20%EA%B4%80%EB%A6%AC%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20282b00296f3b8127a571f09b67f465ad/API%20%EB%AA%85%EC%84%B8%EC%84%9C%205973406fef0c49418f68a18fd45db200.md)
    
- 
    
    [Task 분해 상세](Epic%201%20%ED%85%8C%EB%84%8C%ED%8A%B8%20%EC%A0%95%EC%B1%85%20%EA%B4%80%EB%A6%AC%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20282b00296f3b8127a571f09b67f465ad/Task%20%EB%B6%84%ED%95%B4%20%EC%83%81%EC%84%B8%2076ce8f6330d24566ae432ca3e18ca40d.md)
    
- 
    
    [품질 기준 및 검증](Epic%201%20%ED%85%8C%EB%84%8C%ED%8A%B8%20%EC%A0%95%EC%B1%85%20%EA%B4%80%EB%A6%AC%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20282b00296f3b8127a571f09b67f465ad/%ED%92%88%EC%A7%88%20%EA%B8%B0%EC%A4%80%20%EB%B0%8F%20%EA%B2%80%EC%A6%9D%20c5b46d2509e446bf905b668a0a807db1.md)
    

---

## 🔗 외부 링크

- **GitHub**: [https://github.com/ryu-qqq/FileFlow](https://github.com/ryu-qqq/FileFlow)
- **Jira Board**: [https://ryuqqq.atlassian.net/jira/software/projects/KAN](https://ryuqqq.atlassian.net/jira/software/projects/KAN)
- **상위 프로젝트**: 🏗️ Setof 고도화 프로젝트

[도메인 모델 상세](Epic%201%20%ED%85%8C%EB%84%8C%ED%8A%B8%20%EC%A0%95%EC%B1%85%20%EA%B4%80%EB%A6%AC%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20282b00296f3b8127a571f09b67f465ad/%EB%8F%84%EB%A9%94%EC%9D%B8%20%EB%AA%A8%EB%8D%B8%20%EC%83%81%EC%84%B8%20282b00296f3b81768351caea66133fea.md)

[데이터베이스 스키마](Epic%201%20%ED%85%8C%EB%84%8C%ED%8A%B8%20%EC%A0%95%EC%B1%85%20%EA%B4%80%EB%A6%AC%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20282b00296f3b8127a571f09b67f465ad/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4%20%EC%8A%A4%ED%82%A4%EB%A7%88%20282b00296f3b813abdedf49018cadd7e.md)

[품질 기준 및 검증](Epic%201%20%ED%85%8C%EB%84%8C%ED%8A%B8%20%EC%A0%95%EC%B1%85%20%EA%B4%80%EB%A6%AC%20%EC%8B%9C%EC%8A%A4%ED%85%9C%20282b00296f3b8127a571f09b67f465ad/%ED%92%88%EC%A7%88%20%EA%B8%B0%EC%A4%80%20%EB%B0%8F%20%EA%B2%80%EC%A6%9D%20282b00296f3b81b38b9ac9460f0af6ee.md)