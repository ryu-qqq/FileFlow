# Epic 3: ì´ë¯¸ì§€ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸

## ğŸ¯ ëª©í‘œ

ì´ë¯¸ì§€ ìµœì í™” ë° ë©”íƒ€ë°ì´í„° ì¶”ì¶œ ìë™í™”

## ğŸ“Š Epic ì •ë³´

- **Jira Epic**: [KAN-27](https://ryuqqq.atlassian.net/browse/KAN-27)
- **ìƒíƒœ**: â³ ëŒ€ê¸° ì¤‘
- **ì˜ˆìƒ ì‹œê°„**: 104ì‹œê°„ (ì•½ 13ì¼)
- **ìš°ì„ ìˆœìœ„**: P2
- **ì˜ì¡´ì„±**: Epic 2 ì™„ë£Œ í•„ìš” (íŒŒì¼ ì—…ë¡œë“œ ê¸°ë°˜)

---

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ ê°œìš”

### íŒŒì´í”„ë¼ì¸ íë¦„

```
[ì´ë¯¸ì§€ ì—…ë¡œë“œ ì™„ë£Œ] (Epic 2)
        â†“
[íŒŒì´í”„ë¼ì¸ íŠ¸ë¦¬ê±°]
        â†“
    [ë¹„ë™ê¸° ì²˜ë¦¬]
        â†“
   â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”
   â”‚         â”‚         â”‚
[Stage 1] [Stage 2] [Stage 3]
   â”‚         â”‚         â”‚
[ìµœì í™”]  [ì¸ë„¤ì¼]  [OCR]
   â”‚         â”‚         â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚
   [Stage 4]
        â”‚
   [CDN ë°°í¬]
        â†“
    [ì™„ë£Œ]
```

### 4ë‹¨ê³„ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸

1. **Stage 1**: ì´ë¯¸ì§€ ìµœì í™” (WebP ë³€í™˜, ì••ì¶•)
2. **Stage 2**: ì¸ë„¤ì¼ ìƒì„± (Small 300x300, Medium 800x800)
3. **Stage 3**: OCR í…ìŠ¤íŠ¸ ì¶”ì¶œ (ìƒí’ˆ ì •ë³´ íŒŒì‹±)
4. **Stage 4**: CDN ë°°í¬ (CloudFront)

---

## ğŸ“¦ ì£¼ìš” ê¸°ëŠ¥

### 1. ì´ë¯¸ì§€ ìµœì í™”

### ì œê³µí•˜ëŠ” ê²ƒ âœ…

- âœ… WebP í¬ë§· ë³€í™˜ (JPEG, PNG, GIF)
- âœ… ì´ë¯¸ì§€ ì••ì¶• (í’ˆì§ˆ 90% ìœ ì§€)
- âœ… ë‹¤ì¤‘ í¬ê¸° ì¸ë„¤ì¼ ìƒì„± (Small 300x300, Medium 800x800)
- âœ… EXIF ë©”íƒ€ë°ì´í„° ì²˜ë¦¬ (íšŒì „ ë³´ì •, ê°œì¸ì •ë³´ ì œê±°)
- âœ… AWS Textract ê¸°ë°˜ OCR
- âœ… ìƒí’ˆ ì •ë³´ ìë™ íŒŒì‹± (ì¬ì§ˆ, ì›ì‚°ì§€, ì„¸íƒë°©ë²•, ì‚¬ì´ì¦ˆ)
- âœ… CloudFront CDN ìë™ ë°°í¬
- âœ… ìºì‹œ ë¬´íš¨í™” API
- âœ… 4ë‹¨ê³„ íŒŒì´í”„ë¼ì¸ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
- âœ… ì‘ì—… ìƒíƒœ ì¶”ì  ë° ì¬ì‹œë„
- âœ… ë³‘ë ¬ ì²˜ë¦¬ (ì¸ë„¤ì¼ ìƒì„±)
- âœ… Epic 2 íŒŒì¼ ê´€ê³„ ìë™ ì—°ê²°

### ì œê³µí•˜ì§€ ì•ŠëŠ” ê²ƒ âŒ

- âŒ ë¹„ì´ë¯¸ì§€ íŒŒì¼ ì²˜ë¦¬ (Epic 4ì—ì„œ HTML, Epic 5ì—ì„œ Excel/PDF)
- âŒ ì‹¤ì‹œê°„ ì´ë¯¸ì§€ ë³€í™˜ (ì˜¨ë””ë§¨ë“œ ë¦¬ì‚¬ì´ì§•)
- âŒ AI ê¸°ë°˜ ì´ë¯¸ì§€ íƒœê¹…/ë¶„ë¥˜ (í–¥í›„ í™•ì¥)
- âŒ ì–¼êµ´ ì¸ì‹/ê°ì²´ íƒì§€ (í–¥í›„ í™•ì¥)
- âŒ ì›Œí„°ë§ˆí¬ ìë™ ì‚½ì… (í–¥í›„ í™•ì¥)
- âŒ ë™ì˜ìƒ ì¸ë„¤ì¼ ì¶”ì¶œ (í–¥í›„ í™•ì¥)
- âŒ ì´ë¯¸ì§€ ë°°ê²½ ì œê±°
- âŒ ì´ë¯¸ì§€ í’ˆì§ˆ ìë™ í‰ê°€
- âŒ ì¤‘ë³µ ì´ë¯¸ì§€ íƒì§€

### WebP ë³€í™˜

**ëª©ì **: íŒŒì¼ í¬ê¸° ì¶•ì†Œ ë° í’ˆì§ˆ ìœ ì§€

**ë³€í™˜ ëŒ€ìƒ**:

- JPEG â†’ WebP
- PNG â†’ WebP (Alpha ì±„ë„ ìœ ì§€)
- GIF â†’ WebP (ì• ë‹ˆë©”ì´ì…˜ ì§€ì›)

**ê¸°ìˆ  ìŠ¤íƒ**:

- **Thumbnailator**: Java ì´ë¯¸ì§€ ì²˜ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬
- **WebP Plugin**: WebP í¬ë§· ì§€ì›

**ë³€í™˜ ì˜µì…˜**:

```java
WebPOptions options = new WebPOptions();
options.setQuality(90);  // í’ˆì§ˆ 90%
options.setLossless(false);  // ì†ì‹¤ ì••ì¶•
options.setPreserveMetadata(false);  // EXIF ì œê±°
```

**ê¸°ëŒ€ íš¨ê³¼**:

- JPEG ëŒ€ë¹„ 25-35% íŒŒì¼ í¬ê¸° ê°ì†Œ
- PNG ëŒ€ë¹„ 50-70% íŒŒì¼ í¬ê¸° ê°ì†Œ
- í’ˆì§ˆ ì €í•˜ ìµœì†Œí™”

### ì´ë¯¸ì§€ ì••ì¶•

**í’ˆì§ˆ ê¸°ì¤€**: 90%

**í¬ë§·ë³„ ì••ì¶• ì „ëµ**:

- **JPEG**: MozJPEG ì•Œê³ ë¦¬ì¦˜
- **PNG**: OptiPNG + PNGQuant
- **WebP**: Google libwebp

**ì••ì¶• ì•Œê³ ë¦¬ì¦˜**:

```java
interface CompressionStrategy {
    byte[] compress(byte[] imageData, int quality);
}

class JpegCompressionStrategy implements CompressionStrategy {
    // MozJPEG ê¸°ë°˜ ì••ì¶•
}

class PngCompressionStrategy implements CompressionStrategy {
    // OptiPNG + PNGQuant ì‚¬ìš©
}
```

### EXIF ë©”íƒ€ë°ì´í„° ì²˜ë¦¬

**ì œê±° ëŒ€ìƒ**:

- GPS ìœ„ì¹˜ ì •ë³´
- ì¹´ë©”ë¼ ê¸°ê¸° ì •ë³´
- ì´¬ì˜ ì¼ì‹œ

**ìœ ì§€ ëŒ€ìƒ**:

- ì €ì‘ê¶Œ ì •ë³´
- Orientation íƒœê·¸ (ìë™ íšŒì „ í›„ ì œê±°)

**ì²˜ë¦¬ ë¡œì§**:

1. EXIF ë°ì´í„° ì½ê¸°
2. Orientation ê¸°ë°˜ ì´ë¯¸ì§€ íšŒì „
3. ê°œì¸ì •ë³´ ì œê±°
4. í•„ìš”í•œ ì •ë³´ë§Œ file_metadataì— ì €ì¥

### 2. ì¸ë„¤ì¼ ìƒì„±

### ì¸ë„¤ì¼ í¬ê¸° ì •ì˜

**SMALL**: 300x300

- ì‚¬ìš©ì²˜: ëª©ë¡ ë·°, ë¯¸ë¦¬ë³´ê¸°
- ë¦¬ì‚¬ì´ì§•: Center Crop (ì •ì‚¬ê°í˜•)
- í¬ë§·: WebP

**MEDIUM**: 800x800

- ì‚¬ìš©ì²˜: ìƒì„¸ ë·°, ëª¨ë°”ì¼
- ë¦¬ì‚¬ì´ì§•: Aspect Ratio ìœ ì§€ Fit
- í¬ë§·: WebP

### ë¦¬ì‚¬ì´ì§• ì•Œê³ ë¦¬ì¦˜

**Lanczos3 ë¦¬ìƒ˜í”Œë§**:

- ìµœê³  í’ˆì§ˆì˜ ë¦¬ì‚¬ì´ì§• ì•Œê³ ë¦¬ì¦˜
- ì„ ëª…ë„ ìœ ì§€
- ì—ì¼ë¦¬ì–´ì‹± ë°©ì§€

**ì„ ëª…í™” ì²˜ë¦¬**:

- Unsharp Mask ì ìš©
- ë¦¬ì‚¬ì´ì§• í›„ ì„ ëª…ë„ ì†ì‹¤ ë³´ì •
- ê³¼ë„í•œ ìƒ¤í”„ë‹ ë°©ì§€

### íŒŒì¼ëª… ê·œì¹™

```
ì›ë³¸: product-12345.jpg
Small: product-12345_small.webp
Medium: product-12345_medium.webp
```

### S3 ì €ì¥ êµ¬ì¡°

```
s3://fileflow-storage/
â”œâ”€â”€ originals/
â”‚   â””â”€â”€ {tenant-id}/{file-id}.{ext}
â””â”€â”€ thumbnails/
    â”œâ”€â”€ small/
    â”‚   â””â”€â”€ {tenant-id}/{file-id}.webp
    â””â”€â”€ medium/
        â””â”€â”€ {tenant-id}/{file-id}.webp
```

### 3. OCR (í…ìŠ¤íŠ¸ ì¶”ì¶œ)

### AWS Textract í†µí•©

**API ì‚¬ìš©**:

- **DetectDocumentText**: í…ìŠ¤íŠ¸ ê°ì§€ ë° ì¶”ì¶œ
- **AnalyzeDocument**: ë¬¸ì„œ êµ¬ì¡° ë¶„ì„ (ì„ íƒ)

**ë¹„ìš© ìµœì í™”**:

- ë™ì¼ ì´ë¯¸ì§€ ì¬ì²˜ë¦¬ ë°©ì§€ (ìºì‹±)
- ë°°ì¹˜ ì²˜ë¦¬
- ì‹ ë¢°ë„ 90% ì´ìƒë§Œ ì²˜ë¦¬

**ì²˜ë¦¬ íë¦„**:

```
1. S3ì—ì„œ ì´ë¯¸ì§€ ì°¸ì¡°
2. Textract DetectDocumentText í˜¸ì¶œ
3. í…ìŠ¤íŠ¸ ë¸”ë¡ ì¶”ì¶œ
4. ì‹ ë¢°ë„ í•„í„°ë§ (>= 90%)
5. í…ìŠ¤íŠ¸ ì •ì œ ë° íŒŒì‹±
6. file_metadataì— ì €ì¥
```

### ìƒí’ˆ ì •ë³´ íŒŒì‹±

**íŒŒì‹± ëŒ€ìƒ**:

1. **ì¬ì§ˆ (Material)**
    - íŒ¨í„´: "Cotton 100%", "í´ë¦¬ì—ìŠ¤í…Œë¥´ 80%"
    - ì •ê·œì‹: `/(\w+)\s*(\d+)%/`
2. **ì›ì‚°ì§€ (Origin)**
    - íŒ¨í„´: "Made in Korea", "ì¤‘êµ­ì‚°", "Vietnam"
    - ì •ê·œì‹: `/Made in ([A-Za-zê°€-í£]+)/`
3. **ì„¸íƒë°©ë²• (Washing)**
    - íŒ¨í„´: "ì†ì„¸íƒ", "ë“œë¼ì´í´ë¦¬ë‹", "ë¬¼ì„¸íƒ ê°€ëŠ¥"
    - í‚¤ì›Œë“œ: "ì„¸íƒ", "wash", "clean"
4. **ì‚¬ì´ì¦ˆ (Size)**
    - íŒ¨í„´: "S", "M", "L", "XL", "Free Size"
    - ì •ê·œì‹: `/\b(XS|S|M|L|XL|XXL|Free)\b/i`

**íŒŒì‹± ë¡œì§**:

```java
class ProductInfoParser {
    MaterialPattern materialPattern;
    OriginPattern originPattern;
    WashingPattern washingPattern;
    SizePattern sizePattern;
    
    ProductInformation parse(String extractedText) {
        // íŒ¨í„´ ë§¤ì¹­ ë° íŒŒì‹±
    }
}
```

**ì €ì¥ í˜•ì‹** (file_metadata):

```json
{
  "ocr_extracted_text": "ì›ë³¸ í…ìŠ¤íŠ¸...",
  "product_material": "Cotton 100%",
  "product_origin": "Korea",
  "washing_instruction": "ì†ì„¸íƒ",
  "product_size": "Free Size",
  "ocr_confidence": 0.95
}
```

### 4. CDN ë°°í¬

### CloudFront êµ¬ì„±

**Distribution ì„¤ì •**:

- **Origin**: S3 Bucket
- **Origin Access**: OAC (Origin Access Control)
- **Viewer Protocol**: HTTPS Only
- **Compress**: Gzip, Brotli í™œì„±í™”

**Cache ì •ì±…**:

- **ì´ë¯¸ì§€ íŒŒì¼**: ì¥ê¸° ìºì‹± (1ë…„)
- **Cache-Control**: `public, max-age=31536000, immutable`
- **Query String**: ë¬´ì‹œ

**ì—ì§€ ë¡œì¼€ì´ì…˜**:

- Price Class: All (100+ ì—ì§€ ë¡œì¼€ì´ì…˜)
- ë˜ëŠ” Price Class 100 (ë¹„ìš© ìµœì í™”)

### CDN URL êµ¬ì¡°

```
[https://d123456789.cloudfront.net/originals/{tenant-id}/{file-id}.webp](https://d123456789.cloudfront.net/originals/{tenant-id}/{file-id}.webp)
[https://d123456789.cloudfront.net/thumbnails/small/{tenant-id}/{file-id}.webp](https://d123456789.cloudfront.net/thumbnails/small/{tenant-id}/{file-id}.webp)
[https://d123456789.cloudfront.net/thumbnails/medium/{tenant-id}/{file-id}.webp](https://d123456789.cloudfront.net/thumbnails/medium/{tenant-id}/{file-id}.webp)
```

### ìºì‹œ ë¬´íš¨í™”

**ë¬´íš¨í™” ì‹œë‚˜ë¦¬ì˜¤**:

- íŒŒì¼ ì¬ì—…ë¡œë“œ
- íŒŒì¼ ì‚­ì œ
- ì´ë¯¸ì§€ ì¬ì²˜ë¦¬

**ë¬´íš¨í™” API**:

```
POST /api/v1/cdn/invalidate
Request:
{
  "paths": [
    "/originals/1/file-123.webp",
    "/thumbnails/*/file-123.webp"
  ]
}

Response:
{
  "invalidationId": "I2J3K4L5M6N7O8P9",
  "status": "InProgress",
  "createTime": "2024-12-25T10:00:00Z"
}
```

**ë¹„ìš© ìµœì í™”**:

- ë¬´íš¨í™” ê²½ë¡œ ê·¸ë£¹í•‘
- ì™€ì¼ë“œì¹´ë“œ í™œìš©
- ë¶ˆí•„ìš”í•œ ë¬´íš¨í™” ë°©ì§€

### 5. í›„ì²˜ë¦¬ ì‘ì—… ê´€ë¦¬

### processing_job í…Œì´ë¸”

**ìŠ¤í‚¤ë§ˆ**:

```sql
CREATE TABLE processing_job (
    id BIGINT PRIMARY KEY,
    job_id VARCHAR(36) UNIQUE,
    file_id VARCHAR(36),
    job_type VARCHAR(50),
    job_status VARCHAR(20),
    priority INT DEFAULT 0,
    retry_count INT DEFAULT 0,
    max_retries INT DEFAULT 3,
    error_message TEXT,
    metadata JSON,
    started_at DATETIME,
    completed_at DATETIME,
    created_at DATETIME,
    updated_at DATETIME
);
```

**Job íƒ€ì…**:

- `IMAGE_OPTIMIZATION`: ì´ë¯¸ì§€ ìµœì í™”
- `WEBP_CONVERSION`: WebP ë³€í™˜
- `THUMBNAIL_GENERATION`: ì¸ë„¤ì¼ ìƒì„±
- `OCR_EXTRACTION`: OCR í…ìŠ¤íŠ¸ ì¶”ì¶œ
- `CDN_DEPLOYMENT`: CDN ë°°í¬

**Job ìƒíƒœ**:

```
PENDING â†’ PROCESSING â†’ COMPLETED
                     â†’ FAILED â†’ PENDING (ì¬ì‹œë„)
        â†’ CANCELLED
```

### íŒŒì´í”„ë¼ì¸ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°

**ì‹¤í–‰ ì „ëµ**:

```java
class ImageProcessingOrchestrator {
    
    void startPipeline(String fileId) {
        // Stage 1: ì´ë¯¸ì§€ ìµœì í™”
        ProcessingJob optimizationJob = createJob(fileId, IMAGE_OPTIMIZATION);
        
        // Stage 2: ì¸ë„¤ì¼ ìƒì„± (ë³‘ë ¬)
        ProcessingJob thumbnailJob = createJob(fileId, THUMBNAIL_GENERATION);
        
        // Stage 3: OCR ì¶”ì¶œ
        ProcessingJob ocrJob = createJob(fileId, OCR_EXTRACTION);
        
        // Stage 4: CDN ë°°í¬
        ProcessingJob cdnJob = createJob(fileId, CDN_DEPLOYMENT);
        
        // ë‹¨ê³„ë³„ ì‹¤í–‰
        executeSequentially(optimizationJob, thumbnailJob, ocrJob, cdnJob);
    }
}
```

**ë³‘ë ¬ ì²˜ë¦¬**:

- ì¸ë„¤ì¼ ìƒì„± (Small, Medium ë™ì‹œ)
- ìµœì í™” ë° OCR (ë…ë¦½ì )

**ì˜ì¡´ì„± ê´€ë¦¬**:

- Stage 2, 3ì€ Stage 1 ì™„ë£Œ í›„
- Stage 4ëŠ” ëª¨ë“  Stage ì™„ë£Œ í›„

---

## ğŸ”§ ê¸°ìˆ  ìŠ¤íƒ

### Backend

- **Language**: Java 17
- **Framework**: Spring Boot 3.x
- **Architecture**: Hexagonal Architecture

### ì´ë¯¸ì§€ ì²˜ë¦¬

- **Thumbnailator**: Java ì´ë¯¸ì§€ ì²˜ë¦¬
- **ImageMagick**: ëŒ€ì•ˆ (ëª…ë ¹ì¤„ ë„êµ¬)
- **Apache Commons Imaging**: ë©”íƒ€ë°ì´í„°
- **Metadata Extractor**: EXIF ë°ì´í„°

### AWS Services

- **S3**: íŒŒì¼ ì €ì¥
- **Textract**: OCR ì„œë¹„ìŠ¤
- **CloudFront**: CDN
- **SQS/SNS**: ë©”ì‹œì§€ í

### Database

- **MySQL 8.0**: ë©”ì¸ DB
- **Redis**: ê²°ê³¼ ìºì‹±

### Libraries

- **AWS SDK for Java v2**: AWS ì„œë¹„ìŠ¤
- **Spring Retry**: ì¬ì‹œë„
- **Resilience4j**: Circuit Breaker

---

## ğŸ“‹ Task ëª©ë¡

### Phase 1: ì´ë¯¸ì§€ ìµœì í™” (16ì‹œê°„)

- [KAN-28](https://ryuqqq.atlassian.net/browse/KAN-28) - ì´ë¯¸ì§€ ìµœì í™” Domain ëª¨ë¸ ì„¤ê³„ - 4h
- [KAN-29](https://ryuqqq.atlassian.net/browse/KAN-29) - WebP ë³€í™˜ ì„œë¹„ìŠ¤ êµ¬í˜„ - 5h
- [KAN-30](https://ryuqqq.atlassian.net/browse/KAN-30) - ì´ë¯¸ì§€ ì••ì¶• ë¡œì§ êµ¬í˜„ (í’ˆì§ˆ 90%) - 4h
- [KAN-31](https://ryuqqq.atlassian.net/browse/KAN-31) - ì´ë¯¸ì§€ ë©”íƒ€ë°ì´í„° ì²˜ë¦¬ (EXIF ì œê±°/ìœ ì§€) - 3h

### Phase 2: ì¸ë„¤ì¼ ìƒì„± (13ì‹œê°„)

- [KAN-32](https://ryuqqq.atlassian.net/browse/KAN-32) - ì¸ë„¤ì¼ ìƒì„± ì „ëµ ì„¤ê³„ ë° êµ¬í˜„ - 3h
- [KAN-33](https://ryuqqq.atlassian.net/browse/KAN-33) - ë‹¤ì¤‘ í¬ê¸° ì¸ë„¤ì¼ ìƒì„± (Small: 300x300, Medium: 800x800) - 4h
- [KAN-34](https://ryuqqq.atlassian.net/browse/KAN-34) - ë¦¬ì‚¬ì´ì§• ì•Œê³ ë¦¬ì¦˜ ìµœì í™” - 3h
- [KAN-35](https://ryuqqq.atlassian.net/browse/KAN-35) - ì¸ë„¤ì¼ íŒŒì¼ ê´€ê³„ ì €ì¥ (file_relationship) - 3h

### Phase 3: OCR (18ì‹œê°„)

- [KAN-36](https://ryuqqq.atlassian.net/browse/KAN-36) - AWS Textract í†µí•© ì„¤ì • - 3h
- [KAN-37](https://ryuqqq.atlassian.net/browse/KAN-37) - ì´ë¯¸ì§€ í…ìŠ¤íŠ¸ ì¶”ì¶œ ì„œë¹„ìŠ¤ êµ¬í˜„ - 5h
- [KAN-38](https://ryuqqq.atlassian.net/browse/KAN-38) - ìƒí’ˆ ì •ë³´ íŒŒì‹± ë¡œì§ (ì¬ì§ˆ, ì›ì‚°ì§€, ì„¸íƒë°©ë²•, ì‚¬ì´ì¦ˆ) - 6h
- [KAN-39](https://ryuqqq.atlassian.net/browse/KAN-39) - OCR ê²°ê³¼ ì €ì¥ ë° ë©”íƒ€ë°ì´í„° ì—°ë™ - 4h

### Phase 4: CDN ë°°í¬ (10ì‹œê°„)

- [KAN-40](https://ryuqqq.atlassian.net/browse/KAN-40) - CloudFront ë°°í¬ ì„¤ì • (ì¸í”„ë¼) - 4h
- [KAN-41](https://ryuqqq.atlassian.net/browse/KAN-41) - CDN ìë™ ë°°í¬ ë¡œì§ êµ¬í˜„ - 3h
- [KAN-42](https://ryuqqq.atlassian.net/browse/KAN-42) - ìºì‹œ ë¬´íš¨í™” ì„œë¹„ìŠ¤ êµ¬í˜„ - 3h

### Phase 5: íŒŒì´í”„ë¼ì¸ ê´€ë¦¬ (16ì‹œê°„)

- [KAN-43](https://ryuqqq.atlassian.net/browse/KAN-43) - processing_job í…Œì´ë¸” ì„¤ê³„ ë° ìƒì„± - 3h
- [KAN-44](https://ryuqqq.atlassian.net/browse/KAN-44) - íŒŒì´í”„ë¼ì¸ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ êµ¬í˜„ - 5h
- [KAN-45](https://ryuqqq.atlassian.net/browse/KAN-45) - ì‘ì—… ìƒíƒœ ì¶”ì  ë° ê´€ë¦¬ - 4h
- [KAN-46](https://ryuqqq.atlassian.net/browse/KAN-46) - ì¬ì‹œë„ ë° ì—ëŸ¬ í•¸ë“¤ë§ - 4h

### Phase 6: ë¹„ë™ê¸° ì²˜ë¦¬ ì¸í”„ë¼ (9ì‹œê°„)

- [KAN-47](https://ryuqqq.atlassian.net/browse/KAN-47) - SQS/SNS íŒŒì´í”„ë¼ì¸ ì„¤ì • - 4h
- [KAN-48](https://ryuqqq.atlassian.net/browse/KAN-48) - ë¹„ë™ê¸° ë©”ì‹œì§€ í•¸ë“¤ëŸ¬ êµ¬í˜„ - 5h

### Phase 7: í’ˆì§ˆ ë³´ì¦ (11ì‹œê°„)

- [KAN-49](https://ryuqqq.atlassian.net/browse/KAN-49) - í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„± - 6h
- [KAN-50](https://ryuqqq.atlassian.net/browse/KAN-50) - ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ë° ìµœì í™” - 5h

### Phase 8: ì—ëŸ¬ ì²˜ë¦¬ ë° ëª¨ë‹ˆí„°ë§ (11ì‹œê°„)

- [KAN-82](https://ryuqqq.atlassian.net/browse/KAN-82) - ì—ëŸ¬ ì²˜ë¦¬ ì‹œë‚˜ë¦¬ì˜¤ êµ¬í˜„ - 6h
- [KAN-83](https://ryuqqq.atlassian.net/browse/KAN-83) - ì—ëŸ¬ ëª¨ë‹ˆí„°ë§ ì„¤ì • - 5h

**ì´ ì˜ˆìƒ ì‹œê°„**: 104ì‹œê°„ (ì•½ 13ì¼)

- [KAN-49](https://ryuqqq.atlassian.net/browse/KAN-49) - í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„± - 6h
- [KAN-50](https://ryuqqq.atlassian.net/browse/KAN-50) - ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ë° ìµœì í™” - 5h

---

## ğŸ“– ì°¸ê³  ë¬¸ì„œ

### AWS ë¬¸ì„œ

- [AWS Textract](https://docs.aws.amazon.com/textract/)
- [CloudFront Developer Guide](https://docs.aws.amazon.com/cloudfront/)
- [SNS/SQS](https://docs.aws.amazon.com/sns/)

### ë¼ì´ë¸ŒëŸ¬ë¦¬

---

## ğŸš¨ ì—ëŸ¬ ì²˜ë¦¬ ì‹œë‚˜ë¦¬ì˜¤

### 1. ì´ë¯¸ì§€ ìµœì í™” ì‹¤íŒ¨

**1.1 ì§€ì›í•˜ì§€ ì•ŠëŠ” í˜•ì‹**

- ìƒí™©: TIFF, RAW ë“± ë¹„ì§€ì› í¬ë§·
- ì—ëŸ¬ ì½”ë“œ: `UNSUPPORTED_IMAGE_FORMAT` (400)
- ì²˜ë¦¬: processing_job FAILED, ì›ë³¸ë§Œ ìœ ì§€

**1.2 ì†ìƒëœ ì´ë¯¸ì§€**

- ìƒí™©: ë””ì½”ë”© ë¶ˆê°€
- ì—ëŸ¬ ì½”ë“œ: `CORRUPTED_IMAGE_FILE` (400)
- ì²˜ë¦¬: quarantine ë²„í‚· ê²©ë¦¬, Slack ì•Œë¦¼

**1.3 ë©”ëª¨ë¦¬ ë¶€ì¡±**

- ìƒí™©: ëŒ€ìš©ëŸ‰ ì´ë¯¸ì§€ OOM
- ì—ëŸ¬ ì½”ë“œ: `IMAGE_PROCESSING_OOM` (500)
- ì¬ì‹œë„: 3íšŒ (ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬)

### 2. WebP ë³€í™˜ ì‹¤íŒ¨

**2.1 ë³€í™˜ í’ˆì§ˆ ì €í•˜**

- ìƒí™©: SSIM < 0.9
- ì—ëŸ¬ ì½”ë“œ: `WEBP_QUALITY_DEGRADATION` (500)
- ì²˜ë¦¬: í’ˆì§ˆ 95%ë¡œ ì¬ì‹œë„, ì‹¤íŒ¨ ì‹œ ì›ë³¸ ìœ ì§€

**2.2 íˆ¬ëª…ë„ ì†ì‹¤**

- ìƒí™©: PNG Alpha ì†ì‹¤
- ì—ëŸ¬ ì½”ë“œ: `WEBP_ALPHA_LOSS` (500)
- ì²˜ë¦¬: ë¬´ì†ì‹¤ ì••ì¶•, ì‹¤íŒ¨ ì‹œ PNG ìœ ì§€

### 3. ì¸ë„¤ì¼ ìƒì„± ì‹¤íŒ¨

**3.1 ì¼ë¶€ ì¸ë„¤ì¼ ì‹¤íŒ¨**

- ìƒí™©: Small ì„±ê³µ, Medium ì‹¤íŒ¨
- ì—ëŸ¬ ì½”ë“œ: `PARTIAL_THUMBNAIL_FAILURE` (500)
- ì²˜ë¦¬: ì„±ê³µí•œ ê²ƒë§Œ ì €ì¥, PARTIALLY_COMPLETED

### 4. OCR ì²˜ë¦¬ ì‹¤íŒ¨

**4.1 Textract API ì œí•œ**

- ìƒí™©: ì¼ì¼ í• ë‹¹ëŸ‰ ì´ˆê³¼
- ì—ëŸ¬ ì½”ë“œ: `TEXTRACT_THROTTLED` (429)
- ì¬ì‹œë„: 5ë¶„ â†’ 15ë¶„ â†’ 1ì‹œê°„, 3íšŒ ì‹¤íŒ¨ ì‹œ ë‹¤ìŒë‚ 

**4.2 í…ìŠ¤íŠ¸ ë¯¸ê°ì§€**

- ìƒí™©: ì´ë¯¸ì§€ì— í…ìŠ¤íŠ¸ ì—†ìŒ
- ì—ëŸ¬ ì½”ë“œ: `OCR_NO_TEXT_DETECTED` (200)
- ì²˜ë¦¬: ì •ìƒ ë™ì‘, ocr_text="" ì €ì¥

**4.3 íŒŒì‹± ì‹¤íŒ¨**

- ìƒí™©: ìƒí’ˆ ì •ë³´ íŒŒì‹± ì‹¤íŒ¨
- ì—ëŸ¬ ì½”ë“œ: `PRODUCT_INFO_PARSING_FAILED` (500)
- ì²˜ë¦¬: ì›ë³¸ í…ìŠ¤íŠ¸ë§Œ ì €ì¥, ìˆ˜ë™ íŒŒì‹± í•„ìš” ì‹œ Slack

### 5. CDN ë°°í¬ ì‹¤íŒ¨

**5.1 ë¬´íš¨í™” ì‹¤íŒ¨**

- ìƒí™©: CloudFront ë¬´íš¨í™” ê±°ë¶€
- ì—ëŸ¬ ì½”ë“œ: `CDN_INVALIDATION_FAILED` (500)
- ì¬ì‹œë„: 3íšŒ, ì‹¤íŒ¨ ì‹œ TTL ë§Œë£Œ ëŒ€ê¸°

### 6. íŒŒì´í”„ë¼ì¸ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ì‹¤íŒ¨

**6.1 ì¤‘ê°„ ë‹¨ê³„ ì‹¤íŒ¨**

- ë…ë¦½ì  ë‹¨ê³„ (OCR): ê³„ì† ì§„í–‰
- ì˜ì¡´ì  ë‹¨ê³„ (CDN): ì¤‘ë‹¨
- ë¶€ë¶„ ì„±ê³µ: PARTIALLY_COMPLETED

**6.2 ë³‘ë ¬ ì‘ì—… ì¶©ëŒ**

- ìƒí™©: ë™ì¼ íŒŒì¼ ë™ì‹œ ì²˜ë¦¬
- ì—ëŸ¬ ì½”ë“œ: `PIPELINE_CONCURRENT_EXECUTION` (409)
- í•´ê²°: Redis ë¶„ì‚° ë½, 5ì´ˆ ëŒ€ê¸° í›„ ì¬ì‹œë„

### ì—ëŸ¬ ì½”ë“œ ìš”ì•½

| ì½”ë“œ | HTTP | ì¬ì‹œë„ |
| --- | --- | --- |
| UNSUPPORTED_IMAGE_FORMAT | 400 | âŒ |
| CORRUPTED_IMAGE_FILE | 400 | âŒ |
| IMAGE_PROCESSING_OOM | 500 | âœ… |
| WEBP_CONVERSION_FAILED | 500 | âœ… |
| TEXTRACT_THROTTLED | 429 | âœ… |
| OCR_NO_TEXT_DETECTED | 200 | âŒ |
| CDN_INVALIDATION_FAILED | 500 | âœ… |
| PIPELINE_CONCURRENT_EXECUTION | 409 | âœ… |

### ëª¨ë‹ˆí„°ë§ ì§€í‘œ

**CloudWatch ë©”íŠ¸ë¦­**:

- ImageProcessingSuccessRate
- WebPConversionFailureRate
- ThumbnailGenerationFailureRate
- OCRSuccessRate
- TextractAPIQuotaUsage
- CDNInvalidationFailureCount
- PipelineAverageDuration
- ProcessingJobQueueDepth

**ì•ŒëŒ ì„ê³„ê°’**:

- ì´ë¯¸ì§€ ì²˜ë¦¬ ì‹¤íŒ¨ìœ¨ > 10%
- WebP ë³€í™˜ ì‹¤íŒ¨ìœ¨ > 5%
- OCR ì‹¤íŒ¨ìœ¨ > 15%
- íŒŒì´í”„ë¼ì¸ í‰ê·  ì†Œìš” ì‹œê°„ > 5ë¶„
- ëŒ€ê¸°ì—´ ê¹Šì´ > 100

---

## ğŸ“Š ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨

### 1. ì •ìƒ í”Œë¡œìš°: ì´ë¯¸ì§€ ì—…ë¡œë“œ â†’ íŒŒì´í”„ë¼ì¸ ì™„ë£Œ

```mermaid
sequenceDiagram
    participant E2 as Epic 2<br/>File Upload
    participant Orch as Pipeline<br/>Orchestrator
    participant Opt as Optimization<br/>Service
    participant Thumb as Thumbnail<br/>Service
    participant OCR as OCR<br/>Service
    participant CDN as CDN<br/>Service
    participant S3 as AWS S3
    participant Textract as AWS Textract
    participant CF as CloudFront
    participant DB as MySQL

    %% ì—…ë¡œë“œ ì™„ë£Œ ì´ë²¤íŠ¸
    E2->>+Orch: ì´ë¯¸ì§€ ì—…ë¡œë“œ ì™„ë£Œ<br/>(file_id, S3 key)
    Orch->>+DB: processing_job ìƒì„±<br/>(4ê°œ ë‹¨ê³„)
    DB-->>-Orch: Job ì €ì¥ ì„±ê³µ

    %% Stage 1: ìµœì í™”
    Orch->>+Opt: Stage 1 ì‹¤í–‰
    Opt->>+S3: ì›ë³¸ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
    S3-->>-Opt: ì´ë¯¸ì§€ ë°ì´í„°
    
    Opt->>Opt: WebP ë³€í™˜
    Opt->>Opt: ì´ë¯¸ì§€ ì••ì¶• (90%)
    Opt->>Opt: EXIF ì²˜ë¦¬
    
    Opt->>+S3: ìµœì í™”ëœ ì´ë¯¸ì§€ ì €ì¥
    S3-->>-Opt: ì €ì¥ ì„±ê³µ
    
    Opt->>+DB: Job ìƒíƒœ COMPLETED
    DB-->>-Opt: ì—…ë°ì´íŠ¸ ì„±ê³µ
    Opt-->>-Orch: Stage 1 ì™„ë£Œ

    %% Stage 2: ì¸ë„¤ì¼ (ë³‘ë ¬)
    par ë³‘ë ¬ ì²˜ë¦¬
        Orch->>+Thumb: Stage 2 ì‹¤í–‰
        Thumb->>S3: ìµœì í™”ëœ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
        S3-->>Thumb: ì´ë¯¸ì§€
        
        Thumb->>Thumb: Small (300x300) ìƒì„±
        Thumb->>Thumb: Medium (800x800) ìƒì„±
        
        Thumb->>S3: ì¸ë„¤ì¼ ì €ì¥
        S3-->>Thumb: ì €ì¥ ì„±ê³µ
        
        Thumb->>DB: file_relationship ì €ì¥
        DB-->>Thumb: ì €ì¥ ì„±ê³µ
        
        Thumb->>DB: Job ìƒíƒœ COMPLETED
        DB-->>Thumb: ì—…ë°ì´íŠ¸
        Thumb-->>-Orch: Stage 2 ì™„ë£Œ
    and Stage 3: OCR
        Orch->>+OCR: Stage 3 ì‹¤í–‰
        OCR->>+Textract: DetectDocumentText
        Textract-->>-OCR: í…ìŠ¤íŠ¸ ì¶”ì¶œ ê²°ê³¼
        
        OCR->>OCR: ìƒí’ˆ ì •ë³´ íŒŒì‹±<br/>(ì¬ì§ˆ, ì›ì‚°ì§€, ì„¸íƒ, ì‚¬ì´ì¦ˆ)
        
        OCR->>+DB: file_metadata ì €ì¥
        DB-->>-OCR: ì €ì¥ ì„±ê³µ
        
        OCR->>DB: Job ìƒíƒœ COMPLETED
        DB-->>OCR: ì—…ë°ì´íŠ¸
        OCR-->>-Orch: Stage 3 ì™„ë£Œ
    end

    %% Stage 4: CDN
    Orch->>+CDN: Stage 4 ì‹¤í–‰
    CDN->>+CF: ìºì‹œ ë¬´íš¨í™” ìš”ì²­
    CF-->>-CDN: ë¬´íš¨í™” ì„±ê³µ
    
    CDN->>+DB: file_asset.cdn_url ì—…ë°ì´íŠ¸
    DB-->>-CDN: ì—…ë°ì´íŠ¸ ì„±ê³µ
    
    CDN->>DB: Job ìƒíƒœ COMPLETED
    DB-->>CDN: ì—…ë°ì´íŠ¸
    CDN-->>-Orch: Stage 4 ì™„ë£Œ
    
    Orch-->>-E2: íŒŒì´í”„ë¼ì¸ ì™„ë£Œ
```

### 2. ì—ëŸ¬ í”Œë¡œìš°: ì¸ë„¤ì¼ ìƒì„± ì‹¤íŒ¨

```mermaid
sequenceDiagram
    participant Orch as Orchestrator
    participant Thumb as Thumbnail Service
    participant S3 as AWS S3
    participant DB as MySQL
    participant Slack as Slack

    Orch->>+Thumb: Stage 2 ì‹¤í–‰
    Thumb->>S3: ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
    S3-->>Thumb: ì´ë¯¸ì§€
    
    Thumb->>Thumb: Small ìƒì„± ì‹œë„
    Note over Thumb: ì„±ê³µ
    
    Thumb->>Thumb: Medium ìƒì„± ì‹œë„
    Note over Thumb: ë©”ëª¨ë¦¬ ë¶€ì¡± ì˜¤ë¥˜
    
    Thumb->>S3: Smallë§Œ ì €ì¥
    S3-->>Thumb: ì €ì¥ ì„±ê³µ
    
    Thumb->>DB: file_relationship<br/>(Smallë§Œ)
    DB-->>Thumb: ì €ì¥ ì„±ê³µ
    
    Thumb->>DB: Job ìƒíƒœ<br/>PARTIALLY_COMPLETED
    DB-->>Thumb: ì—…ë°ì´íŠ¸
    
    Thumb->>Slack: ì•Œë¦¼ ì „ì†¡<br/>"Medium ì¸ë„¤ì¼ ì‹¤íŒ¨"
    
    Thumb-->>-Orch: PARTIAL_THUMBNAIL_FAILURE
    
    Note over Orch: OCRì€ ê³„ì† ì§„í–‰<br/>(ë…ë¦½ì  ë‹¨ê³„)
```

### 3. ì—ëŸ¬ í”Œë¡œìš°: Textract ì œí•œ ì´ˆê³¼ ë° ì¬ì‹œë„

```mermaid
sequenceDiagram
    participant Orch as Orchestrator
    participant OCR as OCR Service
    participant Textract as AWS Textract
    participant DB as MySQL
    participant Queue as Retry Queue

    Orch->>+OCR: Stage 3 ì‹¤í–‰
    
    %% 1ì°¨ ì‹œë„
    OCR->>+Textract: DetectDocumentText
    Textract-->>-OCR: 429 TooManyRequests
    
    Note over OCR: 5ë¶„ ëŒ€ê¸°
    
    %% 2ì°¨ ì‹œë„
    OCR->>+Textract: DetectDocumentText
    Textract-->>-OCR: 429 TooManyRequests
    
    Note over OCR: 15ë¶„ ëŒ€ê¸°
    
    %% 3ì°¨ ì‹œë„
    OCR->>+Textract: DetectDocumentText
    Textract-->>-OCR: 429 TooManyRequests
    
    OCR->>+DB: Job ìƒíƒœ FAILED<br/>retry_count=3
    DB-->>-OCR: ì—…ë°ì´íŠ¸
    
    OCR->>+Queue: ë‹¤ìŒë‚  ì¬ì‹œë„ë¡œ ì˜ˆì•½
    Queue-->>-OCR: ì˜ˆì•½ ì„±ê³µ
    
    OCR-->>-Orch: TEXTRACT_THROTTLED
```

- [Thumbnailator](https://github.com/coobird/thumbnailator)
- [Metadata Extractor](https://github.com/drewnoakes/metadata-extractor)

---

## ğŸ”— ê´€ë ¨ ë§í¬

- **Jira Epic**: [KAN-27](https://ryuqqq.atlassian.net/browse/KAN-27)
- **GitHub**: [FileFlow Repository](https://github.com/ryu-qqq/FileFlow)
- **ìƒìœ„ í”„ë¡œì íŠ¸**: ğŸ—ï¸ Setof ê³ ë„í™” í”„ë¡œì íŠ¸
- **ì´ì „ Epic**: Epic 2: íŒŒì¼ ì—…ë¡œë“œ & ì €ì¥