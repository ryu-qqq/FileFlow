# Epic 2: íŒŒì¼ ì—…ë¡œë“œ & ì €ì¥

## ğŸ¯ ëª©í‘œ

ì‹¤ì œ íŒŒì¼ ì—…ë¡œë“œ ê¸°ëŠ¥ êµ¬í˜„ ë° S3 ì €ì¥ì†Œ ì—°ë™

## ğŸ“Š Epic ì •ë³´

- **Jira Epic**: [KAN-10](https://ryuqqq.atlassian.net/browse/KAN-10)
- **ìƒíƒœ**: â³ ëŒ€ê¸° ì¤‘
- **ì˜ˆìƒ ì‹œê°„**: 69ì‹œê°„ (ì•½ 9ì¼)
- **ìš°ì„ ìˆœìœ„**: P1
- **ì˜ì¡´ì„±**: Epic 1 ì™„ë£Œ í•„ìš” (ì •ì±… ê²€ì¦ ë¡œì§ ì‚¬ìš©)

---

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ ê°œìš”

### ì „ì²´ íë¦„

```
1. í´ë¼ì´ì–¸íŠ¸ â†’ API: Presigned URL ìš”ì²­
2. API â†’ ì •ì±… ê²€ì¦ (Epic 1)
3. API â†’ S3: Presigned URL ìƒì„±
4. API â†’ DB: ì—…ë¡œë“œ ì„¸ì…˜ ìƒì„±
5. API â†’ í´ë¼ì´ì–¸íŠ¸: Presigned URL ë°˜í™˜
6. í´ë¼ì´ì–¸íŠ¸ â†’ S3: íŒŒì¼ ì§ì ‘ ì—…ë¡œë“œ
7. S3 â†’ SQS: ì—…ë¡œë“œ ì™„ë£Œ ì´ë²¤íŠ¸
8. SQS â†’ API: ì´ë²¤íŠ¸ ìˆ˜ì‹ 
9. API â†’ íŒŒì¼ ë©”íƒ€ë°ì´í„° ì¶”ì¶œ ë° ì €ì¥
10. API â†’ DB: FileAsset, FileMetadata ì €ì¥
```

### í•µì‹¬ ì»´í¬ë„ŒíŠ¸

- **Presigned URL Generator**: S3 ì—…ë¡œë“œ URL ë°œê¸‰
- **Upload Session Manager**: ì—…ë¡œë“œ ì„¸ì…˜ ê´€ë¦¬
- **S3 Event Handler**: S3 ì´ë²¤íŠ¸ ì²˜ë¦¬
- **Metadata Extractor**: íŒŒì¼ ë©”íƒ€ë°ì´í„° ì¶”ì¶œ

---

## ğŸ“¦ ì£¼ìš” ê¸°ëŠ¥

### 1. Presigned URL ë°œê¸‰ ì‹œìŠ¤í…œ

**ëª©ì **: í´ë¼ì´ì–¸íŠ¸ê°€ S3ì— ì§ì ‘ íŒŒì¼ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆë„ë¡ ì„œëª…ëœ URL ì œê³µ

**êµ¬í˜„ ë‚´ìš©**:

- Epic 1ì˜ ì •ì±… ê²€ì¦ í†µí•©
- S3 PutObject ê¶Œí•œìœ¼ë¡œ Presigned URL ìƒì„±
- ì—…ë¡œë“œ ì„¸ì…˜ ìƒì„± ë° ê´€ë¦¬
- ë§Œë£Œ ì‹œê°„ ì„¤ì • (ê¸°ë³¸ 15ë¶„)

**API ì—”ë“œí¬ì¸íŠ¸**:

```
POST /api/v1/upload/sessions
Request:
{
  "fileName": "product-image.jpg",
  "contentType": "image/jpeg",
  "fileSize": 2048576,
  "tenantId": 1,
  "metadata": {
    "category": "product",
    "productId": "12345"
  }
}

Response:
{
  "sessionId": "550e8400-e29b-41d4-a716-446655440000",
  "presignedUrl": "[https://s3.amazonaws.com/](https://s3.amazonaws.com/)...",
  "expiresAt": "2024-12-25T10:30:00Z",
  "uploadUrl": "[https://s3.amazonaws.com/](https://s3.amazonaws.com/)..."
}
```

### 2. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### upload_session í…Œì´ë¸”

íŒŒì¼ ì—…ë¡œë“œ ì„¸ì…˜ ì •ë³´ ì €ì¥

**ì»¬ëŸ¼**:

- `id`: Primary Key
- `session_id`: UUID (ê³ ìœ  ì‹ë³„ì)
- `tenant_id`: í…Œë„ŒíŠ¸ ID
- `policy_id`: ì ìš©ëœ ì •ì±… ID
- `file_name`: ì›ë³¸ íŒŒì¼ëª…
- `content_type`: MIME íƒ€ì…
- `file_size`: íŒŒì¼ í¬ê¸° (bytes)
- `status`: ìƒíƒœ (PENDING, UPLOADING, COMPLETED, FAILED, CANCELLED)
- `presigned_url`: ë°œê¸‰ëœ Presigned URL
- `s3_key`: S3 ì €ì¥ ê²½ë¡œ
- `expires_at`: URL ë§Œë£Œ ì‹œê°„
- `created_at`, `updated_at`: íƒ€ì„ìŠ¤íƒ¬í”„

### file_asset í…Œì´ë¸”

ì—…ë¡œë“œëœ íŒŒì¼ì˜ ê¸°ë³¸ ì •ë³´ ì €ì¥

**ì»¬ëŸ¼**:

- `id`: Primary Key
- `file_id`: UUID (ê³ ìœ  ì‹ë³„ì)
- `session_id`: ì—…ë¡œë“œ ì„¸ì…˜ ID (FK)
- `tenant_id`: í…Œë„ŒíŠ¸ ID
- `original_file_name`: ì›ë³¸ íŒŒì¼ëª…
- `stored_file_name`: ì €ì¥ëœ íŒŒì¼ëª…
- `s3_bucket`: S3 ë²„í‚·ëª…
- `s3_key`: S3 í‚¤
- `s3_region`: AWS ë¦¬ì „
- `cdn_url`: CDN URL (Epic 3ì—ì„œ ì„¤ì •)
- `file_size`: íŒŒì¼ í¬ê¸°
- `content_type`: MIME íƒ€ì…
- `file_extension`: íŒŒì¼ í™•ì¥ì
- `checksum`: SHA-256 ì²´í¬ì„¬
- `is_public`: ê³µê°œ ì—¬ë¶€
- `created_at`, `updated_at`, `deleted_at`: íƒ€ì„ìŠ¤íƒ¬í”„

### file_metadata í…Œì´ë¸”

íŒŒì¼ì˜ ìƒì„¸ ë©”íƒ€ë°ì´í„° ì €ì¥ (í‚¤-ê°’ êµ¬ì¡°)

**ì»¬ëŸ¼**:

- `id`: Primary Key
- `file_id`: íŒŒì¼ ID (FK)
- `metadata_key`: ë©”íƒ€ë°ì´í„° í‚¤
- `metadata_value`: ë©”íƒ€ë°ì´í„° ê°’ (TEXT)
- `value_type`: ê°’ íƒ€ì… (STRING, NUMBER, JSON, BOOLEAN)
- `created_at`, `updated_at`: íƒ€ì„ìŠ¤íƒ¬í”„

**ë©”íƒ€ë°ì´í„° ì˜ˆì‹œ**:

- ì´ë¯¸ì§€: `width`, `height`, `format`, `color_space`
- ë¹„ë””ì˜¤: `duration`, `resolution`, `codec`, `bitrate`
- ë¬¸ì„œ: `page_count`, `author`, `title`

### file_relationship í…Œì´ë¸”

íŒŒì¼ ê°„ ê´€ê³„ ì €ì¥ (ì›ë³¸-ì¸ë„¤ì¼, ì›ë³¸-ë³€í™˜ë³¸ ë“±)

**ì»¬ëŸ¼**:

- `id`: Primary Key
- `source_file_id`: ì›ë³¸ íŒŒì¼ ID (FK)
- `target_file_id`: ëŒ€ìƒ íŒŒì¼ ID (FK)
- `relationship_type`: ê´€ê³„ íƒ€ì…

### ì œê³µí•˜ëŠ” ê²ƒ âœ…

- âœ… Presigned URL ê¸°ë°˜ ì•ˆì „í•œ íŒŒì¼ ì—…ë¡œë“œ
- âœ… S3 ì§ì ‘ ì—…ë¡œë“œë¡œ ì„œë²„ ë¶€í•˜ ìµœì†Œí™”
- âœ… íŒŒì¼ ë©”íƒ€ë°ì´í„° ìë™ ì¶”ì¶œ ë° ì €ì¥
- âœ… ì—…ë¡œë“œ ì„¸ì…˜ ìƒíƒœ ì¶”ì  ë° ëª¨ë‹ˆí„°ë§
- âœ… Epic 1 ì •ì±… ê²€ì¦ í†µí•©
- âœ… ì´ë¯¸ì§€, ë¹„ë””ì˜¤, ë¬¸ì„œ ë©”íƒ€ë°ì´í„° ì§€ì›
- âœ… íŒŒì¼ ê°„ ê´€ê³„ ê´€ë¦¬ (ì›ë³¸-ì¸ë„¤ì¼ ë“±)
- âœ… ì¬ì‹œë„ ë° Circuit Breaker
- âœ… S3 ì´ë²¤íŠ¸ ê¸°ë°˜ ë¹„ë™ê¸° ì²˜ë¦¬

### ì œê³µí•˜ì§€ ì•ŠëŠ” ê²ƒ âŒ

- âŒ ì´ë¯¸ì§€ ìµœì í™” (Epic 3ì—ì„œ êµ¬í˜„)
- âŒ ì¸ë„¤ì¼ ìƒì„± (Epic 3ì—ì„œ êµ¬í˜„)
- âŒ OCR ì²˜ë¦¬ (Epic 3ì—ì„œ êµ¬í˜„)
- âŒ HTML íŒŒì¼ ì²˜ë¦¬ (Epic 4ì—ì„œ êµ¬í˜„)
- âŒ Excel/PDF AI í‘œì¤€í™” (Epic 5ì—ì„œ êµ¬í˜„)
- âŒ íŒŒì¼ ë°”ì´ëŸ¬ìŠ¤ ìŠ¤ìº” (Epic 6ì—ì„œ êµ¬í˜„)
- âŒ ë©€í‹°íŒŒíŠ¸ ì—…ë¡œë“œ UI (í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„ í•„ìš”)
- âŒ ì—…ë¡œë“œ ì§„í–‰ë¥  ì‹¤ì‹œê°„ WebSocket (HTTP í´ë§ë§Œ ì œê³µ)
- `relationship_metadata`: ê´€ê³„ ë©”íƒ€ë°ì´í„° (JSON)
- `created_at`: ìƒì„± ì‹œê°„

**ê´€ê³„ íƒ€ì…**:

- `THUMBNAIL`: ì¸ë„¤ì¼ ê´€ê³„
- `OPTIMIZED`: ìµœì í™”ëœ íŒŒì¼
- `CONVERTED`: ë³€í™˜ëœ íŒŒì¼
- `DERIVATIVE`: íŒŒìƒ íŒŒì¼
- `VERSION`: ë²„ì „ ê´€ê³„

### 3. S3 Event ì²˜ë¦¬

**ì¸í”„ë¼ ì„¤ì •**:

- S3 Bucket Event Notification ì„¤ì •
- SQS Queue: `fileflow-upload-events`
- Event Type: `ObjectCreated:Put`, `ObjectCreated:CompleteMultipartUpload`

**ì²˜ë¦¬ íë¦„**:

1. S3ì— íŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ
2. S3 â†’ SQS ì´ë²¤íŠ¸ ì „ì†¡
3. SQS Listenerê°€ ë©”ì‹œì§€ ìˆ˜ì‹ 
4. ì„¸ì…˜ IDë¡œ ì—…ë¡œë“œ ì„¸ì…˜ ì¡°íšŒ
5. íŒŒì¼ ë©”íƒ€ë°ì´í„° ì¶”ì¶œ
6. FileAsset, FileMetadata ì €ì¥
7. ì—…ë¡œë“œ ì„¸ì…˜ ìƒíƒœ ì—…ë°ì´íŠ¸ (COMPLETED)

**ì´ë²¤íŠ¸ ë©”ì‹œì§€ êµ¬ì¡°**:

```json
{
  "Records": [
    {
      "eventName": "ObjectCreated:Put",
      "s3": {
        "bucket": {
          "name": "fileflow-storage"
        },
        "object": {
          "key": "uploads/550e8400-e29b-41d4-a716-446655440000/product-image.jpg",
          "size": 2048576
        }
      }
    }
  ]
}
```

### 4. íŒŒì¼ ë©”íƒ€ë°ì´í„° ì¶”ì¶œ

**ì§€ì› íŒŒì¼ íƒ€ì…**:

- **ì´ë¯¸ì§€**: JPEG, PNG, GIF, WebP, BMP, TIFF
- **ë¹„ë””ì˜¤**: MP4, MOV, AVI, WebM
- **ë¬¸ì„œ**: PDF, DOCX, XLSX

**ì¶”ì¶œ ì •ë³´**:

- **ì´ë¯¸ì§€**: í¬ê¸°, í¬ë§·, ìƒ‰ìƒ ê³µê°„, EXIF ë°ì´í„°
- **ë¹„ë””ì˜¤**: í•´ìƒë„, ê¸¸ì´, ì½”ë±, ë¹„íŠ¸ë ˆì´íŠ¸
- **ë¬¸ì„œ**: í˜ì´ì§€ ìˆ˜, ì‘ì„±ì, ì œëª©

**ì „ëµ íŒ¨í„´ ì ìš©**:

```java
interface MetadataExtractionStrategy {
    FileMetadata extract(File file);
}

class ImageMetadataExtractor implements MetadataExtractionStrategy { }
class VideoMetadataExtractor implements MetadataExtractionStrategy { }
class DocumentMetadataExtractor implements MetadataExtractionStrategy { }
```

### 5. ì—…ë¡œë“œ ìƒíƒœ ê´€ë¦¬

**ìƒíƒœ ì „ì´**:

```
PENDING â†’ UPLOADING â†’ COMPLETED
                    â†’ FAILED
        â†’ CANCELLED
```

**ìƒíƒœë³„ ì˜ë¯¸**:

- **PENDING**: ì„¸ì…˜ ìƒì„±ë¨, ì—…ë¡œë“œ ëŒ€ê¸° ì¤‘
- **UPLOADING**: í´ë¼ì´ì–¸íŠ¸ê°€ S3ì— ì—…ë¡œë“œ ì¤‘
- **COMPLETED**: ì—…ë¡œë“œ ì™„ë£Œ, ë©”íƒ€ë°ì´í„° ì €ì¥ ì™„ë£Œ
- **FAILED**: ì—…ë¡œë“œ ì‹¤íŒ¨ ë˜ëŠ” ì²˜ë¦¬ ì‹¤íŒ¨
- **CANCELLED**: ì‚¬ìš©ìê°€ ì·¨ì†Œ

**API ì—”ë“œí¬ì¸íŠ¸**:

```
GET /api/v1/upload/sessions/{sessionId}
Response:
{
  "sessionId": "550e8400-e29b-41d4-a716-446655440000",
  "status": "UPLOADING",
  "progress": 75,
  "uploadedBytes": 1536432,
  "totalBytes": 2048576,
  "createdAt": "2024-12-25T10:00:00Z",
  "expiresAt": "2024-12-25T10:15:00Z"
}
```

### 6. ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜

**ì¬ì‹œë„ ëŒ€ìƒ**:

- S3 ì¼ì‹œì  ì˜¤ë¥˜ (5xx)
- ë„¤íŠ¸ì›Œí¬ íƒ€ì„ì•„ì›ƒ
- SQS ë©”ì‹œì§€ ì²˜ë¦¬ ì‹¤íŒ¨

**ì¬ì‹œë„ ì „ëµ**:

- Exponential Backoff
- ìµœëŒ€ ì¬ì‹œë„: 3íšŒ
- ì´ˆê¸° ëŒ€ê¸°: 1ì´ˆ
- ìµœëŒ€ ëŒ€ê¸°: 10ì´ˆ

**Circuit Breaker**:

- Resilience4j ì‚¬ìš©
- ì‹¤íŒ¨ìœ¨ ì„ê³„ê°’: 50%
- ëŒ€ê¸° ì‹œê°„: 30ì´ˆ

---

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
src/main/java/com/fileflow/
â”œâ”€â”€ domain/
â”‚   â””â”€â”€ upload/
â”‚       â”œâ”€â”€ model/
â”‚       â”‚   â”œâ”€â”€ [UploadSession.java](http://UploadSession.java)
â”‚       â”‚   â”œâ”€â”€ [UploadRequest.java](http://UploadRequest.java)
â”‚       â”‚   â””â”€â”€ [PresignedUrlInfo.java](http://PresignedUrlInfo.java)
â”‚       â”œâ”€â”€ command/
â”‚       â”‚   â””â”€â”€ [FileUploadCommand.java](http://FileUploadCommand.java)
â”‚       â””â”€â”€ event/
â”‚           â”œâ”€â”€ [PresignedUrlRequested.java](http://PresignedUrlRequested.java)
â”‚           â””â”€â”€ [UploadSessionCreated.java](http://UploadSessionCreated.java)
â”œâ”€â”€ application/
â”‚   â”œâ”€â”€ port/
â”‚   â”‚   â”œâ”€â”€ in/
â”‚   â”‚   â”‚   â”œâ”€â”€ [CreateUploadSessionUseCase.java](http://CreateUploadSessionUseCase.java)
â”‚   â”‚   â”‚   â”œâ”€â”€ [GetUploadSessionUseCase.java](http://GetUploadSessionUseCase.java)
â”‚   â”‚   â”‚   â””â”€â”€ [CompleteUploadSessionUseCase.java](http://CompleteUploadSessionUseCase.java)
â”‚   â”‚   â””â”€â”€ out/
â”‚   â”‚       â”œâ”€â”€ [PolicyValidationPort.java](http://PolicyValidationPort.java)
â”‚   â”‚       â”œâ”€â”€ [PresignedUrlPort.java](http://PresignedUrlPort.java)
â”‚   â”‚       â””â”€â”€ [UploadSessionPort.java](http://UploadSessionPort.java)
â”‚   â””â”€â”€ service/
â”‚       â”œâ”€â”€ [UploadSessionService.java](http://UploadSessionService.java)
â”‚       â”œâ”€â”€ [MetadataExtractionService.java](http://MetadataExtractionService.java)
â”‚       â””â”€â”€ [UploadPolicyValidationService.java](http://UploadPolicyValidationService.java)
â”œâ”€â”€ adapter/
â”‚   â”œâ”€â”€ in/
â”‚   â”‚   â”œâ”€â”€ web/
â”‚   â”‚   â”‚   â”œâ”€â”€ [UploadController.java](http://UploadController.java)
â”‚   â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”‚   â”‚       â”œâ”€â”€ [UploadSessionRequest.java](http://UploadSessionRequest.java)
â”‚   â”‚   â”‚       â””â”€â”€ [UploadSessionResponse.java](http://UploadSessionResponse.java)
â”‚   â”‚   â””â”€â”€ event/
â”‚   â”‚       â”œâ”€â”€ [S3EventListener.java](http://S3EventListener.java)
â”‚   â”‚       â””â”€â”€ handler/
â”‚   â”‚           â””â”€â”€ [S3UploadEventHandler.java](http://S3UploadEventHandler.java)
â”‚   â””â”€â”€ out/
â”‚       â”œâ”€â”€ storage/
â”‚       â”‚   â”œâ”€â”€ [S3PresignedUrlAdapter.java](http://S3PresignedUrlAdapter.java)
â”‚       â”‚   â””â”€â”€ config/
â”‚       â”‚       â””â”€â”€ [S3Config.java](http://S3Config.java)
â”‚       â””â”€â”€ persistence/
â”‚           â”œâ”€â”€ entity/
â”‚           â”‚   â”œâ”€â”€ [UploadSessionEntity.java](http://UploadSessionEntity.java)
â”‚           â”‚   â”œâ”€â”€ [FileAssetEntity.java](http://FileAssetEntity.java)
â”‚           â”‚   â”œâ”€â”€ [FileMetadataEntity.java](http://FileMetadataEntity.java)
â”‚           â”‚   â””â”€â”€ [FileRelationshipEntity.java](http://FileRelationshipEntity.java)
â”‚           â”œâ”€â”€ repository/
â”‚           â”‚   â”œâ”€â”€ [UploadSessionRepository.java](http://UploadSessionRepository.java)
â”‚           â”‚   â”œâ”€â”€ [FileAssetRepository.java](http://FileAssetRepository.java)
â”‚           â”‚   â””â”€â”€ [FileMetadataRepository.java](http://FileMetadataRepository.java)
â”‚           â””â”€â”€ adapter/
â”‚               â”œâ”€â”€ [UploadSessionAdapter.java](http://UploadSessionAdapter.java)
â”‚               â””â”€â”€ [FileAssetAdapter.java](http://FileAssetAdapter.java)
```

---

## ğŸ”§ ê¸°ìˆ  ìŠ¤íƒ

### Backend

- **Language**: Java 17
- **Framework**: Spring Boot 3.x
- **Architecture**: Hexagonal Architecture

### AWS Services

- **S3**: íŒŒì¼ ì €ì¥ì†Œ
- **SQS**: ì´ë²¤íŠ¸ í
- **IAM**: ê¶Œí•œ ê´€ë¦¬

### Database

- **MySQL 8.0**: ë©”ì¸ ë°ì´í„°ë² ì´ìŠ¤
- **Redis**: ì„¸ì…˜ ìºì‹±
- **Flyway**: ë§ˆì´ê·¸ë ˆì´ì…˜

### Libraries

- **AWS SDK for Java v2**: AWS ì„œë¹„ìŠ¤ ì—°ë™
- **Apache Commons Imaging**: ì´ë¯¸ì§€ ë©”íƒ€ë°ì´í„°
- **Metadata Extractor**: EXIF ë°ì´í„°
- **Spring Retry**: ì¬ì‹œë„ ë¡œì§
- **Resilience4j**: Circuit Breaker

---

## ğŸ“Š ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨

### 1. ì •ìƒ í”Œë¡œìš°: Presigned URL ë°œê¸‰ ~ ì—…ë¡œë“œ ì™„ë£Œ

```mermaid
sequenceDiagram
    participant C as Client
    participant API as FileFlow API
    participant P1 as Epic 1<br/>Policy Service
    participant S3 as AWS S3
    participant DB as MySQL
    participant SQS as AWS SQS
    participant H as Event Handler

    %% Phase 1: Presigned URL ë°œê¸‰
    C->>+API: POST /api/v1/upload/sessions<br/>{fileName, contentType, fileSize}
    API->>+P1: ì •ì±… ê²€ì¦ ìš”ì²­
    P1-->>-API: ì •ì±… í—ˆìš© (OK)
    
    API->>+S3: Presigned URL ìƒì„± ìš”ì²­
    S3-->>-API: Presigned URL ë°˜í™˜
    
    API->>+DB: UploadSession ì €ì¥<br/>(status: PENDING)
    DB-->>-API: Session ì €ì¥ ì„±ê³µ
    
    API-->>-C: 200 OK<br/>{sessionId, presignedUrl}

    %% Phase 2: íŒŒì¼ ì—…ë¡œë“œ
    C->>+S3: PUT presignedUrl<br/>(file data)
    S3-->>-C: 200 OK
    
    %% Phase 3: ì´ë²¤íŠ¸ ì²˜ë¦¬
    S3->>SQS: S3 Event ì „ì†¡<br/>(ObjectCreated:Put)
    
    SQS->>+H: ë©”ì‹œì§€ ìˆ˜ì‹ 
    H->>+DB: session_idë¡œ<br/>UploadSession ì¡°íšŒ
    DB-->>-H: UploadSession ë°˜í™˜
    
    H->>H: íŒŒì¼ ë©”íƒ€ë°ì´í„° ì¶”ì¶œ
    
    H->>+DB: FileAsset ì €ì¥
    DB-->>-H: ì €ì¥ ì„±ê³µ
    
    H->>+DB: FileMetadata ì €ì¥
    DB-->>-H: ì €ì¥ ì„±ê³µ
    
    H->>+DB: UploadSession ìƒíƒœ ì—…ë°ì´íŠ¸<br/>(status: COMPLETED)
    DB-->>-H: ì—…ë°ì´íŠ¸ ì„±ê³µ
    
    H->>-SQS: ë©”ì‹œì§€ ì‚­ì œ (ACK)

    %% Phase 4: ìƒíƒœ í™•ì¸
    C->>+API: GET /api/v1/upload/sessions/{sessionId}
    API->>+DB: UploadSession ì¡°íšŒ
    DB-->>-API: Session ë°˜í™˜
    API-->>-C: 200 OK<br/>{status: COMPLETED}
```

### 2. ì—ëŸ¬ í”Œë¡œìš°: ì •ì±… ìœ„ë°˜

```mermaid
sequenceDiagram
    participant C as Client
    participant API as FileFlow API
    participant P1 as Epic 1<br/>Policy Service

    C->>+API: POST /api/v1/upload/sessions<br/>{fileName, contentType, fileSize: 100MB}
    API->>+P1: ì •ì±… ê²€ì¦ ìš”ì²­
    P1-->>-API: ì •ì±… ê±°ë¶€<br/>(maxSize: 10MB)
    API-->>-C: 403 Forbidden<br/>{error: POLICY_VIOLATION}
```

### 3. ì—ëŸ¬ í”Œë¡œìš°: S3 ì´ë²¤íŠ¸ ì²˜ë¦¬ ì‹¤íŒ¨ ë° ì¬ì‹œë„

```mermaid
sequenceDiagram
    participant S3 as AWS S3
    participant SQS as AWS SQS
    participant H as Event Handler
    participant DB as MySQL
    participant DLQ as Dead Letter Queue
    participant Slack as Slack

    S3->>SQS: S3 Event ì „ì†¡
    
    %% 1ì°¨ ì‹œë„
    SQS->>+H: ë©”ì‹œì§€ ìˆ˜ì‹  (1ì°¨)
    H->>DB: FileAsset ì €ì¥ ì‹œë„
    DB-->>H: ì˜¤ë¥˜ ë°œìƒ (Connection Timeout)
    H-->>-SQS: ì²˜ë¦¬ ì‹¤íŒ¨ (NACK)
    
    Note over SQS: Visibility Timeout (5ë¶„) ëŒ€ê¸°
    
    %% 2ì°¨ ì‹œë„
    SQS->>+H: ë©”ì‹œì§€ ìˆ˜ì‹  (2ì°¨)
    H->>DB: FileAsset ì €ì¥ ì‹œë„
    DB-->>H: ì˜¤ë¥˜ ë°œìƒ (Connection Timeout)
    H-->>-SQS: ì²˜ë¦¬ ì‹¤íŒ¨ (NACK)
    
    Note over SQS: Visibility Timeout (5ë¶„) ëŒ€ê¸°
    
    %% 3ì°¨ ì‹œë„
    SQS->>+H: ë©”ì‹œì§€ ìˆ˜ì‹  (3ì°¨)
    H->>DB: FileAsset ì €ì¥ ì‹œë„
    DB-->>H: ì˜¤ë¥˜ ë°œìƒ (Connection Timeout)
    H-->>-SQS: ì²˜ë¦¬ ì‹¤íŒ¨ (NACK)
    
    %% DLQ ì´ë™
    SQS->>DLQ: ë©”ì‹œì§€ ì´ë™<br/>(maxReceiveCount ì´ˆê³¼)
    
    DLQ->>Slack: ì•Œë¦¼ ì „ì†¡<br/>"íŒŒì¼ ì—…ë¡œë“œ ì´ë²¤íŠ¸ ì²˜ë¦¬ ì‹¤íŒ¨"
```

---

## ğŸ“‹ Task ëª©ë¡

### Phase 1: ê¸°ë³¸ êµ¬ì¡° (19ì‹œê°„)

- [KAN-11](https://ryuqqq.atlassian.net/browse/KAN-11) - Presigned URL ë°œê¸‰ ìš”ì²­ ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„ (Domain ëª¨ë¸) - 4h
- [KAN-12](https://ryuqqq.atlassian.net/browse/KAN-12) - Epic 1 ì •ì±… ê²€ì¦ í†µí•© (Port êµ¬í˜„) - 6h
- [KAN-13](https://ryuqqq.atlassian.net/browse/KAN-13) - S3 Presigned URL ìƒì„± ë¡œì§ (Adapter) - 5h
- [KAN-14](https://ryuqqq.atlassian.net/browse/KAN-14) - ì—…ë¡œë“œ ì„¸ì…˜ ìƒì„± ë° ê´€ë¦¬ (UseCase) - 5h
- [KAN-15](https://ryuqqq.atlassian.net/browse/KAN-15) - upload_session í…Œì´ë¸” ì„¤ê³„ ë° ìƒì„± - 3h
- [KAN-16](https://ryuqqq.atlassian.net/browse/KAN-16) - file_asset í…Œì´ë¸” ì„¤ê³„ ë° ìƒì„± - 3h
- [KAN-17](https://ryuqqq.atlassian.net/browse/KAN-17) - file_metadata í…Œì´ë¸” ì„¤ê³„ ë° ìƒì„± - 3h
- [KAN-18](https://ryuqqq.atlassian.net/browse/KAN-18) - file_relationship í…Œì´ë¸” ì„¤ê³„ ë° ìƒì„± - 3h

### Phase 2: S3 ì´ë²¤íŠ¸ ì²˜ë¦¬ (15ì‹œê°„)

- [KAN-19](https://ryuqqq.atlassian.net/browse/KAN-19) - S3 Event Notification ì„¤ì • (ì¸í”„ë¼) - 4h
- [KAN-20](https://ryuqqq.atlassian.net/browse/KAN-20) - S3 Event ìˆ˜ì‹  í•¸ë“¤ëŸ¬ êµ¬í˜„ - 5h
- [KAN-21](https://ryuqqq.atlassian.net/browse/KAN-21) - íŒŒì¼ ë©”íƒ€ë°ì´í„° ì¶”ì¶œ ë° ì €ì¥ - 6h

### Phase 3: ìƒíƒœ ê´€ë¦¬ & ë³µì›ë ¥ (13ì‹œê°„)

- [KAN-22](https://ryuqqq.atlassian.net/browse/KAN-22) - ì—…ë¡œë“œ ì§„í–‰ë¥  ì¶”ì  API - 4h
- [KAN-23](https://ryuqqq.atlassian.net/browse/KAN-23) - ì—…ë¡œë“œ ì„±ê³µ/ì‹¤íŒ¨ ì²˜ë¦¬ ë¡œì§ - 5h
- [KAN-24](https://ryuqqq.atlassian.net/browse/KAN-24) - ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜ êµ¬í˜„ - 4h

### Phase 4: í’ˆì§ˆ ë³´ì¦ (9ì‹œê°„)

- [KAN-25](https://ryuqqq.atlassian.net/browse/KAN-25) - í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„± - 6h
- [KAN-26](https://ryuqqq.atlassian.net/browse/KAN-26) - API ë¬¸ì„œí™” (Swagger/OpenAPI) - 3h

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì „ëµ

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

- Domain ëª¨ë¸ ë¡œì§ ê²€ì¦
- UseCase ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ í…ŒìŠ¤íŠ¸
- Adapter êµ¬í˜„ í…ŒìŠ¤íŠ¸
- ëª©í‘œ ì»¤ë²„ë¦¬ì§€: 80% ì´ìƒ

### í†µí•© í…ŒìŠ¤íŠ¸

- End-to-End ì—…ë¡œë“œ íë¦„ í…ŒìŠ¤íŠ¸
- S3 ì´ë²¤íŠ¸ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸ (LocalStack)
- ì •ì±… ê²€ì¦ í†µí•© í…ŒìŠ¤íŠ¸
- ì¬ì‹œë„ ë¡œì§ í…ŒìŠ¤íŠ¸

### ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

- ë™ì‹œ ì—…ë¡œë“œ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸
- ëŒ€ìš©ëŸ‰ íŒŒì¼ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸
- ë©”íƒ€ë°ì´í„° ì¶”ì¶œ ì„±ëŠ¥ ì¸¡ì •

---

## ğŸš€ ë°°í¬ ì „ëµ

### í™˜ê²½ë³„ ì„¤ì •

- **ê°œë°œ(dev)**: LocalStack ì‚¬ìš©
- **ìŠ¤í…Œì´ì§•(staging)**: ì‹¤ì œ AWS ì„œë¹„ìŠ¤
- **í”„ë¡œë•ì…˜(prod)**: ì‹¤ì œ AWS ì„œë¹„ìŠ¤ + ëª¨ë‹ˆí„°ë§

### ì¸í”„ë¼ ì½”ë“œ

- Terraformìœ¼ë¡œ ê´€ë¦¬
- S3 Bucket, SQS Queue, IAM Policy
- í™˜ê²½ë³„ ë³€ìˆ˜ ë¶„ë¦¬

---

## ğŸ“Š ëª¨ë‹ˆí„°ë§ & ì•Œë¦¼

### ì£¼ìš” ë©”íŠ¸ë¦­

- ì—…ë¡œë“œ ì„±ê³µë¥ 
- í‰ê·  ì—…ë¡œë“œ ì‹œê°„
- S3 ì´ë²¤íŠ¸ ì²˜ë¦¬ ì§€ì—°ì‹œê°„
- ì‹¤íŒ¨í•œ ì„¸ì…˜ ìˆ˜

### CloudWatch Alarms

- SQS Queue ê¹Šì´ > 100
- ì—…ë¡œë“œ ì‹¤íŒ¨ìœ¨ > 5%
- DLQ ë©”ì‹œì§€ ìˆ˜ > 0

### Slack ì•Œë¦¼

- ì—…ë¡œë“œ ì‹¤íŒ¨ ì•Œë¦¼
- ì‹œìŠ¤í…œ ì—ëŸ¬ ì•Œë¦¼
- DLQ ë©”ì‹œì§€ ì•Œë¦¼

---

## ğŸ” ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### Presigned URL

- ë§Œë£Œ ì‹œê°„ ì œí•œ (15ë¶„)
- HTTPS ê°•ì œ
- Content-Type ê²€ì¦

### S3 Bucket Policy

- ìµœì†Œ ê¶Œí•œ ì›ì¹™
- Public Access ì°¨ë‹¨
- Encryption at Rest (AES-256)

### íŒŒì¼ ê²€ì¦

- íŒŒì¼ í¬ê¸° ì œí•œ
- MIME íƒ€ì… ê²€ì¦
- ì•…ì„± íŒŒì¼ ìŠ¤ìº” (Epic 6ì—ì„œ êµ¬í˜„)

---

## ğŸ“ˆ ì„±ëŠ¥ ìµœì í™”

### ìºì‹± ì „ëµ

- Redisì— ì—…ë¡œë“œ ì„¸ì…˜ ìºì‹±
- ì •ì±… ì¡°íšŒ ê²°ê³¼ ìºì‹± (Epic 1)
- TTL: 15ë¶„

### ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”

- ì ì ˆí•œ ì¸ë±ìŠ¤ ì„¤ì •
- Connection Pool íŠœë‹
- ì½ê¸° ë³µì œë³¸ í™œìš© (í”„ë¡œë•ì…˜)

### ë¹„ë™ê¸° ì²˜ë¦¬

- S3 ì´ë²¤íŠ¸ ë¹„ë™ê¸° ì²˜ë¦¬
- ë©”íƒ€ë°ì´í„° ì¶”ì¶œ ë¹„ë™ê¸° ì²˜ë¦¬
- SQS Batch ì²˜ë¦¬

---

## ğŸš¨ ì—ëŸ¬ ì²˜ë¦¬ ì‹œë‚˜ë¦¬ì˜¤

### 1. Presigned URL ë°œê¸‰ ì‹¤íŒ¨ ì‹œë‚˜ë¦¬ì˜¤

### 1.1 ì •ì±… ê²€ì¦ ì‹¤íŒ¨

**ìƒí™©**: Epic 1 ì •ì±…ì—ì„œ íŒŒì¼ íƒ€ì…/í¬ê¸° ê±°ë¶€

**ì—ëŸ¬ ì½”ë“œ**: `POLICY_VIOLATION`

**HTTP ìƒíƒœ**: 403 Forbidden

**ì‘ë‹µ**:

```json
{
  "error": "POLICY_VIOLATION",
  "message": "íŒŒì¼ í¬ê¸°ê°€ ì •ì±… í—ˆìš© ë²”ìœ„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤",
  "details": {
    "maxFileSize": 10485760,
    "requestedSize": 20971520,
    "allowedTypes": ["image/jpeg", "image/png"]
  }
}
```

**í´ë¼ì´ì–¸íŠ¸ ëŒ€ì‘**: ì‚¬ìš©ìì—ê²Œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ

### 1.2 S3 ì„œë¹„ìŠ¤ ì¼ì‹œì  ì˜¤ë¥˜ (5xx)

**ìƒí™©**: AWS S3 API í˜¸ì¶œ ì‹¤íŒ¨

**ì—ëŸ¬ ì½”ë“œ**: `S3_SERVICE_UNAVAILABLE`

**HTTP ìƒíƒœ**: 503 Service Unavailable

**ì¬ì‹œë„ ì „ëµ**:

- 1ì°¨: 1ì´ˆ ëŒ€ê¸° í›„ ì¬ì‹œë„
- 2ì°¨: 2ì´ˆ ëŒ€ê¸° í›„ ì¬ì‹œë„
- 3ì°¨: 4ì´ˆ ëŒ€ê¸° í›„ ì¬ì‹œë„
- 3íšŒ ì‹¤íŒ¨ ì‹œ ìµœì¢… ì‹¤íŒ¨ ë°˜í™˜

**ì‘ë‹µ**:

```json
{
  "error": "S3_SERVICE_UNAVAILABLE",
  "message": "S3 ì„œë¹„ìŠ¤ê°€ ì¼ì‹œì ìœ¼ë¡œ ì‚¬ìš© ë¶ˆê°€í•©ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
  "retryAfter": 5
}
}
```

### 1.3 ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨

**ìƒí™©**: MySQL ì—°ê²° í’€ ê³ ê°ˆ ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ

**ì—ëŸ¬ ì½”ë“œ**: `DATABASE_CONNECTION_ERROR`

**HTTP ìƒíƒœ**: 503 Service Unavailable

**Circuit Breaker ë™ì‘**: ì‹¤íŒ¨ìœ¨ 50% ì´ˆê³¼ ì‹œ 30ì´ˆê°„ ì°¨ë‹¨

### 2. íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨ ì‹œë‚˜ë¦¬ì˜¤

### 2.1 Presigned URL ë§Œë£Œ

**ìƒí™©**: 15ë¶„ ë‚´ì— ì—…ë¡œë“œ ì‹œì‘í•˜ì§€ ì•ŠìŒ

**S3 ì‘ë‹µ**: 403 Forbidden (AccessDenied)

**í´ë¼ì´ì–¸íŠ¸ ëŒ€ì‘**:

1. ì„¸ì…˜ ìƒíƒœ ì¡°íšŒ API í˜¸ì¶œ
2. ì„¸ì…˜ì´ PENDING ìƒíƒœë©´ ìƒˆë¡œìš´ Presigned URL ìš”ì²­
3. ì„¸ì…˜ì´ EXPIREDë©´ ìƒˆ ì„¸ì…˜ ìƒì„±

### 2.2 ë„¤íŠ¸ì›Œí¬ ë‹¨ì ˆ

**ìƒí™©**: ì—…ë¡œë“œ ì¤‘ ë„¤íŠ¸ì›Œí¬ ë‹¨ì ˆ

**í•´ê²° ë°©ë²•**: S3 Multipart Upload ì‚¬ìš©

- í´ë¼ì´ì–¸íŠ¸ëŠ” ë‹¨ì ˆëœ ë¶€ë¶„ë¶€í„° ì¬ê°œ
- ì„¸ì…˜ì€ ë§Œë£Œ ì‹œê°„ê¹Œì§€ ìœ íš¨
- ê¸°ì¡´ ì„¸ì…˜ IDë¡œ ì—…ë¡œë“œ ì¬ê°œ ê°€ëŠ¥

### 2.3 íŒŒì¼ í¬ê¸° ë¶ˆì¼ì¹˜

**ìƒí™©**: ì‹¤ì œ ì—…ë¡œë“œëœ íŒŒì¼ í¬ê¸° â‰  ìš”ì²­ ì‹œ ëª…ì‹œí•œ í¬ê¸°

**ê²€ì¦**: S3 Event ì²˜ë¦¬ ì‹œ í¬ê¸° ë¹„êµ

**ì—ëŸ¬ ì½”ë“œ**: `FILE_SIZE_MISMATCH`

**ì²˜ë¦¬**:

1. ì„¸ì…˜ ìƒíƒœë¥¼ FAILEDë¡œ ë³€ê²½
2. S3ì—ì„œ íŒŒì¼ ì‚­ì œ
3. í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì—ëŸ¬ í†µì§€ (Webhook or Polling)

### 2.4 Content-Type ë¶ˆì¼ì¹˜

**ìƒí™©**: ìš”ì²­í•œ Content-Typeê³¼ ì‹¤ì œ íŒŒì¼ì˜ MIME íƒ€ì… ë¶ˆì¼ì¹˜

**ê²€ì¦**: ë©”íƒ€ë°ì´í„° ì¶”ì¶œ ì‹œ Apache Tikaë¡œ ì‹¤ì œ MIME íƒ€ì… í™•ì¸

**ì—ëŸ¬ ì½”ë“œ**: `CONTENT_TYPE_MISMATCH`

**ì²˜ë¦¬ ì˜µì…˜**:

1. **ì—„ê²© ëª¨ë“œ**: ì—…ë¡œë“œ ê±°ë¶€ (B2B í…Œë‚œíŠ¸)
2. **ê´€ëŒ€ ëª¨ë“œ**: ê²½ê³  ë¡œê·¸ ê¸°ë¡ í›„ í—ˆìš© (B2C í…Œë‚œíŠ¸)

### 3. S3 ì´ë²¤íŠ¸ ì²˜ë¦¬ ì‹¤íŒ¨ ì‹œë‚˜ë¦¬ì˜¤

### 3.1 SQS ë©”ì‹œì§€ ì²˜ë¦¬ ì‹¤íŒ¨

**ìƒí™©**: ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ ì˜ˆì™¸ ë°œìƒ

**ì¬ì‹œë„ ì „ëµ**:

- SQS Visibility Timeout: 5ë¶„
- ìµœëŒ€ ìˆ˜ì‹  íšŸìˆ˜: 3íšŒ
- 3íšŒ ì‹¤íŒ¨ í›„ DLQ(Dead Letter Queue)ë¡œ ì´ë™

**DLQ ì²˜ë¦¬**:

1. CloudWatch Alarm ë°œë™
2. Slackìœ¼ë¡œ ì•Œë¦¼ ì „ì†¡
3. ìˆ˜ë™ ì¡°ì‚¬ ë° ì¬ì²˜ë¦¬

### 3.2 ë©”íƒ€ë°ì´í„° ì¶”ì¶œ ì‹¤íŒ¨

**ìƒí™©**: ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ ë˜ëŠ” ì†ìƒëœ íŒŒì¼

**ì—ëŸ¬ ì½”ë“œ**: `METADATA_EXTRACTION_FAILED`

**ì²˜ë¦¬**:

1. FileAssetëŠ” ì €ì¥ (ê¸°ë³¸ ì •ë³´ë§Œ)
2. FileMetadata ì €ì¥ ìŠ¤í‚µ
3. ì„¸ì…˜ ìƒíƒœë¥¼ COMPLETED_WITH_WARNINGSë¡œ ë³€ê²½
4. ë¡œê·¸ì— ê²½ê³  ê¸°ë¡

### 3.3 ë°ì´í„°ë² ì´ìŠ¤ íŠ¸ëœì­ì…˜ ì‹¤íŒ¨

**ìƒí™©**: FileAsset ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ

**ë¡¤ë°± ì „ëµ**:

1. íŠ¸ëœì­ì…˜ ë¡¤ë°±
2. SQS ë©”ì‹œì§€ ì¬ì‹œë„ (ê°€ì‹œì„± íƒ€ì„ì•„ì›ƒ í›„)
3. ì„¸ì…˜ ìƒíƒœëŠ” UPLOADING ìœ ì§€

### 4. ë™ì‹œì„± ë¬¸ì œ ì‹œë‚˜ë¦¬ì˜¤

### 4.1 ë™ì¼ ì„¸ì…˜ IDë¡œ ì¤‘ë³µ ì´ë²¤íŠ¸ ìˆ˜ì‹ 

**ìƒí™©**: S3ê°€ ë™ì¼ ì´ë²¤íŠ¸ë¥¼ ì—¬ëŸ¬ ë²ˆ ì „ì†¡ (ë“œë¬¼ê²Œ ë°œìƒ)

**í•´ê²° ë°©ë²•**: ë©±ë“±ì„± ë³´ì¥ (Idempotency)

- ì„¸ì…˜ ìƒíƒœê°€ ì´ë¯¸ COMPLETEDë©´ ìŠ¤í‚µ
- DB Unique Constraint: `upload_session.session_id`
- ì¤‘ë³µ ì²˜ë¦¬ ì‹œ ë¡œê·¸ë§Œ ê¸°ë¡

### 4.2 Race Condition

**ìƒí™©**: ì—¬ëŸ¬ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ê°€ ë™ì‹œì— ë™ì¼ ì„¸ì…˜ ì—…ë°ì´íŠ¸

**í•´ê²° ë°©ë²•**: ë‚™ê´€ì  ë½ (Optimistic Locking)

- `upload_session.version` ì»¬ëŸ¼ ì¶”ê°€
- ì—…ë°ì´íŠ¸ ì‹œ version ì²´í¬
- ì¶©ëŒ ë°œìƒ ì‹œ ì¬ì‹œë„

### 5. ì—ëŸ¬ ì½”ë“œ ì •ì˜

| ì—ëŸ¬ ì½”ë“œ | HTTP ìƒíƒœ | ì„¤ëª… | ì¬ì‹œë„ ê°€ëŠ¥ |
| --- | --- | --- | --- |
| `POLICY_VIOLATION` | 403 | ì •ì±… ìœ„ë°˜ | âŒ |
| `INVALID_FILE_TYPE` | 400 | í—ˆìš©ë˜ì§€ ì•ŠëŠ” íŒŒì¼ íƒ€ì… | âŒ |
| `FILE_TOO_LARGE` | 413 | íŒŒì¼ í¬ê¸° ì´ˆê³¼ | âŒ |
| `S3_SERVICE_UNAVAILABLE` | 503 | S3 ì¼ì‹œì  ì˜¤ë¥˜ | âœ… |
| `DATABASE_CONNECTION_ERROR` | 503 | DB ì—°ê²° ì‹¤íŒ¨ | âœ… |
| `SESSION_NOT_FOUND` | 404 | ì„¸ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ | âŒ |
| `SESSION_EXPIRED` | 410 | ì„¸ì…˜ ë§Œë£Œ | âŒ |
| `FILE_SIZE_MISMATCH` | 400 | íŒŒì¼ í¬ê¸° ë¶ˆì¼ì¹˜ | âŒ |
| `CONTENT_TYPE_MISMATCH` | 400 | Content-Type ë¶ˆì¼ì¹˜ | âŒ |
| `METADATA_EXTRACTION_FAILED` | 500 | ë©”íƒ€ë°ì´í„° ì¶”ì¶œ ì‹¤íŒ¨ | âœ… |
| `CHECKSUM_MISMATCH` | 400 | ì²´í¬ì„¬ ë¶ˆì¼ì¹˜ | âŒ |
| `CONCURRENT_MODIFICATION` | 409 | ë™ì‹œ ìˆ˜ì • ì¶©ëŒ | âœ… |
| `INTERNAL_SERVER_ERROR` | 500 | ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ | âœ… |

### 6. ì—ëŸ¬ ëª¨ë‹ˆí„°ë§ ì§€í‘œ

**CloudWatch ë©”íŠ¸ë¦­**:

- `UploadFailureRate`: ì—…ë¡œë“œ ì‹¤íŒ¨ìœ¨
- `PolicyViolationCount`: ì •ì±… ìœ„ë°˜ íšŸìˆ˜
- `S3ErrorRate`: S3 API ì˜¤ë¥˜ìœ¨
- `MetadataExtractionFailureRate`: ë©”íƒ€ë°ì´í„° ì¶”ì¶œ ì‹¤íŒ¨ìœ¨
- `DLQMessageCount`: DLQ ë©”ì‹œì§€ ìˆ˜

**ì•ŒëŒ ì„ê³„ê°’**:

- ì—…ë¡œë“œ ì‹¤íŒ¨ìœ¨ > 5%
- DLQ ë©”ì‹œì§€ ìˆ˜ > 0
- ë©”íƒ€ë°ì´í„° ì¶”ì¶œ ì‹¤íŒ¨ìœ¨ > 10%

---

## â“ FAQ

### Q1: ì—…ë¡œë“œ ì¤‘ ë„¤íŠ¸ì›Œí¬ê°€ ëŠê¸°ë©´?

A: í´ë¼ì´ì–¸íŠ¸ëŠ” S3 Multipart Uploadë¥¼ ì‚¬ìš©í•˜ì—¬ ì¬ê°œ ê°€ëŠ¥. ì„¸ì…˜ì€ ë§Œë£Œ ì‹œê°„ê¹Œì§€ ìœ íš¨.

### Q2: ë™ì¼í•œ íŒŒì¼ì„ ì—¬ëŸ¬ ë²ˆ ì—…ë¡œë“œí•˜ë©´?

A: ê° ì—…ë¡œë“œë§ˆë‹¤ ìƒˆë¡œìš´ ì„¸ì…˜ê³¼ íŒŒì¼ ID ìƒì„±. ì¤‘ë³µ ì œê±°ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ì—ì„œ ì²˜ë¦¬.

### Q3: ëŒ€ìš©ëŸ‰ íŒŒì¼ (> 5GB) ì§€ì›?

A: S3 Multipart Upload ì‚¬ìš©. ìµœëŒ€ 5TBê¹Œì§€ ì§€ì› ê°€ëŠ¥.

### Q4: ì—…ë¡œë“œ ì™„ë£Œ í›„ ì›ë³¸ íŒŒì¼ ì‚­ì œ ê°€ëŠ¥?

A: Soft Delete ì§€ì›. `deleted_at` í•„ë“œ ì—…ë°ì´íŠ¸. ì‹¤ì œ ì‚­ì œëŠ” ë°°ì¹˜ ì‘ì—…ìœ¼ë¡œ ì²˜ë¦¬.

---

## ğŸ”— ê´€ë ¨ ë§í¬

- **Jira Epic**: [KAN-10](https://ryuqqq.atlassian.net/browse/KAN-10)
- **GitHub**: [FileFlow Repository](https://github.com/ryu-qqq/FileFlow)
- **AWS S3 ë¬¸ì„œ**: [S3 Developer Guide](https://docs.aws.amazon.com/s3/)
- **ìƒìœ„ í”„ë¡œì íŠ¸**: ğŸ—ï¸ Setof ê³ ë„í™” í”„ë¡œì íŠ¸
- **ì´ì „ Epic**: Epic 1: í…Œë„ŒíŠ¸ ì •ì±… ê´€ë¦¬ ì‹œìŠ¤í…œ
- **ë‹¤ìŒ Epic**: Epic 3: ì´ë¯¸ì§€ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸

---

## ğŸ“– ì°¸ê³  ë¬¸ì„œ

### AWS ë¬¸ì„œ

- [S3 Presigned URL](https://docs.aws.amazon.com/AmazonS3/latest/userguide/PresignedUrlUploadObject.html)
- [S3 Event Notifications](https://docs.aws.amazon.com/AmazonS3/latest/userguide/NotificationHowTo.html)
- [SQS Developer Guide](https://docs.aws.amazon.com/sqs/)

### ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¬¸ì„œ

- [AWS SDK for Java v2](https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/home.html)
- [Apache Commons Imaging](https://commons.apache.org/proper/commons-imaging/)
- [Metadata Extractor](https://github.com/drewnoakes/metadata-extractor)

### ë¸”ë¡œê·¸ ë° ì•„í‹°í´

- [AWS re:Invent - S3 Best Practices](https://www.youtube.com/watch?v=rHeTn9pHNKo)
- [Hexagonal Architecture in Java](https://www.baeldung.com/hexagonal-architecture-ddd-spring)