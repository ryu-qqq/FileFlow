# 📋 FileFlow 관리자 화면 구조 설계

> 분석 완료일: 2025-11-03
> 분석 대상: 7개 Controller (Organization, Tenant, Settings, UserContext, Upload, File, Download)

---

## 🏗️ 화면 계층 구조

```
📱 FileFlow Admin
├── 🏢 IAM 관리 (Identity & Access Management)
│   ├── 조직 관리 (Organizations)
│   ├── 테넌트 관리 (Tenants)
│   └── 사용자 컨텍스트 관리 (User Contexts)
│
├── ⚙️ 설정 관리 (Settings)
│   └── EAV 설정 (3-Level Hierarchy)
│
├── 📁 파일 관리 (File Management)
│   ├── 파일 라이브러리 (File Library)
│   ├── 업로드 관리 (Upload Sessions)
│   └── 다운로드 큐 (Download Queue)
│
└── 📊 대시보드 (Dashboard)
    ├── 업로드 통계
    ├── 다운로드 통계
    └── 스토리지 사용량
```

---

## 📄 상세 화면 설계

### 1️⃣ IAM 관리

#### 1.1 조직 관리 (Organizations)

**목적**: 조직 생성, 수정, 상태 관리, 삭제

**API 엔드포인트**:
- `GET /api/v1/organizations` - 목록 조회 (페이징)
- `GET /api/v1/organizations/{organizationId}` - 상세 조회
- `POST /api/v1/organizations` - 생성
- `PATCH /api/v1/organizations/{organizationId}` - 수정
- `PATCH /api/v1/organizations/{organizationId}/status` - 상태 변경
- `DELETE /api/v1/organizations/{organizationId}` - 삭제 (Soft Delete)

**화면 구성**:

```
┌─────────────────────────────────────────────────────────────┐
│ 📄 조직 관리                                                 │
├─────────────────────────────────────────────────────────────┤
│ [+ 조직 생성]  [🔍 검색]  [필터: 전체/활성/비활성]            │
├─────────────────────────────────────────────────────────────┤
│ 조직명    | 상태    | 생성일       | 수정일       | 액션     │
├─────────────────────────────────────────────────────────────┤
│ Acme Inc │ ACTIVE  | 2025-01-01  | 2025-10-15  | [수정][삭제]│
│ Beta Co  │ INACTIVE| 2025-02-10  | 2025-05-20  | [수정][삭제]│
├─────────────────────────────────────────────────────────────┤
│ ◀ 이전  1 2 3 4 5  다음 ▶                                   │
└─────────────────────────────────────────────────────────────┘
```

**데이터 테이블**:
- 컬럼: 조직명, 상태 (ACTIVE/INACTIVE), 생성일, 수정일
- 페이징: Offset 기반 (page, size) 또는 Cursor 기반 (cursor, size)
- 필터: 상태별 필터 (전체/활성/비활성)
- 액션: 수정, 상태 변경, 삭제

**조직 생성/수정 폼**:
```
┌─────────────────────────────────────────┐
│ 조직 생성/수정                           │
├─────────────────────────────────────────┤
│ 조직명: [____________]                  │
│ 상태:   [▼ ACTIVE / INACTIVE]           │
│                                         │
│ [취소]  [저장]                          │
└─────────────────────────────────────────┘
```

---

#### 1.2 테넌트 관리 (Tenants)

**목적**: 테넌트 생성, 수정, 상태 관리, 조직 트리 뷰

**API 엔드포인트**:
- `GET /api/v1/tenants` - 목록 조회 (페이징)
- `GET /api/v1/tenants/{tenantId}` - 상세 조회
- `GET /api/v1/tenants/{tenantId}/tree` - 트리 뷰 (조직 포함)
- `POST /api/v1/tenants` - 생성
- `PATCH /api/v1/tenants/{tenantId}` - 수정
- `PATCH /api/v1/tenants/{tenantId}/status` - 상태 변경

**화면 구성**:

```
┌──────────────────────────────────────────────────────────────┐
│ 🏢 테넌트 관리                                                │
├──────────────────────────────────────────────────────────────┤
│ [+ 테넌트 생성]  [🔍 검색]  [필터: 전체/활성/중지]            │
├──────────────────────────────────────────────────────────────┤
│ 테넌트명  | 상태      | 조직 수 | 생성일      | 액션         │
├──────────────────────────────────────────────────────────────┤
│ TenantA  | ACTIVE    | 3개    | 2025-01-01 | [수정][트리]  │
│ TenantB  | SUSPENDED | 0개    | 2025-02-10 | [수정][트리]  │
├──────────────────────────────────────────────────────────────┤
│ ◀ 이전  1 2 3 4 5  다음 ▶                                    │
└──────────────────────────────────────────────────────────────┘
```

**테넌트 트리 뷰** (모달 또는 별도 페이지):
```
┌────────────────────────────────────────┐
│ 📊 TenantA 조직 트리                   │
├────────────────────────────────────────┤
│ 📁 TenantA (ACTIVE)                    │
│   ├── 📂 Acme Inc (ACTIVE)             │
│   ├── 📂 Beta Co (INACTIVE)            │
│   └── 📂 Gamma Ltd (ACTIVE)            │
│                                        │
│ [닫기]                                 │
└────────────────────────────────────────┘
```

---

#### 1.3 사용자 컨텍스트 관리 (User Contexts)

**목적**: 사용자 컨텍스트 생성

**API 엔드포인트**:
- `POST /api/v1/user-contexts` - 생성

**화면 구성**:

```
┌─────────────────────────────────────────┐
│ 👤 사용자 컨텍스트 생성                  │
├─────────────────────────────────────────┤
│ [+ 사용자 컨텍스트 생성]                 │
├─────────────────────────────────────────┤
│ (현재는 생성만 지원, 향후 목록/수정 추가) │
└─────────────────────────────────────────┘
```

**생성 폼**:
```
┌─────────────────────────────────────────┐
│ 사용자 컨텍스트 생성                     │
├─────────────────────────────────────────┤
│ (Request Body 필드 확인 필요)            │
│                                         │
│ [취소]  [생성]                          │
└─────────────────────────────────────────┘
```

---

### 2️⃣ 설정 관리

#### 2.1 EAV 설정 (3-Level Hierarchy)

**목적**: 조직/테넌트/기본 설정 관리 (3단계 우선순위)

**API 엔드포인트**:
- `GET /api/v1/settings?orgId=X&tenantId=Y` - 병합된 설정 조회 (ORG > TENANT > DEFAULT)
- `POST /api/v1/settings` - 설정 생성
- `PATCH /api/v1/settings` - 설정 수정 (key/level/contextId로 식별)

**화면 구성**:

```
┌──────────────────────────────────────────────────────────────┐
│ ⚙️ 설정 관리                                                  │
├──────────────────────────────────────────────────────────────┤
│ 조직: [▼ 전체 / Acme Inc / Beta Co]                          │
│ 테넌트: [▼ 전체 / TenantA / TenantB]                         │
│ [+ 설정 생성]                                                 │
├──────────────────────────────────────────────────────────────┤
│ 탭: [조직(ORG)] [테넌트(TENANT)] [기본(DEFAULT)]              │
├──────────────────────────────────────────────────────────────┤
│ 키         | 값          | 레벨   | 컨텍스트 | 액션          │
├──────────────────────────────────────────────────────────────┤
│ max_upload | 100MB       | ORG    | Acme Inc | [수정][삭제]  │
│ api_key    | ****        | TENANT | TenantA  | [수정][삭제]  │
│ theme      | dark        | DEFAULT| -        | [수정][삭제]  │
├──────────────────────────────────────────────────────────────┤
│ 💡 우선순위: ORG > TENANT > DEFAULT                           │
└──────────────────────────────────────────────────────────────┘
```

**설정 생성/수정 폼**:
```
┌─────────────────────────────────────────┐
│ 설정 생성/수정                           │
├─────────────────────────────────────────┤
│ 키:      [____________]                 │
│ 값:      [____________]                 │
│ 레벨:    [▼ ORG / TENANT / DEFAULT]     │
│ 컨텍스트: [▼ 조직/테넌트 선택]           │
│                                         │
│ [취소]  [저장]                          │
└─────────────────────────────────────────┘
```

**병합된 설정 뷰** (읽기 전용):
```
┌─────────────────────────────────────────┐
│ 📖 현재 적용 설정 (병합 뷰)              │
├─────────────────────────────────────────┤
│ 키         | 최종 값     | 출처          │
├─────────────────────────────────────────┤
│ max_upload | 100MB       | ORG (Acme)    │
│ api_key    | ****        | TENANT (A)    │
│ theme      | dark        | DEFAULT       │
└─────────────────────────────────────────┘
```

---

### 3️⃣ 파일 관리

#### 3.1 파일 라이브러리 (File Library)

**목적**: 파일 메타데이터 조회, 다운로드 URL 생성, 삭제

**API 엔드포인트**:
- `GET /api/v1/files` - 목록 조회 (필터: owner, status, visibility)
- `GET /api/v1/files/{fileId}` - 상세 조회
- `POST /api/v1/files/{fileId}/download-url` - 다운로드 URL 생성
- `DELETE /api/v1/files/{fileId}` - 삭제 (Soft Delete)

**필수 헤더**: X-Tenant-Id, X-Organization-Id (선택), X-User-Id (삭제 시 필수)

**화면 구성**:

```
┌──────────────────────────────────────────────────────────────┐
│ 📁 파일 라이브러리                                            │
├──────────────────────────────────────────────────────────────┤
│ 테넌트: [▼ TenantA]  조직: [▼ Acme Inc (선택)]              │
│ [🔍 검색]  필터: [소유자][상태][가시성]                       │
├──────────────────────────────────────────────────────────────┤
│ 파일명       | 크기   | 상태   | 가시성 | 생성일   | 액션    │
├──────────────────────────────────────────────────────────────┤
│ report.pdf  | 2.5MB | ACTIVE | PUBLIC | 2025-10 | [URL][삭제]│
│ invoice.xlsx| 1.2MB | ACTIVE | PRIVATE| 2025-09 | [URL][삭제]│
├──────────────────────────────────────────────────────────────┤
│ ◀ 이전  1 2 3 4 5  다음 ▶                                    │
└──────────────────────────────────────────────────────────────┘
```

**파일 상세 뷰** (모달):
```
┌────────────────────────────────────────┐
│ 📄 report.pdf                          │
├────────────────────────────────────────┤
│ 파일 ID: 12345                         │
│ 크기: 2.5MB                            │
│ 상태: ACTIVE                           │
│ 가시성: PUBLIC                         │
│ 소유자: user@example.com               │
│ 생성일: 2025-10-15 14:30               │
│                                        │
│ [다운로드 URL 생성]  [삭제]  [닫기]    │
└────────────────────────────────────────┘
```

---

#### 3.2 업로드 관리 (Upload Sessions)

**목적**: Single/Multipart 업로드 워크플로우 관리

**API 엔드포인트**:
- `POST /api/v1/uploads/single` - Single 업로드 초기화 (<100MB)
- `POST /api/v1/uploads/single/{sessionKey}/complete` - Single 완료
- `POST /api/v1/uploads/multipart/init` - Multipart 초기화
- `POST /api/v1/uploads/multipart/{sessionKey}/parts/{partNumber}/url` - Part URL 생성
- `PUT /api/v1/uploads/multipart/{sessionKey}/parts/{partNumber}` - Part 업로드 완료
- `POST /api/v1/uploads/multipart/{sessionKey}/complete` - Multipart 완료

**화면 구성**:

```
┌──────────────────────────────────────────────────────────────┐
│ ⬆️ 업로드 관리                                                │
├──────────────────────────────────────────────────────────────┤
│ [+ Single 업로드]  [+ Multipart 업로드]                       │
├──────────────────────────────────────────────────────────────┤
│ 세션 키  | 타입      | 진행률 | 상태      | 생성일   | 액션  │
├──────────────────────────────────────────────────────────────┤
│ abc123  | Single    | 100%   | COMPLETED | 2025-10 | [상세] │
│ def456  | Multipart | 60%    | IN_PROGRESS| 2025-10| [상세] │
├──────────────────────────────────────────────────────────────┤
│ ◀ 이전  1 2 3 4 5  다음 ▶                                    │
└──────────────────────────────────────────────────────────────┘
```

**Multipart 업로드 상세 뷰** (모달):
```
┌────────────────────────────────────────┐
│ 📦 Multipart 업로드 상세 (def456)      │
├────────────────────────────────────────┤
│ 파일명: large_video.mp4                │
│ 전체 크기: 500MB                       │
│ Part 수: 50개                          │
│                                        │
│ Part | 상태      | 업로드 시간         │
│ ──────────────────────────────────────│
│ 1    | COMPLETED | 2025-10-15 14:30   │
│ 2    | COMPLETED | 2025-10-15 14:31   │
│ 3    | IN_PROGRESS| -                 │
│ 4    | PENDING   | -                  │
│                                        │
│ [완료]  [취소]  [닫기]                 │
└────────────────────────────────────────┘
```

---

#### 3.3 다운로드 큐 (Download Queue)

**목적**: 외부 URL 비동기 다운로드 상태 모니터링

**API 엔드포인트**:
- `POST /api/v1/downloads/external` - 외부 다운로드 시작 (202 Accepted)
- `GET /api/v1/downloads/external/{downloadId}/status` - 상태 조회

**상태**: PENDING, DOWNLOADING, COMPLETED, FAILED

**화면 구성**:

```
┌──────────────────────────────────────────────────────────────┐
│ ⬇️ 다운로드 큐                                                │
├──────────────────────────────────────────────────────────────┤
│ [+ 외부 URL 다운로드]  [자동 새로고침: ON]                    │
├──────────────────────────────────────────────────────────────┤
│ ID    | URL          | 상태        | 진행률 | 시작 시간 | 액션│
├──────────────────────────────────────────────────────────────┤
│ 101   | https://...  | COMPLETED   | 100%   | 14:30    | [보기]│
│ 102   | https://...  | DOWNLOADING | 45%    | 14:35    | [보기]│
│ 103   | https://...  | FAILED      | -      | 14:40    | [재시도]│
├──────────────────────────────────────────────────────────────┤
│ ◀ 이전  1 2 3 4 5  다음 ▶                                    │
└──────────────────────────────────────────────────────────────┘
```

**다운로드 시작 폼**:
```
┌─────────────────────────────────────────┐
│ 외부 URL 다운로드                        │
├─────────────────────────────────────────┤
│ URL: [_____________________________]    │
│                                         │
│ X-Idempotency-Key: (자동 생성)          │
│                                         │
│ [취소]  [다운로드 시작]                 │
└─────────────────────────────────────────┘
```

---

### 4️⃣ 대시보드

#### 4.1 통합 대시보드

**목적**: 업로드/다운로드/스토리지 통계 시각화

**필요한 데이터**:
- 업로드: 총 세션 수, 성공/실패율, 평균 크기
- 다운로드: 대기/진행/완료/실패 건수
- 스토리지: 총 사용량, 테넌트별 사용량

**화면 구성**:

```
┌──────────────────────────────────────────────────────────────┐
│ 📊 FileFlow 대시보드                                          │
├──────────────────────────────────────────────────────────────┤
│ ⬆️ 업로드 통계 (최근 30일)                                    │
│ ┌──────────────────┐ ┌──────────────────┐ ┌──────────────┐  │
│ │ 총 업로드 수     │ │ 성공률           │ │ 평균 크기    │  │
│ │ 1,234건         │ │ 98.5%            │ │ 15.3MB       │  │
│ └──────────────────┘ └──────────────────┘ └──────────────┘  │
│                                                              │
│ ⬇️ 다운로드 큐 현황                                           │
│ ┌──────────────────┐ ┌──────────────────┐ ┌──────────────┐  │
│ │ 대기 중          │ │ 진행 중          │ │ 완료         │  │
│ │ 5건             │ │ 12건             │ │ 1,145건      │  │
│ └──────────────────┘ └──────────────────┘ └──────────────┘  │
│                                                              │
│ 💾 스토리지 사용량                                            │
│ ┌────────────────────────────────────────────────────────┐  │
│ │ 전체: 2.5TB / 10TB (25%)                               │  │
│ │ ████████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░            │  │
│ │                                                        │  │
│ │ 테넌트별 사용량:                                        │  │
│ │ - TenantA: 1.2TB (48%)                                │  │
│ │ - TenantB: 0.8TB (32%)                                │  │
│ │ - TenantC: 0.5TB (20%)                                │  │
│ └────────────────────────────────────────────────────────┘  │
└──────────────────────────────────────────────────────────────┘
```

---

## 🔀 네비게이션 구조

```
🏠 대시보드 (Dashboard)

🏢 IAM 관리
├── 조직 관리 (Organizations)
├── 테넌트 관리 (Tenants)
└── 사용자 컨텍스트 (User Contexts)

⚙️ 설정 관리
└── EAV 설정 (Settings)

📁 파일 관리
├── 파일 라이브러리 (Files)
├── 업로드 관리 (Uploads)
└── 다운로드 큐 (Downloads)
```

---

## 🔐 권한 및 보안

### 필수 헤더 관리

모든 API 호출 시 필요한 헤더를 UI에서 자동 관리:

```
X-Tenant-Id: [현재 선택된 테넌트]
X-Organization-Id: [현재 선택된 조직 (선택)]
X-User-Id: [로그인 사용자 ID]
X-Idempotency-Key: [다운로드 시 자동 생성]
```

### 권한 레벨 (향후 구현)

- **Admin**: 모든 화면 접근
- **Tenant Admin**: 특정 테넌트 화면만 접근
- **Org Admin**: 특정 조직 화면만 접근
- **User**: 파일 라이브러리 읽기 전용

---

## 📐 기술 스택 권장사항

### Frontend
- **React** + TypeScript
- **React Query**: API 상태 관리 (캐싱, 자동 새로고침)
- **React Hook Form**: 폼 관리
- **Zod**: 폼 검증
- **TanStack Table**: 데이터 테이블 (페이징, 필터, 정렬)
- **Recharts**: 대시보드 차트
- **Axios**: HTTP 클라이언트 (헤더 자동 주입)

### UI Component
- **shadcn/ui** 또는 **Ant Design**: 일관된 UI 컴포넌트
- **React Router**: 라우팅
- **TailwindCSS**: 스타일링

---

## 🎯 구현 우선순위

### Phase 1: 핵심 기능 (MVP)
1. **IAM 관리**: 조직, 테넌트 CRUD
2. **파일 라이브러리**: 파일 목록, 다운로드 URL 생성
3. **업로드 관리**: Single 업로드 (Multipart는 Phase 2)

### Phase 2: 고급 기능
4. **설정 관리**: EAV 3-Level Hierarchy
5. **Multipart 업로드**: 대용량 파일 지원
6. **다운로드 큐**: 외부 URL 비동기 다운로드

### Phase 3: 모니터링
7. **대시보드**: 통계 및 시각화

---

## ✅ 다음 단계

1. **Frontend 프로젝트 생성**: React + TypeScript 보일러플레이트
2. **API Client 구현**: Axios 인스턴스 + 헤더 인터셉터
3. **공통 컴포넌트**: 데이터 테이블, 폼, 모달
4. **Phase 1 화면 구현**: IAM 관리, 파일 라이브러리, Single 업로드

---

## 📊 분석 요약

### 분석한 Controller (7개)
1. **OrganizationController** - 6개 엔드포인트 (조직 CRUD + 상태 관리)
2. **TenantController** - 6개 엔드포인트 (테넌트 CRUD + 트리 뷰)
3. **SettingsController** - 3개 엔드포인트 (EAV 3-Level 설정)
4. **UserContextController** - 1개 엔드포인트 (사용자 컨텍스트 생성)
5. **UploadController** - 6개 엔드포인트 (Single/Multipart 업로드)
6. **FileController** - 4개 엔드포인트 (파일 메타데이터, 다운로드 URL, 삭제)
7. **DownloadController** - 2개 엔드포인트 (외부 URL 비동기 다운로드)

### 총 엔드포인트: 28개
- **IAM**: 13개 (조직 6 + 테넌트 6 + 사용자 1)
- **설정**: 3개
- **파일**: 12개 (업로드 6 + 파일 4 + 다운로드 2)

**이 설계는 현재 REST API를 100% 커버하며, 향후 확장 가능한 구조로 설계되었습니다!** 🚀
