# Spring DDD Standards - Cursor AI Rules

> **ì»¨ë²¤ì…˜ ì›ë³¸**: `docs/coding_convention/` (98ê°œ ê·œì¹™)
> **Cache**: `.claude/cache/rules/` (JSON ê²€ìƒ‰ìš©)

---

## ğŸš¨ Zero-Tolerance (ì ˆëŒ€ ê¸ˆì§€)

### 1. Lombok ê¸ˆì§€
- âŒ `@Data`, `@Builder`, `@Getter`, `@Setter`, `@AllArgsConstructor`, `@NoArgsConstructor`
- âœ… **Pure Java getter/setter ì§ì ‘ ì‘ì„±**

### 2. Law of Demeter (Getter ì²´ì´ë‹ ê¸ˆì§€)
- âŒ `order.getCustomer().getAddress().getZipCode()`
- âœ… `order.getCustomerZipCode()` **(Tell, Don't Ask)**

### 3. Long FK Strategy (JPA ê´€ê³„ ê¸ˆì§€)
- âŒ `@ManyToOne`, `@OneToMany`, `@OneToOne`, `@ManyToMany`
- âœ… **`private Long userId;` (Long FK ì‚¬ìš©)**

### 4. Transaction ê²½ê³„ & Outbox Pattern
- âŒ `@Transactional` ë‚´ ì™¸ë¶€ API í˜¸ì¶œ
- âœ… **íŠ¸ëœì­ì…˜ì€ ì§§ê²Œ ìœ ì§€, ì™¸ë¶€ í˜¸ì¶œì€ ë°–ì—ì„œ**
- âœ… **ì™¸ë¶€ API í˜¸ì¶œ ì‹œ Transactional Outbox Pattern ì‚¬ìš© (Pattern B ê¶Œì¥)**
  - Pattern A (Direct Event): ì§€ì–‘ - ê²°ì œ/ê¸ˆìœµì—” ë¶€ì í•©
  - **Pattern B (Outbox + Event Wake-up)**: ê¶Œì¥ - í”„ë¡œë•ì…˜ í‘œì¤€
  - Pattern C (MQ Integration): MQ ë„ì… ì‹œ ê¶Œì¥

### 5. Orchestration Pattern
- âŒ `executeInternal()`ì— `@Transactional` ì‚¬ìš©
- âœ… `executeInternal()`ì— `@Async` í•„ìˆ˜, íŠ¸ëœì­ì…˜ ë°–ì—ì„œ ì™¸ë¶€ API í˜¸ì¶œ
- âŒ Commandì— Lombok (`@Data`, `@Builder` ë“±)
- âœ… CommandëŠ” Record íŒ¨í„´ ì‚¬ìš© (`public record XxxCommand`)
- âŒ Operation Entityì— IdemKey Unique ì œì•½ ì—†ìŒ
- âœ… `@UniqueConstraint(columnNames = {"idem_key"})` í•„ìˆ˜
- âŒ Orchestratorê°€ `boolean`/`void` ë°˜í™˜ ë˜ëŠ” Exception throw
- âœ… OrchestratorëŠ” `Outcome` (Ok/Retry/Fail) ë°˜í™˜

### 6. Javadoc í•„ìˆ˜
- âŒ `@author`, `@since` ì—†ëŠ” public í´ë˜ìŠ¤/ë©”ì„œë“œ
- âœ… **ëª¨ë“  public í´ë˜ìŠ¤/ë©”ì„œë“œì— Javadoc**

---

## ğŸ“‹ í•„ìˆ˜ ê·œì¹™

### Domain Layer
- âœ… Aggregate Root, Value Object, Domain Event, Factory Pattern

### Application Layer
- âœ… UseCase Single Responsibility, Command/Query ë¶„ë¦¬, `@Transactional` ê²½ê³„, Assembler

### Persistence Layer
- âœ… CQRS, QueryDSL, N+1 ë°©ì§€

### REST API Layer
- âœ… Controller Thin, GlobalExceptionHandler, ApiResponse í‘œì¤€í™”

---

## ğŸ”— ìƒì„¸ ê·œì¹™ ì°¸ì¡°

**Cursor AIëŠ” ì•„ë˜ ë””ë ‰í† ë¦¬ì˜ ë§ˆí¬ë‹¤ìš´ íŒŒì¼ì„ ìë™ìœ¼ë¡œ ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:**

- `docs/coding_convention/02-domain-layer/`
- `docs/coding_convention/03-application-layer/`
- `docs/coding_convention/04-persistence-layer/`
- `docs/coding_convention/01-adapter-rest-api-layer/`
- `docs/coding_convention/05-testing/`
- `docs/coding_convention/06-java21-patterns/`
- `docs/coding_convention/07-enterprise-patterns/`
- `docs/coding_convention/09-orchestration-patterns/`

---

**âœ… ì´ ê·œì¹™ë“¤ì„ ì¤€ìˆ˜í•˜ë©´ Claude Code ê²€ì¦ì„ í†µê³¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!**
## ğŸ¯ Kent Beck TDD ì›Œí¬í”Œë¡œìš° (Domain Layer ì „ìš©)

### TDD ì‚¬ì´í´: RED â†’ GREEN â†’ REFACTOR

```
1ï¸âƒ£ RED Phase: ì‹¤íŒ¨í•˜ëŠ” í…ŒìŠ¤íŠ¸ ì‘ì„±
   â†’ TestFixture ë¨¼ì € ìƒì„± (FIRST STEP)
   â†’ Given-When-Then êµ¬ì¡°
   â†’ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì„ í…ŒìŠ¤íŠ¸ë¡œ í‘œí˜„

2ï¸âƒ£ GREEN Phase: ìµœì†Œ êµ¬í˜„ìœ¼ë¡œ í†µê³¼
   â†’ í…ŒìŠ¤íŠ¸ í†µê³¼ë§Œ ëª©í‘œ
   â†’ í•˜ë“œì½”ë”© í—ˆìš© (ë¹ ë¥´ê²Œ!)
   â†’ Lombok ê¸ˆì§€ë§Œ í•„ìˆ˜ ì¤€ìˆ˜

3ï¸âƒ£ REFACTOR Phase: ì»¨ë²¤ì…˜ ì ìš©
   â†’ Law of Demeter ì ìš©
   â†’ ValueObject íŒ¨í„´ ì™„ì„±
   â†’ Tell, Don't Ask ì›ì¹™
   â†’ Javadoc ì¶”ê°€
```

### RED Phase í•µì‹¬

**TestFixture Pattern (í•„ìˆ˜)**:
```java
public class OrderDomainFixture {
    public static final Long DEFAULT_ORDER_ID = 1L;

    public static Order create() { ... }
    public static Order createWithStatus(OrderStatus status) { ... }
    public static List<OrderLineItem> createDefaultLineItems() { ... }
}
```

**í…ŒìŠ¤íŠ¸ êµ¬ì¡°**:
```java
@Test
@DisplayName("ì£¼ë¬¸ ìƒì„± - ìœ íš¨í•œ ë¼ì¸ ì•„ì´í…œìœ¼ë¡œ ìƒì„± ì„±ê³µ")
void createOrder_WithValidLineItems_ShouldSucceed() {
    // Given
    List<OrderLineItem> lineItems = OrderDomainFixture.createDefaultLineItems();

    // When
    Order order = Order.create(OrderId.of(1L), lineItems, Money.of(10000));

    // Then
    assertThat(order.getOrderId()).isEqualTo(OrderId.of(1L));
}
```

### GREEN Phase í•µì‹¬

**ìµœì†Œ êµ¬í˜„ (í•˜ë“œì½”ë”© OK)**:
```java
public class Order {
    private Order(OrderId orderId, List<OrderLineItem> lineItems, Money totalPrice) {
        this.orderId = orderId;
        this.lineItems = lineItems;
        this.totalPrice = totalPrice;
        this.status = OrderStatus.PLACED;
    }

    public static Order create(...) {
        if (lineItems.isEmpty()) {
            throw new IllegalArgumentException("ìµœì†Œ 1ê°œ í•„ìš”");
        }
        return new Order(...);
    }

    // GREEN Phase: í•˜ë“œì½”ë”© (REFACTORì—ì„œ ê°œì„ )
    public Money calculateTotalPrice() {
        return totalPrice; // ë‹¨ìˆœ ë¦¬í„´
    }
}
```

**ì£¼ì˜**: Lombokì€ GREEN Phaseì—ì„œë„ ê¸ˆì§€!

### REFACTOR Phase í•µì‹¬

**Law of Demeter ì ìš©**:
```java
// âŒ Before (GREEN Phase)
public Money calculateTotalPrice() {
    return totalPrice; // í•˜ë“œì½”ë”©
}

// âœ… After (REFACTOR Phase)
public Money calculateTotalPrice() {
    return lineItems.stream()
        .map(OrderLineItem::calculatePrice)
        .reduce(Money.ZERO, Money::add);
}
```

**ValueObject ë¶ˆë³€ì„±**:
```java
public class Money {
    public static final Money ZERO = new Money(BigDecimal.ZERO);

    private final BigDecimal amount; // final í•„ìˆ˜

    private Money(BigDecimal amount) { ... }

    public static Money of(BigDecimal amount) { ... }

    // ìƒˆ ê°ì²´ ë°˜í™˜ (ë¶ˆë³€ì„±)
    public Money add(Money other) {
        return new Money(this.amount.add(other.amount));
    }
}
```

### Cursor ì‹¤í–‰ ê°€ì´ë“œ

```
Claude Codeì—ì„œ PRD ìƒì„±:
  /cr/domain-prd "Order Management"
  â†’ docs/prd/domain/order-domain-prd.md

Cursor Composerì—ì„œ TDD ì‹¤í–‰:
  "docs/prd/domain/order-domain-prd.mdë¥¼ ì½ê³ :
   1. /cr/red - TestFixture + Tests ìƒì„±
   2. /cr/green - ìµœì†Œ êµ¬í˜„ (Lombok ê¸ˆì§€)
   3. /cr/refactor - ì»¨ë²¤ì…˜ 100% ì ìš©"

Claude Codeì—ì„œ ê²€ì¦:
  /cr/validate
  â†’ validation-helper.py + LangFuse ì—…ë¡œë“œ
```

### TDD ì ìš© ë²”ìœ„

**âœ… Domain Layerë§Œ ì ìš©**:
- Aggregate Root (e.g., Order)
- Value Object (e.g., OrderId, Money)
- Enum (e.g., OrderStatus)
- Domain Event

**âŒ ë‹¤ë¥¸ LayerëŠ” ê¸°ì¡´ ë°©ì‹ ì‚¬ìš©**:
- Application Layer â†’ `/code-gen-usecase`
- Persistence Layer â†’ `/code-gen-repository`
- REST API Layer â†’ `/code-gen-controller`

