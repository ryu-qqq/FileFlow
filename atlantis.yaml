# ============================================================================
# FileFlow - Atlantis Configuration
# ============================================================================
# PR-based Terraform automation for FileFlow infrastructure
# ============================================================================

version: 3

automerge: false
delete_source_branch_on_merge: false
parallel_plan: true
parallel_apply: false

projects:
  # ============================================================================
  # Container Registry
  # ============================================================================

  # ECR Repository for Docker images
  - name: ecr-prod
    dir: terraform/ecr
    workspace: default
    autoplan:
      when_modified: ["*.tf", "*.tfvars"]
      enabled: true

  # ============================================================================
  # Storage (DISABLED - Atlantis IAM needs s3:GetBucketPolicy permission)
  # ============================================================================
  # TODO: Re-enable after adding s3:GetBucketPolicy to Atlantis ECS Task Role
  # - name: s3-prod
  #   dir: terraform/s3
  #   workspace: default
  #   autoplan:
  #     when_modified: ["*.tf", "*.tfvars"]
  #     enabled: true
